# Video Call - API Contract

**API contract document defining the interface between frontend and backend. This is the ONLY coupling point between frontend and backend.**

## Purpose

Video conferencing utility using Cloudflare RealtimeKit. Allows users to create and join video conference rooms for real-time video and audio communication.

## Code Locations

-   **Frontend Code**: `frontend/src/pages/tools/video-call/`
-   **Backend Code**: `backend/src/routes/video-call/`

## API Base URL

-   Development: `http://localhost:8787/api`
-   Production: `https://bahasadri.com/api`

## Endpoints

### `GET /api/tools/video-call/global-room`

**Description**: Returns the global room ID (single room for all users)

**Request**: None

**Response**:

```typescript
interface GlobalRoomResponse {
    room_id: string;
}
```

**Status Codes**:

-   `200 OK`: Success
-   `500 Internal Server Error`: Room ID not configured

### `POST /api/tools/video-call/session`

**Description**: Creates a new video conference meeting session

**Request Body**:

```typescript
interface CreateSessionRequest {
    name?: string; // Optional meeting name
}
```

**Response**:

```typescript
interface CreateSessionResponse {
    meeting_id: string;
}
```

**Status Codes**:

-   `200 OK`: Meeting created successfully
-   `500 Internal Server Error`: RealtimeKit API error

### `POST /api/tools/video-call/token`

**Description**: Generates participant authentication token for joining a meeting

**Request Body**:

```typescript
interface GenerateTokenRequest {
    meeting_id: string;
    name?: string;
    custom_participant_id?: string;
    preset_name?: string; // Default: "group_call_participant"
}
```

**Response**:

```typescript
interface GenerateTokenResponse {
    auth_token: string;
}
```

**Status Codes**:

-   `200 OK`: Token generated successfully
-   `400 Bad Request`: Missing meeting_id
-   `500 Internal Server Error`: RealtimeKit API error

## Shared Data Models

### TypeScript Types

```typescript
interface RealtimeKitConfig {
    accountId: string;
    appId: string;
    apiToken: string;
}

interface Participant {
    id: string;
    name: string;
    stream?: MediaStream;
    videoEnabled: boolean;
    audioEnabled: boolean;
    isLocal: boolean;
}

type RoomState = "idle" | "connecting" | "connected" | "error" | "disconnected";
```

## Error Handling

### Standard Error Response

All errors follow this format:

```typescript
interface ErrorResponse {
    error: string;
}
```

### Error Codes

| Code                | HTTP Status | When to Use             |
| ------------------- | ----------- | ----------------------- |
| `INVALID_INPUT`     | 400         | Missing required fields |
| `NOT_FOUND`         | 404         | Meeting not found       |
| `INTERNAL_ERROR`    | 500         | Server error            |
| `REALTIMEKIT_ERROR` | 500         | RealtimeKit API error   |

## Authentication/Authorization

-   **Required**: No (public utility)
-   **Method**: None
-   **Token-based**: Auth tokens required for RealtimeKit SDK (generated by backend)

## Rate Limiting

-   **Limit**: TBD (to be configured)
-   **Headers**: Rate limit info in response headers (if implemented)

## CORS

-   **Allowed Origins**: `https://bahasadri.com`
-   **Allowed Methods**: GET, POST
-   **Allowed Headers**: Content-Type

## Versioning

-   **Current Version**: v1
-   **Version Header**: Not implemented

## Testing

### Test Endpoints

-   Development: Use localhost endpoints
-   Production: Use production API URL

### Example Requests

```bash
# Get global room ID
curl -X GET "http://localhost:8787/api/tools/video-call/global-room"

# Create session
curl -X POST "http://localhost:8787/api/tools/video-call/session" \
  -H "Content-Type: application/json" \
  -d '{"name": "My Meeting"}'

# Generate token
curl -X POST "http://localhost:8787/api/tools/video-call/token" \
  -H "Content-Type: application/json" \
  -d '{"meeting_id": "meeting-id-here", "name": "John Doe"}'
```

---

**Note**: This document defines the contract between frontend and backend. Implementation details are in FRONTEND.md and BACKEND.md respectively.
