openapi: 3.1.0
info:
    title: Video Call API
    description: >-
        API contract document defining the interface between frontend and backend.
        This is the ONLY coupling point between frontend and backend.
        Video call utility using Cloudflare RealtimeKit. Allows users to create
        meetings and generate participant authentication tokens to join them.
        This API wraps RealtimeKit's REST API endpoints for meeting creation
        and participant token generation.
    version: 1.0.0
    contact:
        name: API Support
servers:
    - url: http://localhost:8787/api
      description: Development
    - url: https://bahasadri.com/api
      description: Production

tags:
    - name: Video Call
      description: Video call endpoints

components:
    # -------------------------------------------------------------------------
    # SHARED MODELS
    # -------------------------------------------------------------------------
    schemas:
        CreateSessionRequest:
            type: object
            properties:
                name:
                    type: string
                    description: Optional session name for identification
                    example: "Team Meeting"

        CreateSessionResponse:
            type: object
            required:
                - meeting_id
            properties:
                meeting_id:
                    type: string
                    description: Unique meeting identifier returned from RealtimeKit
                    example: "meeting_550e8400-e29b-41d4-a716-446655440000"

        GenerateTokenRequest:
            type: object
            required:
                - meeting_id
            properties:
                meeting_id:
                    type: string
                    description: The meeting identifier to join (from createSession response)
                    example: "meeting_550e8400-e29b-41d4-a716-446655440000"
                name:
                    type: string
                    description: Optional participant display name
                    example: "John Doe"
                custom_participant_id:
                    type: string
                    description: Optional custom participant identifier. If not provided, RealtimeKit generates one.
                    example: "participant_123"
                preset_name:
                    type: string
                    description: 'Optional preset name defining participant permissions and UI configuration. Default: "group_call_participant"'
                    example: "group_call_participant"

        GenerateTokenResponse:
            type: object
            required:
                - auth_token
            properties:
                auth_token:
                    type: string
                    description: Authentication token returned from RealtimeKit. This token is used to initialize the RealtimeKit SDK on the frontend to join the meeting.
                    example: "token_abc123"

        Session:
            type: object
            required:
                - id
            properties:
                id:
                    type: string
                    description: Unique session identifier
                    example: "string"
                associated_id:
                    type: string
                    description: Associated meeting or entity identifier
                    example: "string"
                meeting_display_name:
                    type: string
                    description: Display name for the meeting associated with this session
                    example: "string"
                type:
                    type: string
                    description: Type of session (e.g., "meeting")
                    example: "meeting"
                status:
                    type: string
                    description: Current status of the session (e.g., "LIVE")
                    example: "LIVE"
                live_participants:
                    type: integer
                    description: Number of currently active participants
                    example: 0
                max_concurrent_participants:
                    type: integer
                    description: Maximum number of concurrent participants
                    example: 0
                minutes_consumed:
                    type: integer
                    description: Total minutes consumed for this session
                    example: 0
                organization_id:
                    type: string
                    description: Organization identifier
                    example: "string"
                started_at:
                    type: string
                    format: date-time
                    description: Session start timestamp
                    example: "2024-01-15T10:30:00Z"
                created_at:
                    type: string
                    format: date-time
                    description: Session creation timestamp
                    example: "2024-01-15T10:30:00Z"
                updated_at:
                    type: string
                    format: date-time
                    description: Session last update timestamp
                    example: "2024-01-15T10:30:00Z"
                ended_at:
                    type: string
                    format: date-time
                    description: Session end timestamp (if ended)
                    example: "2024-01-15T11:30:00Z"
                meta:
                    type: object
                    description: Additional metadata for the session
                    additionalProperties: true
                    example: {}
                breakout_rooms:
                    type: array
                    description: List of breakout rooms associated with this session
                    items:
                        type: object
                        additionalProperties: true
                    example: []

        ListSessionsResponse:
            type: object
            required:
                - success
                - data
            properties:
                success:
                    type: boolean
                    description: Indicates if the request was successful
                    example: true
                data:
                    type: object
                    required:
                        - sessions
                    properties:
                        sessions:
                            type: array
                            description: List of ongoing/active video call sessions
                            items:
                                $ref: "#/components/schemas/Session"

        Meeting:
            type: object
            required:
                - id
            properties:
                id:
                    type: string
                    description: Unique meeting identifier
                    example: "497f6eca-6276-4993-bfeb-53cbbbba6f08"
                title:
                    type: string
                    description: Meeting title
                    example: "string"
                preferred_region:
                    type: string
                    description: Preferred region for the meeting
                    example: "ap-south-1"
                created_at:
                    type: string
                    format: date-time
                    description: Meeting creation timestamp
                    example: "2019-08-24T14:15:22Z"
                record_on_start:
                    type: boolean
                    description: Whether recording starts automatically when meeting begins
                    example: true
                updated_at:
                    type: string
                    format: date-time
                    description: Meeting last update timestamp
                    example: "2019-08-24T14:15:22Z"
                live_stream_on_start:
                    type: boolean
                    description: Whether live streaming starts automatically when meeting begins
                    example: true
                persist_chat:
                    type: boolean
                    description: Whether chat messages persist after meeting ends
                    example: true
                summarize_on_end:
                    type: boolean
                    description: Whether meeting summary is generated when meeting ends
                    example: true
                status:
                    type: string
                    description: Current status of the meeting (e.g., "ACTIVE")
                    example: "ACTIVE"

        Paging:
            type: object
            required:
                - total_count
                - start_offset
                - end_offset
            properties:
                total_count:
                    type: integer
                    description: Total number of meetings available
                    example: 30
                start_offset:
                    type: integer
                    description: Starting offset of the current page
                    example: 1
                end_offset:
                    type: integer
                    description: Ending offset of the current page
                    example: 30

        ListMeetingsResponse:
            type: object
            required:
                - success
                - data
            properties:
                success:
                    type: boolean
                    description: Indicates if the request was successful
                    example: true
                data:
                    type: array
                    description: List of all meetings for the organization
                    items:
                        $ref: "#/components/schemas/Meeting"
                paging:
                    $ref: "#/components/schemas/Paging"

        Preset:
            type: object
            required:
                - id
            properties:
                id:
                    type: string
                    description: Unique preset identifier
                    example: "497f6eca-6276-4993-bfeb-53cbbbba6f08"
                name:
                    type: string
                    description: Preset name
                    example: "string"
                created_at:
                    type: string
                    format: date-time
                    description: Preset creation timestamp
                    example: "2019-08-24T14:15:22Z"
                updated_at:
                    type: string
                    format: date-time
                    description: Preset last update timestamp
                    example: "2019-08-24T14:15:22Z"

        ListPresetsResponse:
            type: object
            required:
                - success
                - data
            properties:
                success:
                    type: boolean
                    description: Indicates if the request was successful
                    example: true
                data:
                    type: array
                    description: List of all presets for the organization
                    items:
                        $ref: "#/components/schemas/Preset"
                paging:
                    $ref: "#/components/schemas/Paging"

        DeleteMeetingResponse:
            type: object
            required:
                - success
            properties:
                success:
                    type: boolean
                    description: Indicates if the meeting was deleted successfully
                    example: true

        ErrorResponse:
            type: object
            required:
                - error
                - code
            properties:
                error:
                    type: string
                    description: Human-readable error message
                    example: "Meeting does not exist"
                code:
                    type: string
                    enum:
                        [
                            INVALID_INPUT,
                            NOT_FOUND,
                            INTERNAL_ERROR,
                            REALTIMEKIT_ERROR,
                        ]
                    description: Machine-readable error code
                    example: "NOT_FOUND"

    # ---------------------------------------------------------------------------
    # STANDARD RESPONSES
    # ---------------------------------------------------------------------------
    responses:
        BadRequest:
            description: Invalid input provided (400).
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/ErrorResponse"
                    examples:
                        invalid_input:
                            value:
                                error: "Missing or invalid request fields"
                                code: "INVALID_INPUT"

        NotFound:
            description: Resource not found (404).
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/ErrorResponse"
                    examples:
                        not_found:
                            value:
                                error: "Meeting does not exist"
                                code: "NOT_FOUND"

        InternalError:
            description: Server error (500).
            content:
                application/json:
                    schema:
                        $ref: "#/components/schemas/ErrorResponse"
                    examples:
                        realtimekit_error:
                            value:
                                error: "RealtimeKit API error"
                                code: "REALTIMEKIT_ERROR"
                        server_error:
                            value:
                                error: "Server error"
                                code: "INTERNAL_ERROR"

paths:
    # ---------------------------------------------------------------------------
    # CREATE SESSION ENDPOINT
    # ---------------------------------------------------------------------------
    /video-call/session:
        post:
            operationId: createSession
            summary: Create a new video call meeting
            description: >-
                Creates a new meeting via RealtimeKit's REST API. This corresponds to
                RealtimeKit's "Create Meeting" endpoint. Returns a meeting ID that can
                be used to generate participant tokens. The meeting persists until
                all participants leave or it is explicitly ended.
            tags:
                - Video Call
            requestBody:
                required: false
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/CreateSessionRequest"
            responses:
                "200":
                    description: Session created successfully.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/CreateSessionResponse"
                "500":
                    $ref: "#/components/responses/InternalError"

    # ---------------------------------------------------------------------------
    # LIST SESSIONS ENDPOINT
    # ---------------------------------------------------------------------------
    /video-call/sessions:
        get:
            operationId: listSessions
            summary: List ongoing video call sessions
            description: >-
                Retrieves a list of ongoing/active video call sessions from RealtimeKit.
                This corresponds to RealtimeKit's "List Sessions" endpoint (GET /v2/sessions).
                Returns all sessions that are currently active (have participants or are available to join).
                Sessions represent active meeting instances, while meetings are the persistent
                meeting configurations.
            tags:
                - Video Call
            parameters:
                - name: status
                  in: query
                  description: Filter sessions by status. Defaults to LIVE to return only active sessions.
                  required: false
                  schema:
                      type: string
                      enum:
                          - LIVE
                          - ENDED
                      default: LIVE
            responses:
                "200":
                    description: Sessions retrieved successfully.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ListSessionsResponse"
                "500":
                    $ref: "#/components/responses/InternalError"

    # ---------------------------------------------------------------------------
    # LIST ALL MEETINGS ENDPOINT
    # ---------------------------------------------------------------------------
    /video-call/meetings:
        get:
            operationId: listAllMeetings
            summary: List all meetings for the organization
            description: >-
                Retrieves a list of all meetings for the organization from RealtimeKit.
                This corresponds to RealtimeKit's "Get All Meetings" endpoint (GET /v2/meetings).
                Returns all meetings associated with the organization, regardless of their current state.
                Meetings are persistent meeting configurations, while sessions are active meeting instances.
            tags:
                - Video Call
            responses:
                "200":
                    description: Meetings retrieved successfully.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ListMeetingsResponse"
                "500":
                    $ref: "#/components/responses/InternalError"

    # ---------------------------------------------------------------------------
    # DELETE MEETING ENDPOINT
    # ---------------------------------------------------------------------------
    /video-call/meetings/{meeting_id}:
        delete:
            operationId: deleteMeeting
            summary: Deactivate a meeting
            description: >-
                Deactivates a meeting by setting its status to INACTIVE. This corresponds
                to RealtimeKit's "Update Meeting" endpoint (PATCH /v2/meetings/{meeting_id}).
                RealtimeKit does not support deleting meetings, so this endpoint sets the
                meeting status to INACTIVE, which prevents users from joining the meeting.
            tags:
                - Video Call
            parameters:
                - name: meeting_id
                  in: path
                  required: true
                  description: The meeting identifier to delete
                  schema:
                      type: string
                      example: "497f6eca-6276-4993-bfeb-53cbbbba6f08"
            responses:
                "200":
                    description: Meeting deleted successfully.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/DeleteMeetingResponse"
                "404":
                    $ref: "#/components/responses/NotFound"
                "500":
                    $ref: "#/components/responses/InternalError"

    # ---------------------------------------------------------------------------
    # LIST ALL PRESETS ENDPOINT
    # ---------------------------------------------------------------------------
    /video-call/presets:
        get:
            operationId: listAllPresets
            summary: List all presets for the organization
            description: >-
                Retrieves a list of all presets for the organization from RealtimeKit.
                This corresponds to RealtimeKit's "Get All Presets" endpoint (GET /v2/presets).
                Returns all presets associated with the organization. Presets define participant
                permissions and UI configuration for meetings.
            tags:
                - Video Call
            responses:
                "200":
                    description: Presets retrieved successfully.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/ListPresetsResponse"
                "500":
                    $ref: "#/components/responses/InternalError"

    # ---------------------------------------------------------------------------
    # GENERATE TOKEN ENDPOINT
    # ---------------------------------------------------------------------------
    /video-call/token:
        post:
            operationId: generateToken
            summary: Generate participant authentication token
            description: >-
                Generates a participant authentication token via RealtimeKit's REST API.
                This corresponds to RealtimeKit's "Add Participant" endpoint, which
                creates a participant entry for the meeting and returns an authToken.
                The token is used to initialize the RealtimeKit SDK on the frontend
                to join the meeting. Each participant needs their own token.
            tags:
                - Video Call
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/GenerateTokenRequest"
            responses:
                "200":
                    description: Token generated successfully.
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/GenerateTokenResponse"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "404":
                    $ref: "#/components/responses/NotFound"
                "500":
                    $ref: "#/components/responses/InternalError"
