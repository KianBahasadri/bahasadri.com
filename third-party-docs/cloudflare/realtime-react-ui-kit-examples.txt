Repository: dyte-io/react-samples
Files analyzed: 323

Estimated tokens: 102.5k

Directory structure:
â””â”€â”€ dyte-io-react-samples/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ index.html
    â”œâ”€â”€ LICENSE
    â”œâ”€â”€ package.json
    â”œâ”€â”€ postbuild.sh
    â”œâ”€â”€ update-cloudflare-realtime-deps.sh
    â”œâ”€â”€ upgrade-to-rtk.sh
    â”œâ”€â”€ wrangler.jsonc
    â”œâ”€â”€ samples/
    â”‚   â”œâ”€â”€ active-speaker-ui/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â”œâ”€â”€ components/
    â”‚   â”‚       â”‚   â”œâ”€â”€ ActiveSpeaker.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ Controlbar.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ Grid.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ MainArea.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ Meeting.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ ScreenShareView.tsx
    â”‚   â”‚       â”‚   â””â”€â”€ Sidebar.tsx
    â”‚   â”‚       â””â”€â”€ lib/
    â”‚   â”‚           â”œâ”€â”€ const.ts
    â”‚   â”‚           â”œâ”€â”€ meeting-store.ts
    â”‚   â”‚           â””â”€â”€ useActiveSpeaker.ts
    â”‚   â”œâ”€â”€ async-video-survey/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ store.ts
    â”‚   â”‚       â”œâ”€â”€ utils.ts
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â”œâ”€â”€ Duration.tsx
    â”‚   â”‚           â””â”€â”€ ProgressBar.tsx
    â”‚   â”œâ”€â”€ audio-room/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.cjs
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.cjs
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â”œâ”€â”€ AudioRoom.tsx
    â”‚   â”‚           â”œâ”€â”€ Room.tsx
    â”‚   â”‚           â””â”€â”€ Stage.tsx
    â”‚   â”œâ”€â”€ back-to-back-meetings/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ Meeting.tsx
    â”‚   â”‚       â”œâ”€â”€ store.ts
    â”‚   â”‚       â”œâ”€â”€ types.ts
    â”‚   â”‚       â”œâ”€â”€ components/
    â”‚   â”‚       â”‚   â”œâ”€â”€ custom-rtk-meeting.tsx
    â”‚   â”‚       â”‚   â””â”€â”€ in-meeting.tsx
    â”‚   â”‚       â””â”€â”€ hooks/
    â”‚   â”‚           â””â”€â”€ useContainerSize.ts
    â”‚   â”œâ”€â”€ chat/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â””â”€â”€ vite-env.d.ts
    â”‚   â”œâ”€â”€ chat-widget/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .editorconfig
    â”‚   â”‚   â”œâ”€â”€ .env.sample
    â”‚   â”‚   â”œâ”€â”€ .eslintrc
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â”œâ”€â”€ .prettierignore
    â”‚   â”‚   â”œâ”€â”€ .prettierrc
    â”‚   â”‚   â”œâ”€â”€ public/
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ index.tsx
    â”‚   â”‚       â”œâ”€â”€ server.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â”œâ”€â”€ App.tsx
    â”‚   â”‚           â”œâ”€â”€ ChatPopup.tsx
    â”‚   â”‚           â”œâ”€â”€ Form.tsx
    â”‚   â”‚           â”œâ”€â”€ Widget.tsx
    â”‚   â”‚           â””â”€â”€ WidgetLauncher.tsx
    â”‚   â”œâ”€â”€ clubhouse/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â”œâ”€â”€ docs/
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â”œâ”€â”€ icons.tsx
    â”‚   â”‚           â”œâ”€â”€ Meeting.tsx
    â”‚   â”‚           â”œâ”€â”€ Requests.tsx
    â”‚   â”‚           â””â”€â”€ User.tsx
    â”‚   â”œâ”€â”€ create-your-own-ui/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ store.ts
    â”‚   â”‚       â”œâ”€â”€ types.tsx
    â”‚   â”‚       â”œâ”€â”€ utils.ts
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â”œâ”€â”€ audio-preview.tsx
    â”‚   â”‚           â”œâ”€â”€ custom-rtk-meeting.tsx
    â”‚   â”‚           â”œâ”€â”€ in-meeting.tsx
    â”‚   â”‚           â”œâ”€â”€ media-preview-modal.tsx
    â”‚   â”‚           â”œâ”€â”€ meeting-control-bar.tsx
    â”‚   â”‚           â”œâ”€â”€ meeting-header.tsx
    â”‚   â”‚           â”œâ”€â”€ meeting-sidebar.tsx
    â”‚   â”‚           â”œâ”€â”€ setup-screen.tsx
    â”‚   â”‚           â””â”€â”€ video-preview.tsx
    â”‚   â”œâ”€â”€ default-meeting-ui/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â””â”€â”€ vite-env.d.ts
    â”‚   â”œâ”€â”€ facetime/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â””â”€â”€ Facetime.tsx
    â”‚   â”œâ”€â”€ live-auction/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .eslintrc.cjs
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â”œâ”€â”€ assets/
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.css
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ constants.ts
    â”‚   â”‚       â”œâ”€â”€ icons.json
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â”œâ”€â”€ components/
    â”‚   â”‚       â”‚   â”œâ”€â”€ index.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ auctionControlBar/
    â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ auctionControlBar.css
    â”‚   â”‚       â”‚   â”‚   â””â”€â”€ AuctionControlBar.tsx
    â”‚   â”‚       â”‚   â””â”€â”€ icon/
    â”‚   â”‚       â”‚       â”œâ”€â”€ icon.css
    â”‚   â”‚       â”‚       â””â”€â”€ Icon.tsx
    â”‚   â”‚       â””â”€â”€ pages/
    â”‚   â”‚           â”œâ”€â”€ index.ts
    â”‚   â”‚           â”œâ”€â”€ loading/
    â”‚   â”‚           â”‚   â”œâ”€â”€ loading.css
    â”‚   â”‚           â”‚   â””â”€â”€ Loading.tsx
    â”‚   â”‚           â”œâ”€â”€ meeting/
    â”‚   â”‚           â”‚   â”œâ”€â”€ meeting.css
    â”‚   â”‚           â”‚   â””â”€â”€ Meeting.tsx
    â”‚   â”‚           â””â”€â”€ setupScreen/
    â”‚   â”‚               â”œâ”€â”€ setupScreen.css
    â”‚   â”‚               â””â”€â”€ SetupScreen.tsx
    â”‚   â”œâ”€â”€ multi-meeting/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ Meeting.tsx
    â”‚   â”‚       â”œâ”€â”€ store.ts
    â”‚   â”‚       â”œâ”€â”€ types.ts
    â”‚   â”‚       â””â”€â”€ vite-env.d.ts
    â”‚   â”œâ”€â”€ multi-meeting-custom/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ Meeting.tsx
    â”‚   â”‚       â”œâ”€â”€ store.ts
    â”‚   â”‚       â”œâ”€â”€ types.ts
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â”œâ”€â”€ components/
    â”‚   â”‚       â”‚   â”œâ”€â”€ custom-rtk-meeting.tsx
    â”‚   â”‚       â”‚   â””â”€â”€ in-meeting.tsx
    â”‚   â”‚       â””â”€â”€ hooks/
    â”‚   â”‚           â””â”€â”€ useContainerSize.ts
    â”‚   â”œâ”€â”€ screenshare-focused-ui-with-custom-addons/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ global.css
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ rtk-state-listeners.tsx
    â”‚   â”‚       â”œâ”€â”€ types.tsx
    â”‚   â”‚       â”œâ”€â”€ utils.ts
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â”œâ”€â”€ components/
    â”‚   â”‚       â”‚   â”œâ”€â”€ audio-preview.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ custom-participant-tile.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ custom-rtk-grid.css
    â”‚   â”‚       â”‚   â”œâ”€â”€ custom-rtk-grid.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ custom-rtk-meeting.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ Dialog.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ EffectsManager.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ in-meeting.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ media-preview-modal.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ meeting-control-bar.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ meeting-header.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ meeting-loading.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ meeting-over.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ meeting-sidebar.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ ReactionsManager.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ setup-screen.tsx
    â”‚   â”‚       â”‚   â”œâ”€â”€ video-preview.tsx
    â”‚   â”‚       â”‚   â””â”€â”€ waiting-room.tsx
    â”‚   â”‚       â””â”€â”€ lib/
    â”‚   â”‚           â”œâ”€â”€ graceful-storage.ts
    â”‚   â”‚           â””â”€â”€ store.ts
    â”‚   â”œâ”€â”€ simple-group-call/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.cjs
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.cjs
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â”œâ”€â”€ vite-env.d.ts
    â”‚   â”‚       â””â”€â”€ components/
    â”‚   â”‚           â””â”€â”€ Meeting.tsx
    â”‚   â”œâ”€â”€ simple-ui/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ postcss.config.js
    â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.node.json
    â”‚   â”‚   â”œâ”€â”€ vite.config.ts
    â”‚   â”‚   â”œâ”€â”€ .gitignore
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ App.tsx
    â”‚   â”‚       â”œâ”€â”€ index.css
    â”‚   â”‚       â”œâ”€â”€ main.tsx
    â”‚   â”‚       â””â”€â”€ vite-env.d.ts
    â”‚   â””â”€â”€ with-background-transformer/
    â”‚       â”œâ”€â”€ README.md
    â”‚       â”œâ”€â”€ index.html
    â”‚       â”œâ”€â”€ package.json
    â”‚       â”œâ”€â”€ tsconfig.json
    â”‚       â”œâ”€â”€ tsconfig.node.json
    â”‚       â”œâ”€â”€ vite.config.ts
    â”‚       â”œâ”€â”€ .gitignore
    â”‚       â””â”€â”€ src/
    â”‚           â”œâ”€â”€ App.tsx
    â”‚           â”œâ”€â”€ index.css
    â”‚           â”œâ”€â”€ main.tsx
    â”‚           â””â”€â”€ vite-env.d.ts
    â””â”€â”€ .github/
        â”œâ”€â”€ ISSUE_TEMPLATE/
        â”‚   â”œâ”€â”€ new-ui-design-app-clone.md
        â”‚   â””â”€â”€ ui-update-to-existing-sample.md
        â””â”€â”€ workflows/
            â””â”€â”€ deploy.yml


================================================
FILE: README.md
================================================
# RealtimeKit React UI Kit Samples

> The contents of this repository have been moved to [cloudflare/realtimekit-web-examples](https://github.com/cloudflare/realtimekit-web-examples). Future updates and maintenance will continue there.

## Contents
1. [Introduction](#introduction)
2. [About This Repository](#about-this-repository)
3. [Setting Up the Project](#setting-up-the-project)
   - [Prerequisites](#prerequisites)
   - [Installation Steps](#installation-steps)
4. [Usage](#usage)
5. [Contributing](#contributing)
6. [License](#license)

## Introduction
RealtimeKit is a technology company specializing in real-time communication solutions. Our products are designed to enable seamless and efficient video interactions in various applications, ranging from virtual meetings to interactive live streaming. The offerings are known for their robust performance, scalability, and ease of integration.

## About This Repository
This repository consists of all the different ways in which you can use RealtimeKit's
React UI Kit and other packages to its full extent to get the best live
audio/video experience.

## Samples

Here are the list of available samples at the moment.

1. [Default Meeting UI](./samples/default-meeting-ui/)
2. [Using Background Transformer to modify your background](./samples/with-background-transformer/)
3. [Audio Room](./samples/audio-room/)
4. [Facetime](./samples/facetime/)
5. [Chat](./samples/chat/)
6. [Live Auction App](./samples/live-auction/)

## Usage

To use these samples you would need to do the following steps:

First, you'll need to create a meeting and add a participant to that meeting.

You can do so by going to https://docs.realtime.cloudflare.com/api?v=v2 and run the APIs in the
API runner itself so you can quickly get started.

Make sure you've created your RealtimeKit account at https://dev.realtime.cloudflare.com and have your
`Organization ID` and `API Key` ready to use from the
[API Keys section](https://dev.realtime.cloudflare.com/apikeys).

1. Go to
   [Create Meeting API](https://docs.realtime.cloudflare.com/api/?v=v2#/operations/create_meeting)
   and add your credentials and run the API with your request body, note the
   `id` you receive in resonse, this is the meeting id.
2. Go to
   [Add Participant API](https://docs.realtime.cloudflare.com/api/?v=v2#/operations/add_participant)
   and add a participant to the meeting with the `meetingId` you received in
   previous API call.

Once you're done, you'll get an `authToken`, which you can use in a sample as
explained below.

### Trying out a sample

Here are steps to try out the samples:

1. Clone the repo:

```sh
git clone git@github.com:dyte-io/react-samples.git
```

2. Change directory to the sample you want to try, for example: in
   `default-meeting-ui`:

```sh
cd samples/default-meeting-ui
```

3. Install the packages with your preferred package manager and start a
   development server and open up the page.

```sh
npm install
# and to start a dev server
npm run dev
```

4. Load the dev server in your browser and make sure you pass the `authToken`
   query in the URL.

```
http://localhost:5173/?authToken=<your-token>
```



================================================
FILE: index.html
================================================
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React Samples - Cloudflare Realtime Kit</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5; /* Light gray background */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding-top: 40px; /* Add some padding at the top */
        }
        #root {
            background-color: #ffffff; /* White card background */
            padding: 30px 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 700px;
        }
        h1 {
            color: #f38020; /* Cloudflare Orange */
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
        }
        ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        li {
            margin-bottom: 15px;
            border-bottom: 1px solid #e0e0e0; /* Light separator line */
            padding-bottom: 15px;
        }
        li:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        a {
            text-decoration: none;
            color: #0053a0; /* Cloudflare Blue */
            font-size: 18px;
            font-weight: 500;
            display: block; /* Make the whole area clickable */
            padding: 8px 0;
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        a:hover {
            color: #f38020; /* Cloudflare Orange on hover */
            transform: translateX(5px);
        }
        /* Responsive adjustments */
        @media (max-width: 600px) {
            #root {
                padding: 20px;
            }
            h1 {
                font-size: 24px;
            }
            a {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <h1>Cloudflare Realtime Kit React Samples</h1>
        <ul>
            <li><a href="/samples/active-speaker-ui/dist">Active Speaker UI</a></li>
            <li><a href="/samples/async-video-survey/dist">Async Video Survey</a></li>
            <li><a href="/samples/audio-room/dist">Audio Room</a></li>
            <li><a href="/samples/chat/dist">Chat</a></li>
            <li><a href="/samples/chat-widget/dist">Chat Widget</a></li>
            <li><a href="/samples/clubhouse/dist">Clubhouse</a></li>
            <li><a href="/samples/create-your-own-ui/dist">Create Your Own UI</a></li>
            <li><a href="/samples/default-meeting-ui/dist">Default Meeting UI</a></li>
            <li><a href="/samples/facetime/dist">Facetime</a></li>
            <li><a href="/samples/live-auction/dist">Live Auction</a></li>
            <li><a href="/samples/back-to-back-meetings/dist">Back-to-Back Meetings</a></li>
            <li><a href="/samples/multi-meeting/dist">Multiple Meeting UI</a></li>
            <li><a href="/samples/multi-meeting-custom/dist">Multiple Meeting UI with Custom UI</a></li>
            <li><a href="/samples/screenshare-focused-ui-with-custom-addons/dist">Screenshare Focused UI with Custom Addons</a></li>
            <li><a href="/samples/simple-group-call/dist">Simple Group Call</a></li>
            <li><a href="/samples/simple-ui/dist">Simple UI</a></li>
            <li><a href="/samples/with-background-transformer/dist">With Background Transformer</a></li>
        </ul>
    </div>
</body>
</html>


================================================
FILE: LICENSE
================================================
                                 Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

      "License" shall mean the terms and conditions for use, reproduction,
      and distribution as defined by Sections 1 through 9 of this document.

      "Licensor" shall mean the copyright owner or entity authorized by
      the copyright owner that is granting the License.

      "Legal Entity" shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under common
      control with that entity. For the purposes of this definition,
      "control" means (i) the power, direct or indirect, to cause the
      direction or management of such entity, whether by contract or
      otherwise, or (ii) ownership of fifty percent (50%) or more of the
      outstanding shares, or (iii) beneficial ownership of such entity.

      "You" (or "Your") shall mean an individual or Legal Entity
      exercising permissions granted by this License.

      "Source" form shall mean the preferred form for making modifications,
      including but not limited to software source code, documentation
      source, and configuration files.

      "Object" form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

      "Work" shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

      "Derivative Works" shall mean any work, whether in Source or Object
      form, that is based on (or derived from) the Work and for which the
      editorial revisions, annotations, elaborations, or other modifications
      represent, as a whole, an original work of authorship. For the purposes
      of this License, Derivative Works shall not include works that remain
      separable from, or merely link (or bind by name) to the interfaces of,
      the Work and Derivative Works thereof.

      "Contribution" shall mean any work of authorship, including
      the original version of the Work and any modifications or additions
      to that Work or Derivative Works thereof, that is intentionally
      submitted to Licensor for inclusion in the Work by the copyright owner
      or by an individual or Legal Entity authorized to submit on behalf of
      the copyright owner. For the purposes of this definition, "submitted"
      means any form of electronic, verbal, or written communication sent
      to the Licensor or its representatives, including but not limited to
      communication on electronic mailing lists, source code control systems,
      and issue tracking systems that are managed by, or on behalf of, the
      Licensor for the purpose of discussing and improving the Work, but
      excluding communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as "Not a Contribution."

      "Contributor" shall mean Licensor and any individual or Legal Entity
      on behalf of whom a Contribution has been received by Licensor and
      subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      copyright license to reproduce, prepare Derivative Works of,
      publicly display, publicly perform, sublicense, and distribute the
      Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have made,
      use, offer to sell, sell, import, and otherwise transfer the Work,
      where such license applies only to those patent claims licensable
      by such Contributor that are necessarily infringed by their
      Contribution(s) alone or by combination of their Contribution(s)
      with the Work to which such Contribution(s) was submitted. If You
      institute patent litigation against any entity (including a
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      or a Contribution incorporated within the Work constitutes direct
      or contributory patent infringement, then any patent licenses
      granted to You under this License for that Work shall terminate
      as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

      (a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

      (b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

      (c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of
          the Derivative Works; and

      (d) If the Work includes a "NOTICE" text file as part of its
          distribution, then any Derivative Works that You distribute must
          include a readable copy of the attribution notices contained
          within such NOTICE file, excluding those notices that do not
          pertain to any part of the Derivative Works, in at least one
          of the following places: within a NOTICE text file distributed
          as part of the Derivative Works; within the Source form or
          documentation, if provided along with the Derivative Works; or,
          within a display generated by the Derivative Works, if and
          wherever such third-party notices normally appear. The contents
          of the NOTICE file are for informational purposes only and
          do not modify the License. You may add Your own attribution
          notices within Derivative Works that You distribute, alongside
          or as an addendum to the NOTICE text from the Work, provided
          that such additional attribution notices cannot be construed
          as modifying the License.

      You may add Your own copyright statement to Your modifications and
      may provide additional or different license terms and conditions
      for use, reproduction, or distribution of Your modifications, or
      for any such Derivative Works as a whole, provided Your use,
      reproduction, and distribution of the Work otherwise complies with
      the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
      any Contribution intentionally submitted for inclusion in the Work
      by You to the Licensor shall be under the terms and conditions of
      this License, without any additional terms or conditions.
      Notwithstanding the above, nothing herein shall supersede or modify
      the terms of any separate license agreement you may have executed
      with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
      names, trademarks, service marks, or product names of the Licensor,
      except as required for reasonable and customary use in describing the
      origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or conditions
      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
      PARTICULAR PURPOSE. You are solely responsible for determining the
      appropriateness of using or redistributing the Work and assume any
      risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and grossly
      negligent acts) or agreed to in writing, shall any Contributor be
      liable to You for damages, including any direct, indirect, special,
      incidental, or consequential damages of any character arising as a
      result of this License or out of the use or inability to use the
      Work (including but not limited to damages for loss of goodwill,
      work stoppage, computer failure or malfunction, or any and all
      other commercial damages or losses), even if such Contributor
      has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by reason
      of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

      To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets "[]"
      replaced with your own identifying information. (Don't include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same "printed page" as the copyright notice for easier
      identification within third-party archives.

   Copyright [yyyy] [name of copyright owner]

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.



================================================
FILE: package.json
================================================
{
  "private": true,
  "workspaces": [
    "samples/*"
  ],
  "scripts": {
    "update-cloudflare-realtime-deps": "./update-cloudflare-realtime-deps.sh",
    "build": "npm run build --workspaces --if-present && npm run postbuild",
    "postbuild": "./postbuild.sh",
    "format": "prettier -w .",
    "deploy": "wrangler pages deploy ./dist"
  },
  "devDependencies": {
    "prettier": "^2.8.0",
    "wrangler": "^4.19.2"
  },
  "prettier": {
    "singleQuote": true,
    "proseWrap": "always"
  }
}



================================================
FILE: postbuild.sh
================================================
#!/bin/bash

# Exit immediately if a command exits with a non-zero status.
set -e

# Define the root directory for output and source samples
OUTPUT_DIR="dist"
SAMPLES_DIR="samples"

echo "Starting postbuild script..."

# Clean and create the main output directory
echo "Preparing output directory: $OUTPUT_DIR"
rm -rf "$OUTPUT_DIR"
mkdir -p "$OUTPUT_DIR"

# Loop through each directory in the samples directory
# Using find to be more robust with names and ensure we only get directories
find "$SAMPLES_DIR" -mindepth 1 -maxdepth 1 -type d | while read sample_dir_path; do
    sample_name=$(basename "$sample_dir_path")
    source_dist_path="$sample_dir_path/dist"
    destination_sample_path="$OUTPUT_DIR/$sample_name"

    # Check if the dist subdirectory exists within the sample directory
    if [ -d "$source_dist_path" ]; then
        echo "Found $source_dist_path for sample: $sample_name"
        echo "Moving $source_dist_path to $destination_sample_path"
        # Move the samples/sample_name/dist directory to dist/sample_name
        cp -r "$source_dist_path" "$destination_sample_path"
    else
        echo "No dist directory found in $sample_dir_path (for sample $sample_name). Skipping."
    fi
done

# Copy and modify the main index.html to the root of the OUTPUT_DIR
ROOT_INDEX_HTML_SOURCE="index.html"
ROOT_INDEX_HTML_DEST="$OUTPUT_DIR/index.html"

if [ -f "$ROOT_INDEX_HTML_SOURCE" ]; then
    echo "Copying $ROOT_INDEX_HTML_SOURCE to $ROOT_INDEX_HTML_DEST"
    cp "$ROOT_INDEX_HTML_SOURCE" "$ROOT_INDEX_HTML_DEST"

    echo "Updating links in $ROOT_INDEX_HTML_DEST"
    # Modify links from href="/samples/sample-name/dist" to href="/sample-name/"
    # Using a temporary file for sed in-place editing for compatibility (e.g. macOS sed)
    sed -i.bak 's|href="/samples/\([^/"]*\)/dist"|href="/\1/"|g' "$ROOT_INDEX_HTML_DEST"
    rm -f "${ROOT_INDEX_HTML_DEST}.bak" # Remove backup file created by sed -i
    echo "Links updated in $ROOT_INDEX_HTML_DEST"
else
    echo "Warning: $ROOT_INDEX_HTML_SOURCE not found in the root directory."
fi

echo "Postbuild script finished successfully."



================================================
FILE: update-cloudflare-realtime-deps.sh
================================================
#!/bin/bash

# Script to install dependencies and update RealtimeKit packages in all samples
# Exits on first error to prevent cascading failures

set -e  # Exit on any error

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Function to print colored output
print_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Check for jq
if ! command -v jq &> /dev/null; then
    echo "jq is required but not installed. Please install jq and rerun the script."
    exit 1
fi

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SAMPLES_DIR="$SCRIPT_DIR/samples"

# Get latest package versions
print_info "Fetching latest package versions..."
REALTIMEKIT_VERSION=$(npm view "@cloudflare/realtimekit" version 2>/dev/null || echo "1.1.5")
REALTIMEKIT_REACT_VERSION=$(npm view "@cloudflare/realtimekit-react" version 2>/dev/null || echo "1.1.5")
REALTIMEKIT_REACT_UI_VERSION=$(npm view "@cloudflare/realtimekit-react-ui" version 2>/dev/null || echo "1.0.4")
REALTIMEKIT_UI_VERSION=$(npm view "@cloudflare/realtimekit-ui" version 2>/dev/null || echo "1.0.4")
REALTIMEKIT_UI_ADDONS_VERSION=$(npm view "@cloudflare/realtimekit-ui-addons" version 2>/dev/null || echo "0.0.4")

print_info "Using versions:"
echo "  @cloudflare/realtimekit: $REALTIMEKIT_VERSION"
echo "  @cloudflare/realtimekit-react: $REALTIMEKIT_REACT_VERSION"
echo "  @cloudflare/realtimekit-react-ui: $REALTIMEKIT_REACT_UI_VERSION"
echo "  @cloudflare/realtimekit-ui: $REALTIMEKIT_UI_VERSION"
echo "  @cloudflare/realtimekit-ui-addons: $REALTIMEKIT_UI_ADDONS_VERSION"

print_info "Before starting update process, removing node_modules & package-lock.json from root directory..."
rm -rf node_modules package-lock.json

print_info "Nuking NPM Cache due to trust issues..."
npm cache clean --force

print_info "Installing dependencies in all sample repositories..."

# Process each sample directory
for sample_dir in "$SAMPLES_DIR"/*; do
    if [ -d "$sample_dir" ] && [ -f "$sample_dir/package.json" ]; then
        sample_name=$(basename "$sample_dir")
        echo ""
        print_info "=== Processing $sample_name ==="
        
        cd "$sample_dir" || {
            print_error "Failed to enter directory $sample_dir"
            exit 1
        }
        
        # Clean install - remove node_modules
        print_info "Cleaning node_modules in $sample_name..."
        rm -rf node_modules
        
        # Ensure all required RealtimeKit packages are present in package.json
        print_info "Ensuring all RealtimeKit packages are present in $sample_name..."
        
        # Function to add package if not present
        add_package_if_missing() {
            local package_name="$1"
            local package_version="$2"
            if ! jq -e ".dependencies[\"$package_name\"]" package.json > /dev/null; then
                print_info "Adding missing package: $package_name"
                jq ".dependencies[\"$package_name\"] = \"^$package_version\"" package.json > package.json.tmp && mv package.json.tmp package.json
            fi
        }
        
        # Add missing packages
        add_package_if_missing "@cloudflare/realtimekit" "$REALTIMEKIT_VERSION"
        add_package_if_missing "@cloudflare/realtimekit-react" "$REALTIMEKIT_REACT_VERSION"
        add_package_if_missing "@cloudflare/realtimekit-react-ui" "$REALTIMEKIT_REACT_UI_VERSION"
        add_package_if_missing "@cloudflare/realtimekit-ui" "$REALTIMEKIT_UI_VERSION"
        add_package_if_missing "@cloudflare/realtimekit-ui-addons" "$REALTIMEKIT_UI_ADDONS_VERSION"
        
        # Update package.json versions
        print_info "Updating package.json versions in $sample_name..."
        
        # Update RealtimeKit packages in package.json
        if grep -q "@cloudflare/realtimekit\"" package.json; then
            print_info "Updating @cloudflare/realtimekit version in package.json..."
            sed -i '' "s/\"@cloudflare\/realtimekit\": \"[\^~]*[^\"]*\"/\"@cloudflare\/realtimekit\": \"^$REALTIMEKIT_VERSION\"/g" package.json
        fi
        
        if grep -q "@cloudflare/realtimekit-react\"" package.json; then
            print_info "Updating @cloudflare/realtimekit-react version in package.json..."
            sed -i '' "s/\"@cloudflare\/realtimekit-react\": \"[\^~]*[^\"]*\"/\"@cloudflare\/realtimekit-react\": \"^$REALTIMEKIT_REACT_VERSION\"/g" package.json
        fi
        
        if grep -q "@cloudflare/realtimekit-react-ui\"" package.json; then
            print_info "Updating @cloudflare/realtimekit-react-ui version in package.json..."
            sed -i '' "s/\"@cloudflare\/realtimekit-react-ui\": \"[\^~]*[^\"]*\"/\"@cloudflare\/realtimekit-react-ui\": \"^$REALTIMEKIT_REACT_UI_VERSION\"/g" package.json
        fi
        
        if grep -q "@cloudflare/realtimekit-ui\"" package.json; then
            print_info "Updating @cloudflare/realtimekit-ui version in package.json..."
            sed -i '' "s/\"@cloudflare\/realtimekit-ui\": \"[\^~]*[^\"]*\"/\"@cloudflare\/realtimekit-ui\": \"^$REALTIMEKIT_UI_VERSION\"/g" package.json
        fi
        
        if grep -q "@cloudflare/realtimekit-ui-addons\"" package.json; then
            print_info "Updating @cloudflare/realtimekit-ui-addons version in package.json..."
            sed -i '' "s/\"@cloudflare\/realtimekit-ui-addons\": \"[\^~]*[^\"]*\"/\"@cloudflare\/realtimekit-ui-addons\": \"^$REALTIMEKIT_UI_ADDONS_VERSION\"/g" package.json
        fi

        # Single npm install after updating all versions
        print_info "Installing all dependencies in $sample_name..."
        if ! npm install --legacy-peer-deps --no-workspaces; then
            print_error "Failed to install dependencies in $sample_name"
            exit 1
        fi
        
        cd - > /dev/null
        print_success "âœ“ Completed $sample_name"
    fi
done

echo ""
print_success "ðŸŽ‰ All samples processed successfully!"



================================================
FILE: upgrade-to-rtk.sh
================================================
npx @dytesdk/upgrade-to-rtk .
for dir in samples/*; do (cd "$dir" && npm run build); done



================================================
FILE: wrangler.jsonc
================================================
{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "react-samples",
    "pages_build_output_dir": "dist"
}


================================================
FILE: samples/active-speaker-ui/README.md
================================================
# Active Speaker UI Sample

This sample showcases how you can build a UI to display only the active speaker while screenshare in an webinar meeting with RealtimeKit's React UI Kit!

---

![A screenshot of the component](./screenshot.png)

[See source](./src/App.tsx)



================================================
FILE: samples/active-speaker-ui/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Active Speaker UI</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/active-speaker-ui/package.json
================================================
{
  "name": "active-speaker-ui",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "clsx": "^2.1.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^4.4.7"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/active-speaker-ui/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/active-speaker-ui/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./index.html', './src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
};



================================================
FILE: samples/active-speaker-ui/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/active-speaker-ui/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/active-speaker-ui/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/active-speaker-ui/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/active-speaker-ui/src/App.tsx
================================================
import Meeting from './components/Meeting';
import { RtkSpinner, RtkUiProvider } from '@cloudflare/realtimekit-react-ui';
import { RealtimeKitProvider, useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import { useEffect } from 'react';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URLSearchParams(window.location.search);

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }
    const baseURI = searchParams.get("baseURI") ?? "realtime.cloudflare.com";

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
      baseURI,
    }).then((meeting) => {
      Object.assign(window, { meeting });
    });
  }, []);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider
      value={meeting}
      fallback={
        <div className="size-full flex flex-col gap-3 place-items-center justify-center">
          <RtkSpinner className="w-12 h-12 text-blue-600" />
          <p className="text-lg">Joining...</p>
        </div>
      }
    >
      <RtkUiProvider meeting={meeting} showSetupScreen>
        <Meeting />
      </RtkUiProvider>
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/active-speaker-ui/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    height: 100%;
  }

  body {
    color: #fff;
    background: #000;
  }

  * {
    border-color: theme(colors.zinc.700);
  }

  /* width */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
    border-radius: 10px;
  }

  /* Track */
  ::-webkit-scrollbar-track {
    border-radius: 10px;
    background: theme(colors.zinc.1000);
  }

  /* Handle */
  ::-webkit-scrollbar-thumb {
    border-radius: 10px;
    background: theme(colors.zinc.900);
    
  }
}



================================================
FILE: samples/active-speaker-ui/src/main.tsx
================================================
import App from './App';
import './index.css';
import { provideRtkDesignSystem } from '@cloudflare/realtimekit-react-ui';
import ReactDOM from 'react-dom/client';

provideRtkDesignSystem(document.body, {
  theme: 'darkest',
});

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/active-speaker-ui/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/active-speaker-ui/src/components/ActiveSpeaker.tsx
================================================
import { useMeetingStore } from '../lib/meeting-store';
import { useActiveSpeaker } from '../lib/useActiveSpeaker';
import { RtkParticipantTile } from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
import { HTMLAttributes } from 'react';

export default function ActiveSpeaker(
  props: Omit<HTMLAttributes<HTMLRtkParticipantTileElement>, 'style'> & {
    isSmall?: true;
  }
) {
  const activeSpeaker = useActiveSpeaker();
  const { meeting } = useRealtimeKitMeeting();
  const [size, states] = useMeetingStore((s) => [s.size, s.states]);
  const isActiveMode = useMeetingStore((s) => s.isActiveSpeakerMode);

  if (!activeSpeaker || !isActiveMode) return null;

  return (
    <RtkParticipantTile
      participant={activeSpeaker}
      meeting={meeting}
      size={props.isSmall ? 'sm' : size}
      states={states}
      {...props}
    />
  );
}



================================================
FILE: samples/active-speaker-ui/src/components/Controlbar.tsx
================================================
import { useMeetingStore } from '../lib/meeting-store';
import {
  RtkSettingsToggle,
  RtkScreenShareToggle,
  RtkStageToggle,
  RtkMicToggle,
  RtkCameraToggle,
  RtkParticipantsToggle,
  RtkPollsToggle,
  RtkChatToggle,
  RtkPluginsToggle,
  RtkControlbarButton,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import HOST_PRESET, { iconPack, saveWhiteboard, WHITEBOARD_ID } from '../lib/const';

export default function Controlbar() {
  const { meeting } = useRealtimeKitMeeting();
  const size = useMeetingStore((s) => s.size);
  const isMobile = useMeetingStore((s) => s.isMobile);
  const states = useMeetingStore((s) => s.states);
  const isDarkMode = useMeetingStore((s) => s.darkMode);
  const toggleDarkMode = useMeetingStore((s) => s.toggleDarkMode);
  const setStates = useMeetingStore((s) => s.setStates);
  const whiteboardPlugin = useRealtimeKitSelector(m => m.plugins.active.get(WHITEBOARD_ID)) 

  const buttonSize = size === 'lg' ? 'lg' : 'sm';

  const isHost = meeting.self.presetName === HOST_PRESET;

  const leaveMeeting = async () => {
    if (whiteboardPlugin?.active) {
      await saveWhiteboard(whiteboardPlugin);
    }
    setStates({
      activeLeaveConfirmation: true,
    })
  }

  const LeaveButton = () => {
    return (<RtkControlbarButton icon={iconPack.call_end} size={buttonSize} label='Leave' onClick={leaveMeeting}/>);
  }


  if (isMobile) {
    return (
      <>
        <div className="flex flex-col lg:flex-row items-center">
          {isHost && (
            <>
              <RtkParticipantsToggle
                meeting={meeting}
                size={buttonSize}
                states={states}
              />
              <RtkPluginsToggle
                meeting={meeting}
                size={buttonSize}
                states={states}
              />
            </>
          )}
          <RtkChatToggle meeting={meeting} size={buttonSize} states={states} />
          <RtkPollsToggle
            meeting={meeting}
            size={buttonSize}
            states={states}
          />
        </div>
        <div className="flex flex-col lg:flex-row items-center justify-center">
          <RtkMicToggle meeting={meeting} size={buttonSize} />
          <RtkCameraToggle meeting={meeting} size={buttonSize} />
          <RtkScreenShareToggle
            meeting={meeting}
            size={buttonSize}
            states={states}
          />
        </div>
        <div className="flex flex-col lg:flex-row items-center justify-end">
          <RtkStageToggle
            meeting={meeting}
            size={buttonSize}
            iconPack={iconPack}
          />
          <LeaveButton/>
          <RtkSettingsToggle size={buttonSize} states={states} />
        </div>
      </>
    );
  }

  return (
    <>
      <div className="flex flex-col lg:flex-row items-center">
        <RtkSettingsToggle size={buttonSize} states={states} />
        <RtkScreenShareToggle
          meeting={meeting}
          size={buttonSize}
          states={states}
        />
        {
          isHost 
          && <RtkControlbarButton
              icon={isDarkMode ? iconPack.dark : iconPack.light}
              label= {isDarkMode ? 'Dark' : 'Light'}
              title='Toggles theme for the active plugin for now'
              onClick={() => {
                toggleDarkMode(!isDarkMode);
              }}
            />
        }
      </div>
      <div className="flex flex-col lg:flex-row items-center justify-center">
        <RtkStageToggle
          meeting={meeting}
          size={buttonSize}
          iconPack={iconPack}
        />
        <RtkMicToggle meeting={meeting} size={buttonSize} />
        <RtkCameraToggle meeting={meeting} size={buttonSize} />
        <LeaveButton />
      </div>
      <div className="flex flex-col lg:flex-row items-center justify-end">
        {isHost && (
          <>
            <RtkParticipantsToggle
              meeting={meeting}
              size={buttonSize}
              states={states}
            />
            <RtkPluginsToggle
              meeting={meeting}
              size={buttonSize}
              states={states}
            />
          </>
        )}
        <RtkChatToggle meeting={meeting} size={buttonSize} states={states} />
        <RtkPollsToggle meeting={meeting} size={buttonSize} states={states} />
      </div>
    </>
  );
}



================================================
FILE: samples/active-speaker-ui/src/components/Grid.tsx
================================================
import { useMeetingStore } from '../lib/meeting-store';
import {
  RtkGrid,
  RtkSimpleGrid,
  RtkSpotlightGrid,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';

export default function Grid() {
  const { meeting } = useRealtimeKitMeeting();

  const size = useMeetingStore((s) => s.size);
  const stageStatus = useRealtimeKitSelector((m) => m.stage.status);
  const isPinned = useRealtimeKitSelector((m) => m.self.isPinned);

  const activeParticipants = useRealtimeKitSelector((m) =>
    m.participants.active.toArray()
  );

  const participants =
    stageStatus === 'ON_STAGE' && !isPinned
      ? [...activeParticipants, meeting.self]
      : activeParticipants;

  const pinned = useRealtimeKitSelector((m) => m.participants.pinned.toArray());

  const pinnedParticipants =
    isPinned && stageStatus === 'ON_STAGE' ? [...pinned, meeting.self] : pinned;

  if (pinnedParticipants.length > 0) {
    return (
      <RtkSpotlightGrid
        participants={participants}
        pinnedParticipants={pinnedParticipants}
        meeting={meeting}
        size={size}
      />
    );
  }

  return (<RtkSimpleGrid participants={participants} meeting={meeting} size={size} />);
}



================================================
FILE: samples/active-speaker-ui/src/components/MainArea.tsx
================================================
import { useMeetingStore } from '../lib/meeting-store';
import ActiveSpeaker from './ActiveSpeaker';
import ScreenShareView from './ScreenShareView';
import {
  RtkIcon,
  RtkPluginMain,
  RtkSimpleGrid,
  RtkButton,
  RtkSpotlightGrid,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import type { RTKParticipant, RTKPlugin, RTKSelf } from '@cloudflare/realtimekit';
import clsx from 'clsx';
import { useState, useEffect, useRef } from 'react';
import HOST_PRESET, { iconPack, saveWhiteboard, WHITEBOARD_ID } from '../lib/const';

type ActiveTab =
  | { type: 'plugin'; plugin: RTKPlugin }
  | { type: 'screenshare'; participant: RTKParticipant | RTKSelf };

function ActiveSpeakerView({
  screenshares,
  plugins,
}: {
  screenshares: (RTKParticipant | RTKSelf)[];
  plugins: RTKPlugin[];
}) {
  const { meeting } = useRealtimeKitMeeting();

  const [selectedTab, setSelectedTab] = useState<ActiveTab>();
  const pluginsRef = useRef<RTKPlugin[]>([]);
  const screensharesRef = useRef<(RTKParticipant | RTKSelf)[]>([]);

  const showTabBar = screenshares.length + plugins.length > 1;

  const size = useMeetingStore((s) => s.size);
  const whiteboardPlugin = useRealtimeKitSelector(m => m.plugins.active.get(WHITEBOARD_ID)) 
  const [states, setStates] = useMeetingStore((s) => [s.states, s.setStates]);

  const activeTab = useRealtimeKitSelector((m) => m.meta.selfActiveTab);
  const isHost = meeting.self.presetName === HOST_PRESET;
  const isDarkMode = useMeetingStore((s) => s.darkMode);

  useEffect(() => {
    if (activeTab) {
      if (activeTab.type === 'plugin') {
        const plugin = meeting.plugins.active.get(activeTab.id);

        if (plugin) {
          setSelectedTab({
            type: 'plugin',
            plugin,
          });
        }
      } else {
        const participant = meeting.participants.joined.get(activeTab.id);

        if (participant) {
          setSelectedTab({
            type: 'screenshare',
            participant,
          });
        }
      }
    }
  }, [activeTab]);

  const onFallback = () => {
    if (screenshares.length > 0) {
      setSelectedTab({ type: 'screenshare', participant: screenshares[0] });
    } else if (plugins.length > 0) {
      setSelectedTab({ type: 'plugin', plugin: plugins[0] });
    }
  };

  useEffect(() => {
    if (screenshares.length > screensharesRef.current.length) {
      setActiveTab({
        type: 'screenshare',
        participant: screenshares.at(-1)!,
      });
    }
    screensharesRef.current = screenshares;
  }, [screenshares]);

  useEffect(() => {
    if (plugins.length > pluginsRef.current.length) {
      setActiveTab({
        type: 'plugin',
        plugin: plugins.at(-1)!,
      });
    }
    pluginsRef.current = plugins;
  }, [plugins]);

  useEffect(() => {
    if (selectedTab) return;
    onFallback();
  }, [selectedTab]);

  useEffect(() => {
    if (!selectedTab) return;

    if (
      selectedTab.type === 'screenshare' &&
      !screenshares.find((s) => s.id === selectedTab.participant.id)
    ) {
      onFallback();
    }

    if (
      selectedTab.type === 'plugin' &&
      !plugins.find((p) => p.id === selectedTab.plugin.id)
    ) {
      onFallback();
    }
  }, [screenshares, plugins]);

  const setActiveTab = (tab: ActiveTab) => {
    if (meeting.self.permissions.canSpotlight) {
      meeting.meta.setSelfActiveTab(
        {
          type: tab.type,
          id: tab.type === 'plugin' ? tab.plugin.id : tab.participant.id,
        },
        0
      );
    }
    setSelectedTab(tab);
  };

  const setConfig = () => {
    const hostId = 
      isHost
      ? meeting.self.id
      : meeting.participants.joined.toArray().find(x => x.presetName === HOST_PRESET)?.id;

    whiteboardPlugin?.sendData({
      eventName: 'config',
      data: {
        eventName: 'config',
        follow: hostId,
        role: isHost ? 'editor' : 'viewer',
        infiniteCanvas: false,
        darkMode: isDarkMode,
        exportMode: 'pdf', 
      }
    })
  }

  // NOTE(ishita1805): Set whiteboard config on launch 
  useEffect(() => {
    if (!whiteboardPlugin) return;
    setConfig();
    whiteboardPlugin.on('ready', setConfig);
    return () => {
      whiteboardPlugin.off('ready', setConfig);
    }
  }, [whiteboardPlugin])

  // NOTE(ishita1805): Update whiteboard config when dark mode is toggled
  useEffect(() => {
    setConfig();
  }, [isDarkMode])

  // NOTE(ishita1805): Save whiteboard before closing
  const closePlugin = async (plugin: RTKPlugin) => {
    if (plugin.id === whiteboardPlugin?.id) {
      await saveWhiteboard(whiteboardPlugin);
    }
    plugin.deactivate();
  }
  

  return (
    <div className="size-full flex flex-col gap-2">
      {showTabBar && (
        <div className="h-8 flex items-center text-xs overflow-x-auto max-w-full w-full overflow-y-hidden">
          <div className="flex items-center gap-1.5">
            {screenshares.map((participant) => (
              <button
                className={clsx(
                  'h-8 !min-w-fit flex items-center justify-center gap-1.5 p-1 rounded-sm',
                  selectedTab?.type === 'screenshare' &&
                    selectedTab.participant.id === participant.id
                    ? 'bg-blue-600'
                    : 'bg-zinc-800'
                )}
                key={participant.id}
                onClick={() =>
                  setActiveTab({ type: 'screenshare', participant })
                }
              >
                <RtkIcon size='md' icon={iconPack.share_screen_person} />
                <span>{participant.name}</span>
              </button>
            ))}

            {plugins.map((plugin) => (
              <button
                className={clsx(
                  'h-8 flex !min-w-fit  items-center justify-center gap-1.5 p-1 rounded-sm',
                  selectedTab?.type === 'plugin' &&
                    selectedTab.plugin.id === plugin.id
                    ? 'bg-blue-600'
                    : 'bg-zinc-800'
                )}
                key={plugin.id}
                onClick={() => setActiveTab({ type: 'plugin', plugin })}
              >
                <img className="h-6 w-6 rounded-sm" src={plugin.picture} />
                <span>{plugin.name}</span>
              </button>
            ))}
          </div>
        </div>
      )}
      {selectedTab?.type === 'screenshare' &&
        'audioEnabled' in selectedTab.participant && (
          <ScreenShareView participant={selectedTab.participant} />
        )}
      {plugins.map((plugin) => (
        <div
          className={clsx(
            'flex-1 isolate relative',
            selectedTab?.type === 'plugin' &&
              selectedTab.plugin.id === plugin.id
              ? 'block'
              : 'hidden'
          )}
          key={plugin.id}
        >
          <div className={clsx(
            'absolute flex row w-full p-1 px-2 rounded-t-lg text-sm rounded-none bg-zinc-900 overflow-hidden items-center justify-between'
          )}>
            {plugin.name}
            <div className={clsx(
              'cursor-pointer bg-blue-600 rounded-full p-[2px] flex items-center justify-center'
            )} >
            <RtkIcon icon={iconPack.dismiss} size='sm' onClick={() => closePlugin(plugin)} />
            </div>
          </div>
          <RtkPluginMain meeting={meeting} plugin={plugin} />

          {states.activeSidebar && (
            <RtkButton
              size={size}
              variant="secondary"
              kind="icon"
              className="absolute bottom-3 right-3 z-40"
              onClick={() => {
                setStates({ activeSidebar: false, sidebar: undefined });
              }}
            >
              <RtkIcon icon={iconPack.full_screen_maximize} />
            </RtkButton>
          )}
        </div>
      ))}
    </div>
  );
}

export default function MainArea() {
  const { meeting } = useRealtimeKitMeeting();
  const screenShareEnabled = useRealtimeKitSelector((m) => m.self.screenShareEnabled);
  const stageStatus = useRealtimeKitSelector((m) => m.stage.status);

  const activeParticipants = useRealtimeKitSelector((m) =>
    m.participants.active.toArray()
  );

  const isPinned = useRealtimeKitSelector((m) => m.self.isPinned);

  const pinned = useRealtimeKitSelector((m) => m.participants.pinned.toArray());

  const participants =
    stageStatus === 'ON_STAGE' && !meeting.self.hidden
      ? [...activeParticipants, meeting.self]
      : activeParticipants;

  const activePlugins = useRealtimeKitSelector((m) => m.plugins.active.toArray());

  const joinedParticipants = useRealtimeKitSelector((m) =>
    m.participants.joined.toArray()
  );

  const pinnedParticipants =
    isPinned && stageStatus === 'ON_STAGE' ? [...pinned, meeting.self] : pinned;

  const activeScreenShares = joinedParticipants.filter(
    (p) => p.screenShareEnabled
  );

  const screenshares = screenShareEnabled
    ? [...activeScreenShares, meeting.self]
    : activeScreenShares;

  const isActiveView = screenshares.length + activePlugins.length > 0;

  const setActiveMode = useMeetingStore((s) => s.setIsActiveSpeakerMode);
  const isMobile = useMeetingStore((s) => s.isMobile);
  const isHost = meeting.self.presetName === HOST_PRESET;
  const isEmptyStage = participants.length === 0;

  useEffect(() => {
    setActiveMode(isActiveView);
  }, [isActiveView]);

  return (
    <div className="flex flex-col w-full h-full max-w-full p-2">
      {isEmptyStage ? (
        <div className="flex box-border h-full content-center items-center justify-center text-center">
            <div className="center">
              {isHost && (
                <div className="flex flex-col items-center">
                  <p className="text-text-lg bg-background-800 text-text-1000 rounded-lg px-8 py-4">
                    The stage is empty
                  </p>
                  <span className="text-text-md my-4">
                    { meeting.self.hidden ? 'You\'ve hidden your video tile. Unhide it to see yourself.': 'You are off stage.' }
                  </span>
                </div>
              )}
              {!isHost && (
                <div className="flex flex-col items-center">
                  <p className="text-text-lg bg-background-800 text-text-1000 rounded-lg px-8 py-4">
                    Waiting for the host to join
                  </p>
                </div>
              )}
            </div>
          </div>
      ): isActiveView ? (
        <ActiveSpeakerView
          screenshares={screenshares}
          plugins={activePlugins}
        />
      ) : (pinnedParticipants.length > 0 ? (
        <RtkSpotlightGrid
          participants={participants}
          pinnedParticipants={pinnedParticipants}
          meeting={meeting}
        />
      ): <RtkSimpleGrid participants={participants} meeting={meeting} />)}
      {isMobile && (
        <ActiveSpeaker
          className="absolute bottom-3 left-3 w-24 z-50 h-auto aspect-square"
          isSmall
        />
      )}
    </div>
  );
}



================================================
FILE: samples/active-speaker-ui/src/components/Meeting.tsx
================================================
import { useMeetingStore } from '../lib/meeting-store';
import Controlbar from './Controlbar';
import MainArea from './MainArea';
import Sidebar from './Sidebar';
import {
  RtkDialogManager,
  RtkEndedScreen,
  RtkNotifications,
  RtkParticipantsAudio,
  RtkSetupScreen,
  RtkSpinner,
  RtkWaitingScreen,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import { type States } from '@cloudflare/realtimekit-ui';
import { useEffect, useRef } from 'react';

function UI() {
  const { meeting } = useRealtimeKitMeeting();

  const isImmersiveMode = useMeetingStore((s) => s.isImmersiveMode);

  return (
    <div className="w-full h-full flex lg:flex-col">
      <div className="flex flex-1 h-full">
        <main className="flex-[2] relative">
          <MainArea />
          <RtkParticipantsAudio meeting={meeting} />
          <RtkNotifications
            meeting={meeting}
            config={{
              config: {
                notification_sounds: {
                  participant_joined: false,
                  participant_left: false,
                  chat: false,
                },
                notifications: {
                  participant_joined: false,
                  participant_left: false,
                  chat: false,
                },
              },
            }}
          />
        </main>

        {!isImmersiveMode && <Sidebar />}
      </div>
      <div className="grid p-2 pl-0 lg:pl-2 grid-rows-3 lg:grid-rows-1 lg:grid-cols-3 lg:pt-0">
        <Controlbar />
      </div>
    </div>
  );
}

export default function Meeting() {
  const $parent = useRef<HTMLDivElement>(null);
  const roomState = useRealtimeKitSelector((m) => m.self.roomState);
  const { meeting } = useRealtimeKitMeeting();

  const setDimensions = useMeetingStore((s) => s.setDimensions);
  const size = useMeetingStore((s) => s.size);

  const setStates = useMeetingStore((s) => s.setStates);
  const states = useMeetingStore((s) => s.states);

  useEffect(() => {
    const onStateUpdate = (e: CustomEvent<States>) => {
      setStates(e.detail);
    };

    $parent.current!.addEventListener('rtkStateUpdate', onStateUpdate as any);

    const observer = new ResizeObserver((entries) => {
      for (const entry of entries) {
        const { width, height } = entry.contentRect;
        setDimensions({ width, height });
      }
    });
    observer.observe($parent.current!);
    return () => {
      observer.disconnect();
      $parent.current!.removeEventListener(
        'rtkStateUpdate',
        onStateUpdate as any
      );
    };
  }, []);

  let children: JSX.Element;

  switch (roomState) {
    case 'init':
      children = <RtkSetupScreen meeting={meeting} />;
      break;
    case 'waitlisted':
      children = <RtkWaitingScreen meeting={meeting} />;
      break;
    case 'joined':
      children = <UI />;
      break;
    default:
      children = <RtkEndedScreen meeting={meeting} />;
      break;
  }

  return (
    <div className="w-full h-full bg-black" ref={$parent} data-size={size}>
      {children}
      <RtkDialogManager
        size={size === 'lg' ? 'lg' : 'sm'}
        meeting={meeting}
        states={states}
      />
    </div>
  );
}



================================================
FILE: samples/active-speaker-ui/src/components/ScreenShareView.tsx
================================================
import { useMeetingStore } from '../lib/meeting-store';
import {
  RtkAudioVisualizer,
  RtkButton,
  RtkIcon,
  RtkNameTag,
  RtkScreenshareView,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
import type { RTKParticipant, RTKSelf } from '@cloudflare/realtimekit';
import { iconPack } from '../lib/const';

export default function ScreenShareView({
  participant,
}: {
  participant: RTKSelf | RTKParticipant;
}) {
  const { meeting } = useRealtimeKitMeeting();
  const [states, setStates] = useMeetingStore((s) => [s.states, s.setStates]);

  const onMaximise = async () => {
    setStates({ activeSidebar: false, sidebar: undefined });
  };

  const isSelf = meeting.self.id === participant.id;

  return (
    <RtkScreenshareView
      meeting={meeting}
      participant={participant}
      className="flex-1 relative"
      // hidden default full screen button
      hideFullScreenButton
    >
      <RtkNameTag participant={participant} meeting={meeting} isScreenShare>
        <RtkAudioVisualizer
          participant={participant}
          isScreenShare
          slot="start"
        />
      </RtkNameTag>
      {/* custom full screen button that doesn't hide */}
      {states.activeSidebar && !isSelf && (
        <RtkButton
          variant="secondary"
          kind="icon"
          onClick={onMaximise}
          className="absolute bottom-3 right-3"
        >
          <RtkIcon icon={iconPack.full_screen_maximize} />
        </RtkButton>
      )}
    </RtkScreenshareView>
  );
}



================================================
FILE: samples/active-speaker-ui/src/components/Sidebar.tsx
================================================
import HOST_PRESET from '../lib/const';
import { useMeetingStore } from '../lib/meeting-store';
import ActiveSpeaker from './ActiveSpeaker';
import Grid from './Grid';
import {
  RtkParticipants,
  RtkPlugins,
  RtkPolls,
  RtkChat,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';

export default function Sidebar() {
  const { meeting } = useRealtimeKitMeeting();

  const isActiveMode = useMeetingStore((m) => m.isActiveSpeakerMode);

  const { states, isMobile } = useMeetingStore(({ states, isMobile }) => ({
    states,
    isMobile,
  }));

  let sidebar: JSX.Element | null = null;

  switch (states.sidebar) {
    case 'participants':
      sidebar = <RtkParticipants meeting={meeting} className="pt-3" />;
      break;
    case 'plugins':
      sidebar = <RtkPlugins meeting={meeting} />;
      break;
    case 'polls':
      sidebar = <RtkPolls meeting={meeting} className="m-0" />;
      break;
    case 'chat':
      sidebar = <RtkChat meeting={meeting} />;
      break;
  }

  const isHost = meeting.self.presetName === HOST_PRESET;

  if (isHost && !sidebar) {
    return null;
  }

  if (!isHost && !sidebar && !isActiveMode) {
    return null;
  }

  if (!isHost && !sidebar && isMobile) {
    return null;
  }

  return (
    <aside className="flex-1 lg:flex-auto lg:w-full lg:max-w-sm -ml-2">
      <div className="size-full flex flex-col gap-2 p-2">
        {sidebar ? (
          <>
            {!isMobile && (
              <ActiveSpeaker className="h-auto w-full aspect-video" isSmall />
            )}

            <div className="flex-1 rounded-lg overflow-clip bg-zinc-900">
              {sidebar}
            </div>
          </>
        ) : (
          <Grid />
        )}
      </div>
    </aside>
  );
}



================================================
FILE: samples/active-speaker-ui/src/lib/const.ts
================================================
import { defaultIconPack } from '@cloudflare/realtimekit-react-ui';
import type { RTKPlugin } from '@cloudflare/realtimekit';
const HOST_PRESET = 'webinar_presenter';
export const WHITEBOARD_ID = "ae79b269-24ca-4f8a-8112-f96084c8c19a";
export const iconPack = {
    ...defaultIconPack,
    'light': '<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M11.996 19.01a.75.75 0 0 1 .743.649l.007.102v1.5a.75.75 0 0 1-1.493.101l-.007-.101v-1.5a.75.75 0 0 1 .75-.75Zm6.022-2.072 1.06 1.06a.75.75 0 1 1-1.06 1.061l-1.06-1.06a.75.75 0 0 1 1.06-1.061Zm-10.983 0a.75.75 0 0 1 0 1.06L5.974 19.06a.75.75 0 0 1-1.06-1.06l1.06-1.061a.75.75 0 0 1 1.06 0ZM12 6.475a5.525 5.525 0 1 1 0 11.05 5.525 5.525 0 0 1 0-11.05Zm0 1.5a4.025 4.025 0 1 0 0 8.05 4.025 4.025 0 0 0 0-8.05Zm9.25 3.293a.75.75 0 0 1 .102 1.493l-.102.007h-1.5a.75.75 0 0 1-.102-1.493l.102-.007h1.5Zm-17-.029a.75.75 0 0 1 .102 1.494l-.102.006h-1.5a.75.75 0 0 1-.102-1.493l.102-.007h1.5Zm1.64-6.37.084.072 1.06 1.06a.75.75 0 0 1-.976 1.134l-.084-.073-1.06-1.06a.75.75 0 0 1 .976-1.134Zm13.188.072a.75.75 0 0 1 .073.977l-.073.084-1.06 1.06a.75.75 0 0 1-1.133-.976l.072-.084 1.06-1.061a.75.75 0 0 1 1.061 0ZM12 1.99a.75.75 0 0 1 .743.648l.007.102v1.5a.75.75 0 0 1-1.493.101l-.007-.102v-1.5a.75.75 0 0 1 .75-.75Z" fill="currentColor"/></svg>',
    'dark': '<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.026 17.001c-2.762 4.784-8.879 6.423-13.663 3.661a9.964 9.964 0 0 1-3.234-2.983.75.75 0 0 1 .365-1.131c3.767-1.348 5.785-2.911 6.956-5.146 1.232-2.353 1.551-4.93.689-8.464a.75.75 0 0 1 .769-.926 9.961 9.961 0 0 1 4.457 1.327C21.149 6.1 22.788 12.217 20.025 17Zm-8.248-4.903c-1.25 2.388-3.31 4.099-6.817 5.499a8.492 8.492 0 0 0 2.152 1.766 8.501 8.501 0 1 0 8.502-14.725 8.485 8.485 0 0 0-2.792-1.016c.647 3.384.23 6.044-1.045 8.476Z" fill="currentColor"/></svg>',
    join_stage: '<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.02c0 1.06.2 2.1.6 3.08l.6 1.42c.22.55.64 1.01 1.17 1.29.27.14.56.21.86.21h2.55c.77 0 1.49-.41 1.87-1.08.5-.87 1.02-1.7 1.72-2.43l1.32-1.39c.44-.46.97-.84 1.49-1.23l.59-.45a.6.6 0 0 0 .23-.47c0-.75-.54-1.57-1.22-1.79a3.34 3.34 0 0 0-2.78.29V4.5a1.5 1.5 0 0 0-2.05-1.4 1.5 1.5 0 0 0-2.9 0A1.5 1.5 0 0 0 6 4.5v.09A1.5 1.5 0 0 0 4 6v6.02ZM8 4.5v4a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0v6a.5.5 0 0 0 .85.37h.01c.22-.22.44-.44.72-.58.7-.35 2.22-.57 2.4.5l-.53.4c-.52.4-1.04.78-1.48 1.24l-1.33 1.38c-.75.79-1.31 1.7-1.85 2.63-.21.36-.6.58-1.01.58H7.23a.87.87 0 0 1-.4-.1 1.55 1.55 0 0 1-.71-.78l-.59-1.42a7.09 7.09 0 0 1-.53-2.7V6a.5.5 0 0 1 1 0v3.5a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0Z" fill="currentColor"></path></svg>',
}
export const saveWhiteboard = async (whiteboardPlugin: RTKPlugin | undefined) => {
    if (!whiteboardPlugin) return;
    await new Promise((resolve) => {
        whiteboardPlugin.removeAllListeners('board-saved' as any);
        whiteboardPlugin.on('board-saved' as any, (data: any) => {
            console.log('board saved:', data);
            resolve(true);
        })
        whiteboardPlugin.sendData({
            eventName: 'save-board',
            data: { eventName: 'save-board' }
        })
    });
  }
export default HOST_PRESET;



================================================
FILE: samples/active-speaker-ui/src/lib/meeting-store.ts
================================================
import { type States } from '@cloudflare/realtimekit-ui';
import { create } from 'zustand';

type Size = 'sm' | 'md' | 'lg';

interface Dimensions {
  width: number;
  height: number;
}

export interface MeetingStore {
  isImmersiveMode: boolean;
  darkMode: boolean;
  toggleDarkMode: (val: boolean) => void;
  setIsImmersiveMode: (val: boolean) => void;
  toggleImmersiveMode: () => void;

  isActiveSpeakerMode: boolean;
  setIsActiveSpeakerMode: (val: boolean) => void;
  dimensions?: Dimensions;
  setDimensions: (dimensions: Dimensions) => void;

  size: Size;
  setSize: (size: Size) => void;

  isMobile: boolean;
  states: States;
  setStates: (states: States) => void;
}

export const useMeetingStore = create<MeetingStore>((set, get) => ({
  isActiveSpeakerMode: false,
  setIsActiveSpeakerMode: (isActiveSpeakerMode) => set({ isActiveSpeakerMode }),

  darkMode: true,
  toggleDarkMode: (darkMode) => set({ darkMode }),

  isImmersiveMode: false,
  setIsImmersiveMode: (isImmersiveMode) => set({ isImmersiveMode }),
  toggleImmersiveMode: () => set({ isImmersiveMode: !get().isImmersiveMode }),

  size: 'sm',
  setSize: (size) => set({ size }),

  dimensions: undefined,
  setDimensions: (dimensions) => {
    let size: Size = 'lg';
    if (dimensions.width < 768) {
      size = 'sm';
    } else if (dimensions.width < 1024) {
      size = 'md';
    }

    let isMobile = size === 'lg' ? false : true;

    set({ dimensions, size, isMobile });
  },

  isMobile: false,

  states: { activeSidebar: true, sidebar: 'chat' },
  setStates: (states: States) => {
    set({ states: { ...get().states, ...states } });
  },
}));



================================================
FILE: samples/active-speaker-ui/src/lib/useActiveSpeaker.ts
================================================
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';

export function useActiveSpeaker() {
  const { meeting } = useRealtimeKitMeeting();
  const isPinned = useRealtimeKitSelector((m) => m.self.isPinned);

  const lastActiveSpeaker = useRealtimeKitSelector(
    (m) => m.participants.lastActiveSpeaker
  );

  const pinnedParticipants = useRealtimeKitSelector((m) =>
    m.participants.pinned.toArray()
  );

  const activeParticipants = useRealtimeKitSelector((m) =>
    m.participants.active.toArray()
  );

  if (isPinned) {
    return meeting.self;
  }

  if (pinnedParticipants.length > 0) {
    return pinnedParticipants.at(0);
  }

  if (meeting.self.id === lastActiveSpeaker) {
    return meeting.self;
  }

  return (
    meeting.participants.joined.get(lastActiveSpeaker) ??
    activeParticipants.at(0) ??
    meeting.self
  );
}



================================================
FILE: samples/async-video-survey/README.md
================================================
# Default Meeting UI Sample

This sample showcases the simplest way to integrate RealtimeKit's React UI Kit in your app!

---

![A screenshot of the RtkMeeting component](./screenshot.png)

Just pop in the `<RtkMeeting />` component, and pass the initialised
`meeting` object to it and you're good to go!

[See source](./src/App.tsx)



================================================
FILE: samples/async-video-survey/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Async Survey with RealtimeKit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/async-video-survey/package.json
================================================
{
  "name": "async-video-survey",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "autoprefixer": "^10.4.15",
    "postcss": "^8.4.29",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "tailwindcss": "^3.3.3",
    "zustand": "^5.0.3"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "prettier": "^3.0.3",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/async-video-survey/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/async-video-survey/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/async-video-survey/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/async-video-survey/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/async-video-survey/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/async-video-survey/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/async-video-survey/src/App.tsx
================================================
import {
  RtkDialogManager,
  RtkParticipantTile,
  RtkRecordingToggle,
  RtkSettingsToggle,
  RtkSpinner,
  RtkUiProvider,
  States,
  provideRtkDesignSystem,
} from '@cloudflare/realtimekit-react-ui';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
  useRealtimeKitMeeting,
  useRealtimeKitSelector,
} from '@cloudflare/realtimekit-react';
import { Dispatch, useEffect, useReducer, useState } from 'react';
import { getBrightness, getElapsedDuration } from './utils';
import Duration from './components/Duration';
import { useStatesStore } from './store';

function LoadingUI() {
  return (
    <div className="w-full h-full flex flex-col gap-4 place-items-center justify-center">
      <RtkSpinner className="w-14 h-14 text-blue-500" />
      <p className="text-xl font-semibold">Starting RealtimeKit Video Survey</p>
    </div>
  );
}

function useBrightnessAndSilenceDetector(
  dispatchError: Dispatch<Parameters<typeof errorReducer>[1]>,
) {
  const { meeting } = useRealtimeKitMeeting();
  const videoEnabled = useRealtimeKitSelector((m) => m.self.videoEnabled);
  const audioEnabled = useRealtimeKitSelector((m) => m.self.audioEnabled);

  useEffect(() => {
    const { audioTrack } = meeting.self;
    if (!audioTrack || !audioEnabled) return;

    const stream = new MediaStream();
    stream.addTrack(audioTrack);
    const audioContext = new AudioContext();
    audioContext.resume();
    const analyserNode = audioContext.createAnalyser();
    analyserNode.fftSize = 2048;
    const micSource = audioContext.createMediaStreamSource(stream);
    micSource.connect(analyserNode);
    const bufferLength = 2048;
    const dataArray = new Float32Array(bufferLength);
    const silenceThreshold = 0.05;
    const segmentLength = 1024;

    function getRMS(
      dataArray: Float32Array,
      startIndex: number,
      endIndex: number,
    ) {
      let sum = 0;
      for (let i = startIndex; i < endIndex; i++) {
        sum += dataArray[i] * dataArray[i];
      }
      const mean = sum / (endIndex - startIndex);
      const rms = Math.sqrt(mean);
      return rms;
    }

    function detectSilence() {
      analyserNode.getFloatTimeDomainData(dataArray);
      const numSegments = Math.floor(bufferLength / segmentLength);
      for (let i = 0; i < numSegments; i++) {
        const startIndex = i * segmentLength;
        const endIndex = (i + 1) * segmentLength;
        const rms = getRMS(dataArray, startIndex, endIndex);
        if (rms > silenceThreshold) {
          // Detected non-silence in this segment
          return false;
        }
      }
      // Detected silence
      return true;
    }

    const interval = setInterval(() => {
      const isSilent = detectSilence();

      if (isSilent) {
        dispatchError({ type: 'add', error: 'not_loud' });
      } else {
        dispatchError({ type: 'remove', error: 'not_loud' });
      }
    }, 1000);

    return () => {
      clearInterval(interval);
      dispatchError({ type: 'remove', error: 'not_loud' });
    };
  }, [audioEnabled]);

  useEffect(() => {
    if (!videoEnabled) return;

    const { videoTrack } = meeting.self;
    if (!videoTrack) return;
    const videoStream = new MediaStream();
    videoStream.addTrack(videoTrack);
    const video = document.createElement('video');
    video.style.width = '240px';
    video.style.height = '180px';
    video.muted = true;
    video.srcObject = videoStream;
    video.play();
    const canvas = document.createElement('canvas');
    canvas.width = 240;
    canvas.height = 180;
    const ctx = canvas.getContext('2d', { willReadFrequently: true })!;

    const interval = setInterval(() => {
      const brightness = getBrightness(video, canvas, ctx);
      if (brightness < 0.4) {
        dispatchError({ type: 'add', error: 'not_bright' });
      } else {
        dispatchError({ type: 'remove', error: 'not_bright' });
      }
    }, 1000);

    return () => {
      clearInterval(interval);
      dispatchError({ type: 'remove', error: 'not_bright' });
    };
  }, [videoEnabled]);

  return null;
}

type MyError = 'not_bright' | 'not_loud';
type State = 'ok' | MyError;

function errorReducer(
  state: MyError[],
  action: { type: 'add' | 'remove'; error: MyError },
) {
  switch (action.type) {
    case 'add':
      if (!state.includes(action.error)) {
        return [...state, action.error];
      }
      break;
    case 'remove':
      return state.filter((e) => e !== action.error);
  }
  return state;
}

const messages = {
  ok: 'Ensure your head and shoulders are in shot. Hit record when you are ready.',
  not_bright:
    'You seem to be in a dark room, please try turning on the lights.',
  not_loud: 'Your voice is not loud enough. Please speak loud and clearly.',
};

function Recorder({states}: {states: States;}) {
  const { meeting } = useRealtimeKitMeeting();

  const [timestamp, setTimestamp] = useState<Date>();
  const [recordingDisabled, setRecordingDisabled] = useState(false);
  

  const [duration, setDuration] = useState(0);
  const [errors, dispatchError] = useReducer(errorReducer, []);

  useBrightnessAndSilenceDetector(dispatchError);

  useEffect(() => {
    // calculate duration from recording timestamp
    if (timestamp) {
      const interval = setInterval(() => {
        const duration = getElapsedDuration(timestamp);
        setDuration(duration);
      }, 500);
      return () => {
        clearInterval(interval);
      };
    }
  }, [timestamp]);

  useEffect(() => {
    const onRecordingUpdate = (state: string) => {
      switch (state) {
        case 'RECORDING':
          setTimestamp(new Date());
          break;
        case 'STOPPING':
          setTimestamp(undefined);
          break;
      }
    };

    meeting.recording.addListener('recordingUpdate', onRecordingUpdate);
    return () => {
      meeting.recording.removeListener('recordingUpdate', onRecordingUpdate);
    };
  }, []);

  useEffect(() => {
    // stop recording when you reach max duration of 60 seconds
    if (duration >= 60) {
      meeting.recording.stop();
      setRecordingDisabled(false);
    }
  }, [duration]);

  if (states.meeting != 'joined') {
    return <LoadingUI />;
  }

  return (
    <div className="w-full h-full flex place-items-center justify-center p-4 flex-col">
      <div className="max-w-4xl pb-8">
        <h3 className="text-xl font-bold mb-4">
          Have you worked with any of the following technologies: JavaScript
          Core, Web Assembly, Protobufs?{' '}
        </h3>
        <div className="mb-2">
          List out the ones you have experience in and pick 1 to elaborate. If
          you haven't worked with any of these technologies, pick 2-3 skills
          mentioned in the job description to describe instead. Here are some
          tips to help you record a great video:
        </div>
        <li>Please provide as much detail as you can</li>
        <li>Use your webcam or mobile camera to record your video response</li>
        <li>Make sure you have plenty of light so we can clearly see you</li>
        <li>
          Avoid places with lots of background noise so we can clearly hear you
        </li>
      </div>
      <div className="flex flex-col w-full max-w-lg border rounded-xl overflow-clip">
        <div className="relative">
          <RtkParticipantTile
            participant={meeting.self}
            meeting={meeting}
            className="w-full h-auto rounded-none aspect-[3/2] bg-zinc-300"
            style={{ background: '#000' }}
          />
          <p className="text-white bg-purple-950 p-3 text-xs text-center">
            {/* Show okay message, or last error message */}
            {errors.length === 0
              ? messages['ok']
              : messages[errors[errors.length - 1]! as State]}
          </p>
          {/* Show placement container only when recording hasn't started */}
          {!timestamp && (
            <div className="absolute w-44 z-50 left-1/2 -translate-x-1/2 top-1/2 -translate-y-28 aspect-square border-2 border-dashed border-pink-50 rounded-lg" />
          )}
        </div>
        {/* Duration indicator */}
        <Duration duration={duration} />

        <div className="flex items-center justify-center p-2">
          <RtkRecordingToggle
            meeting={meeting}
            disabled={(timestamp && duration <= 15) || recordingDisabled}
          />
          <RtkSettingsToggle/>
        </div>
      </div>
      <RtkDialogManager />
    </div>
  );
}

export default function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();
  const states = useStatesStore((s) => s.states);
  const setStates = useStatesStore((s) => s.setStates);
  

  useEffect(() => {
    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    const searchParams = new URLSearchParams(window.location.search);
    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting.",
      );
      return;
    }

    initMeeting({
      authToken,
      // NOTE: remove defaults
      // defaults: {
      //   audio: false,
      //   video: false,
      // },
    }).then((meeting) => {
      Object.assign(window, { meeting });
      // automatically join room
      // meeting?.joinRoom();
    });
  }, []);

  return (
    <RealtimeKitProvider value={meeting} fallback={<LoadingUI />}>
      <RtkUiProvider meeting={meeting} onRtkStatesUpdate={(e) => {
        setStates(e.detail);
      }}>
        <Recorder states={states} />
      </RtkUiProvider>
    </RealtimeKitProvider>
  );
}



================================================
FILE: samples/async-video-survey/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

html, body, #root {
  height: 100%;
}



================================================
FILE: samples/async-video-survey/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/async-video-survey/src/store.ts
================================================
import { getInitialStates, States } from '@cloudflare/realtimekit-ui';
import { create } from 'zustand';

type StatesStore = {
  states: States;
  setStates: (states: States) => void;
};

export const useStatesStore = create<StatesStore>((set) => ({
  states: getInitialStates(),
  setStates: (states) => set({ states }),
}));


================================================
FILE: samples/async-video-survey/src/utils.ts
================================================
export function getElapsedDuration(date: Date) {
  return Math.floor((Date.now() - date.getTime()) / 1000);
}

export function getBrightness(
  video: HTMLVideoElement,
  canvas: HTMLCanvasElement,
  context: CanvasRenderingContext2D
) {
  context.drawImage(video, 0, 0, canvas.width, canvas.height);
  const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;
  let brightness = 0;
  for (let i = 0; i < data.length; i += 4) {
    brightness +=
      (0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]) / 255;
  }
  brightness /= data.length / 4;
  return brightness;
}



================================================
FILE: samples/async-video-survey/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/async-video-survey/src/components/Duration.tsx
================================================
import ProgressBar from './ProgressBar';

export default function Duration({ duration }: { duration: number }) {
  return (
    <div className="flex flex-col gap-1 bg-zinc-50 p-2 text-center">
      <div className="relative">
        <ProgressBar value={duration} max={60} />
        <div className="z-10 bg-red-500 absolute left-1/4 h-full w-1 top-0"></div>
        <div className="z-10 bg-black absolute right-0 h-full w-1 top-0"></div>
      </div>
      <div className="text-xs flex items-center justify-between">
        <div>
          Min recording time{' '}
          <span className="font-semibold text-red-500">15s</span>
        </div>
        <div>
          Max recording time <span className="font-semibold">60s</span>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: samples/async-video-survey/src/components/ProgressBar.tsx
================================================
export default function ProgressBar({
  value,
  max,
}: {
  value: number;
  max: number;
}) {
  return (
    <div className="h-1 w-full bg-zinc-200 relative">
      <div
        className="max-w-[25%] h-full bg-red-500 z-10 absolute left-0 top-0"
        style={{
          width: Math.min((value / max) * 100, 25) + '%',
          transition: 'all 0.3s',
        }}
      ></div>
      <div
        className="max-w-full h-full z-0 bg-black absolute left-0 top-0"
        style={{
          width: Math.min((value / max) * 100, 100) + '%',
          transition: 'all 0.3s',
        }}
      ></div>
    </div>
  );
}



================================================
FILE: samples/audio-room/README.md
================================================
# Audio Room Sample

This sample showcases how you can create an audio room with RealtimeKit's UI Kit.

---

![A screenshot of the Audio Room Sample](./screenshot.png)

[See source](./src/App.tsx)



================================================
FILE: samples/audio-room/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Room - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/audio-room/package.json
================================================
{
  "name": "audio-room",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "clsx": "^1.2.1",
    "good-grid": "^0.3.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.13",
    "postcss": "^8.4.20",
    "tailwindcss": "^3.2.4",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/audio-room/postcss.config.cjs
================================================
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};



================================================
FILE: samples/audio-room/tailwind.config.cjs
================================================
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: ['./src/**/*.{ts,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
};



================================================
FILE: samples/audio-room/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/audio-room/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/audio-room/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/audio-room/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/audio-room/src/App.tsx
================================================
import { useEffect } from 'react';
import { RealtimeKitProvider, useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import AudioRoom from './components/AudioRoom';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
    });
  }, []);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider value={meeting} fallback={<></>}>
      <AudioRoom />
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/audio-room/src/index.css
================================================
@tailwind base;
@tailwind utilities;
@tailwind components;

html,
body,
#root {
  height: 100%;
}



================================================
FILE: samples/audio-room/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/audio-room/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/audio-room/src/components/AudioRoom.tsx
================================================
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import { RtkButton, provideRtkDesignSystem } from '@cloudflare/realtimekit-react-ui';
import { useEffect } from 'react';
import Room from './Room';

export default function AudioRoom() {
  const { meeting } = useRealtimeKitMeeting();
  const roomJoined = useRealtimeKitSelector((meeting) => meeting.self.roomJoined);

  useEffect(() => {
    meeting.self.on('roomLeft', () => {
      // handle navigation to other screen here after user has left the room.
      alert("You've left the room");
    });

    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });
  }, []);

  if (!roomJoined) {
    // Show a page before joining the room, which allows you to join
    // the meeting

    return (
      <div className="w-full h-full flex flex-col items-center justify-center space-y-6">
        <h1 className="text-3xl font-bold">{meeting.meta.meetingTitle}</h1>
        <h2 className="text-2xl">You will be joining as {meeting.self.name}</h2>
        <p>By default you will join with your mic disabled.</p>
        <RtkButton
          size="lg"
          onClick={() => meeting.joinRoom()}
          kind="wide"
          className="max-w-sm"
        >
          Join audio room
        </RtkButton>
      </div>
    );
  }

  return <Room />;
}



================================================
FILE: samples/audio-room/src/components/Room.tsx
================================================
import {
  defaultIconPack,
  RtkClock,
  RtkDialogManager,
  RtkIcon,
  RtkLeaveButton,
  RtkMicToggle,
  RtkParticipantCount,
  RtkParticipantsAudio,
  RtkRecordingIndicator,
  RtkTooltip,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import { useEffect } from 'react';
import Stage from './Stage';

export default function Room() {
  const { meeting } = useRealtimeKitMeeting();
  const audioEnabled = useRealtimeKitSelector((meeting) => meeting.self.audioEnabled);

  useEffect(() => {
    function onKeyPress(e: KeyboardEvent) {
      if (e.ctrlKey && e.key.toLowerCase() === 'd') {
        if (meeting.self.audioEnabled) {
          meeting.self.disableAudio();
        } else {
          meeting.self.enableAudio();
        }
      }
    }

    window.addEventListener('keypress', onKeyPress);

    return () => {
      window.removeEventListener('keypress', onKeyPress);
    };
  }, []);

  return (
    <div className="h-full w-full flex flex-col">
      <header className="flex items-center justify-between px-6 h-16">
        <h1 className="text-xl flex items-center gap-2">
          <RtkIcon icon={defaultIconPack.mic_on} className="h-6" />
          <span>{meeting.meta.meetingTitle}</span>
        </h1>

        <div>
          <RtkParticipantCount meeting={meeting} />
          <RtkClock meeting={meeting} />
          <RtkRecordingIndicator meeting={meeting} />
        </div>
      </header>
      <Stage />
      <footer className="flex items-center px-6 py-4 justify-center gap-1">
        <RtkLeaveButton>
          <RtkIcon icon={defaultIconPack.call_end} className="h-7 w-7" />
        </RtkLeaveButton>

        <RtkTooltip label="Ctrl+D to toggle mic">
          <RtkMicToggle meeting={meeting}>
            <RtkIcon
              icon={
                audioEnabled ? defaultIconPack.mic_on : defaultIconPack.mic_off
              }
              className="h-7 w-7"
            />
          </RtkMicToggle>
        </RtkTooltip>
      </footer>
      <RtkDialogManager meeting={meeting} />
      <RtkParticipantsAudio meeting={meeting} />
    </div>
  );
}



================================================
FILE: samples/audio-room/src/components/Stage.tsx
================================================
import { RtkAudioVisualizer, RtkAvatar } from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import clsx from 'clsx';

export default function Stage() {
  const { meeting } = useRealtimeKitMeeting();
  const activeParticipants = useRealtimeKitSelector((meeting) =>
    meeting.participants.active.toArray()
  );

  const joinedParticipants = useRealtimeKitSelector((meeting) =>
    meeting.participants.joined.toArray()
  );

  const participants = [
    ...activeParticipants,
    ...joinedParticipants.filter((p) => !activeParticipants.includes(p)),
    meeting.self,
  ];

  return (
    <main className="flex-1 relative flex flex-wrap content-center justify-center gap-4 p-6">
      {participants.map((participant) => {
        return (
          <div
            className={clsx(
              'relative min-w-[180px] flex flex-col items-center justify-center gap-2 bg-zinc-100 border-2 p-6 pb-2 rounded-xl break-all',
              participant.audioEnabled &&
                'border-blue-500 shadow-lg shadow-blue-100'
            )}
            key={participant.id}
          >
            <RtkAvatar participant={participant} size="sm" />
            <div className="flex items-center gap-0.5">
              <RtkAudioVisualizer
                participant={participant}
                size="md"
                className="absolute top-2 left-2"
              />
              <div>
                {participant.name}
                {participant.id === meeting.self.id ? ' (you)' : null}
              </div>
            </div>
          </div>
        );
      })}
    </main>
  );
}



================================================
FILE: samples/back-to-back-meetings/README.md
================================================
# Back to Back Meetings

A sample designed for continuous meeting workflows where participants need to transition seamlessly from one meeting to the next without interruption. Perfect for scenarios like back-to-back appointments, consecutive interviews, or sequential consultations.

## Features

- **Continuous Meeting Flow**: Automatically transitions from one meeting to the next
- **Single Meeting Display**: Focus on one meeting at a time
- **Zero Manual Joins**: No need to manually join meetings - transitions happen automatically
- **Session Complete Screen**: Shows completion message with option to restart the meeting cycle
- **Room Left Event Integration**: Uses `meeting.self.on('roomLeft')` to trigger automatic transitions
- **State Isolation**: Each meeting maintains its own isolated state using Zustand stores
- **UI Addons**: Includes video backgrounds, hand raise, and host controls

## How It Works

1. **First Meeting**: Automatically begins when the first meeting token is provided
2. **Seamless Transition**: When one meeting ends, the next meeting automatically starts
3. **Continuous Workflow**: Designed for scenarios requiring uninterrupted meeting sequences
4. **Session Complete**: After all scheduled meetings, shows completion screen with restart option

## Usage

Pass auth tokens via URL parameters:
```
?authToken1=<first-meeting-token>&authToken2=<second-meeting-token>
```

### Parameters
- `authToken1` (required): Token for the first meeting
- `authToken2` (optional): Token for the second meeting

## Architecture

- **App.tsx**: Main component handling meeting state and transitions
- **Meeting.tsx**: Individual meeting component with addons and event handling  
- **store.ts**: Zustand-based state management with per-meeting isolation
- **components/**: Custom RTK UI components for meeting display



================================================
FILE: samples/back-to-back-meetings/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Back to Back Meetings</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/back-to-back-meetings/package.json
================================================
{
  "name": "back-to-back-meetings",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^4.4.1",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5"
  },
  "devDependencies": {
    "@types/react": "^18.2.15",
    "@types/react-dom": "^18.2.7",
    "@vitejs/plugin-react": "^4.0.3",
    "autoprefixer": "^10.4.14",
    "postcss": "^8.4.27",
    "tailwindcss": "^3.3.3",
    "typescript": "^5.0.2",
    "vite": "^4.4.5"
  }
}



================================================
FILE: samples/back-to-back-meetings/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/back-to-back-meetings/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/back-to-back-meetings/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/back-to-back-meetings/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/back-to-back-meetings/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base: './',
  plugins: [react()],
});



================================================
FILE: samples/back-to-back-meetings/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/back-to-back-meetings/src/App.tsx
================================================
import { useState, useEffect } from 'react';
import { Meeting } from './Meeting';

function App() {
  const url = new URL(window.location.href);
  const urlAuthToken1 = url.searchParams.get('authToken1');
  const urlAuthToken2 = url.searchParams.get('authToken2');
  const baseURI = url.searchParams.get('baseURI') || 'dyte.io';

  const [authToken1] = useState(urlAuthToken1 || '');
  const [authToken2] = useState(urlAuthToken2 || '');
  const [currentMeeting, setCurrentMeeting] = useState<1 | 2 | null>(null);
  const [demoComplete, setDemoComplete] = useState(false);

  // Auto-initialize first meeting if token is available
  useEffect(() => {
    if (authToken1 && !currentMeeting) {
      setCurrentMeeting(1);
    }
  }, [authToken1, currentMeeting]);

  const handleMeetingLeft = () => {
    console.log('Meeting left, automatically switching to next meeting');
    
    if (currentMeeting === 1 && authToken2) {
      // Switch from Meeting 1 to Meeting 2
      setCurrentMeeting(2);
    } else {
      // Demo complete - either leaving Meeting 2 or no next meeting token
      setCurrentMeeting(null);
      setDemoComplete(true);
    }
  };

  const getCurrentAuthToken = () => {
    if (currentMeeting === 1) return authToken1;
    if (currentMeeting === 2) return authToken2;
    return '';
  };
  return (
    <div className="w-full h-screen bg-gray-100">
      {/* Header */}
      <div className="bg-white shadow-sm border-b px-6 py-4">
        <div className="flex items-center justify-between">
          <h1 className="text-2xl font-bold text-gray-900">Back to Back Meetings</h1>
          <div className="flex items-center space-x-4">
            {currentMeeting && (
              <span className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                Meeting {currentMeeting} Active
              </span>
            )}

          </div>
        </div>
      </div>

      {/* Meeting Container */}
      <div className="flex-1" style={{ height: 'calc(100vh - 80px)' }}>
        {!authToken1 && !authToken2 ? (
          <div className="flex items-center justify-center h-full">
            <div className="text-center max-w-2xl mx-auto px-6">
              <h2 className="text-2xl font-semibold text-gray-700 mb-6">
                Welcome to Back-to-Back Meetings
              </h2>
              <div className="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                <h3 className="text-lg font-medium text-red-900 mb-3">No Auth Tokens Provided</h3>
                <p className="text-red-800 mb-3">
                  Please provide authToken1 and/or authToken2 in the URL parameters.
                </p>
                <p className="text-sm text-red-600">
                  <strong>Example:</strong> ?authToken1=token1&authToken2=token2
                </p>
              </div>
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                <h3 className="text-lg font-medium text-blue-900 mb-3">How it works:</h3>
                <div className="text-left space-y-3 text-blue-800">
                  <div className="flex items-start space-x-3">
                    <span className="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">1</span>
                    <p>Meeting 1 will start automatically when you provide authToken1</p>
                  </div>
                  <div className="flex items-start space-x-3">
                    <span className="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">2</span>
                    <p><strong>To switch to Meeting 2:</strong> Use the "Leave" button in the bottom control bar</p>
                  </div>
                  <div className="flex items-start space-x-3">
                    <span className="flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">3</span>
                    <p>Meeting 2 will automatically start when you leave Meeting 1 (if authToken2 is provided)</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        ) : demoComplete ? (
          <div className="flex items-center justify-center h-full">
            <div className="text-center max-w-2xl mx-auto px-6">
              <h2 className="text-2xl font-semibold text-green-700 mb-6">
                ðŸŽ‰ Demo Complete!
              </h2>
              <div className="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                <h3 className="text-lg font-medium text-green-900 mb-3">Back-to-Back Meetings Demo Finished</h3>
                <p className="text-green-800 mb-4">
                  You have successfully experienced the back-to-back meetings functionality by switching between Meeting 1 and Meeting 2.
                </p>
                <p className="text-green-700">
                  To try the demo again, please reload the page.
                </p>
              </div>
              <button
                onClick={() => window.location.reload()}
                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
              >
                Reload Page to Try Again
              </button>
            </div>
          </div>
        ) : (
          <div style={{ height: '90vh', width: '100%' }}>
            <Meeting
              authToken={getCurrentAuthToken()}
              baseURI={baseURI}
              meetingIdentifier={`meeting-${currentMeeting}`}
              onMeetingLeft={handleMeetingLeft}
            />
          </div>
        )}
      </div>
    </div>
  );
}

export default App;



================================================
FILE: samples/back-to-back-meetings/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;



================================================
FILE: samples/back-to-back-meetings/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/back-to-back-meetings/src/Meeting.tsx
================================================
import { useEffect, useMemo, useState } from 'react';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
} from '@cloudflare/realtimekit-react';
import {
  RtkDialogManager,
  RtkUiProvider,
  UIConfig,
  createDefaultConfig,
  provideRtkDesignSystem,
  registerAddons,
} from '@cloudflare/realtimekit-react-ui';
import CustomRtkMeeting from './components/custom-rtk-meeting';
import VideoBackground from '@cloudflare/realtimekit-ui-addons/video-background';
import HandRaise from '@cloudflare/realtimekit-ui-addons/hand-raise';
import ChatHostControl from '@cloudflare/realtimekit-ui-addons/chat-host-control';
import MicHostControl from '@cloudflare/realtimekit-ui-addons/mic-host-control';
import CameraHostControl from '@cloudflare/realtimekit-ui-addons/camera-host-control';
import { getStatesStore, cleanupStores } from './store';
import { useContainerSize } from './hooks/useContainerSize';

export function Meeting(
    { authToken, baseURI, meetingIdentifier, onMeetingLeft }: { 
      authToken: string, 
      baseURI?: string, 
      meetingIdentifier: string,
      onMeetingLeft?: () => void
    }
) {
  const [meeting, initMeeting] = useRealtimeKitClient();
  
  // Create peer specific store for this meeting peer instance
  const statesStore = useMemo(() => {
    return getStatesStore(meetingIdentifier);
  }, [meetingIdentifier]);
  
  const setStates = statesStore((s: any) => s.setStates);
  const states = statesStore((s: any) => s.states);
  const [customConfig, setCustomConfig] = useState<UIConfig | null>(createDefaultConfig());
  const size = useContainerSize(meetingIdentifier);

  // Cleanup store when component unmounts
  useEffect(() => {
      return () => {
        cleanupStores(meetingIdentifier);
      };
  }, [meetingIdentifier]);

  // Listen for roomLeft event to trigger callback
  useEffect(() => {
    if (!meeting?.self || !onMeetingLeft) return;

    const handleRoomLeft = () => {
      console.log('Room left event detected');
      onMeetingLeft();
    };

    meeting.self.on('roomLeft', handleRoomLeft);

    return () => {
      meeting.self.off('roomLeft', handleRoomLeft);
    };
  }, [meeting, onMeetingLeft]);

  useEffect(() => {
      async function setupUiKitAddons(){
        if (!meeting) return;
        // Register UI kit addons
        const videoBackground = await VideoBackground.init({
          modes: ["blur", "virtual", "random"],
          blurStrength: 30, // 0 - 100 for opacity
          meeting: meeting!,
          images: [
              "https://images.unsplash.com/photo-1487088678257-3a541e6e3922?q=80&w=2874&auto=format&fit=crop&ixlib=rb-4.0.3",
              "https://images.unsplash.com/photo-1496715976403-7e36dc43f17b?q=80&w=2848&auto=format&fit=crop&ixlib=rb-4.0.3",
              "https://images.unsplash.com/photo-1600431521340-491eca880813?q=80&w=2938&auto=format&fit=crop&ixlib=rb-4.0.3"
          ],
          randomCount: 10,
          selector: `#${meetingIdentifier}`
        });

        const handRaise = await HandRaise.init({
          meeting,
          canRaiseHand: true,
          canManageRaisedHand: true,
          handRaiseIcon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M10 4.25C10 3.69772 9.55228 3.25 9 3.25C8.44772 3.25 8 3.69772 8 4.25V10.9982C8 11.2743 7.77614 11.4982 7.5 11.4982C7.22386 11.4982 7 11.2743 7 10.9982V5.99683C7 5.44454 6.55228 4.99683 6 4.99683C5.44772 4.99683 5 5.44454 5 5.99683V14.7536C5 16.933 6.16842 19.263 6.91404 20.5425C7.47017 21.4969 8.49409 22.0013 9.53657 22.0013H11.7046C12.9358 22.0013 14.0613 21.3056 14.6118 20.2043L14.7451 19.9374C15.1658 19.0957 15.6904 18.31 16.3067 17.5989L18.5186 15.0468L20.7105 13.342C20.8931 13.1999 21 12.9814 21 12.75C21 12.2651 20.7409 11.9051 20.4084 11.6903C20.1123 11.499 19.7584 11.4172 19.4464 11.3802C18.8102 11.3047 18.0364 11.3818 17.3571 11.5137C16.8436 11.6134 16.3829 11.8077 16 12.0182V4.25C16 3.69772 15.5523 3.25 15 3.25C14.4477 3.25 14 3.69772 14 4.25V10.5C14 10.7761 13.7761 11 13.5 11C13.2239 11 13 10.7761 13 10.5V2.99683C13 2.44454 12.5523 1.99683 12 1.99683C11.4477 1.99683 11 2.44454 11 2.99683V10.5C11 10.7761 10.7761 11 10.5 11C10.2239 11 10 10.7761 10 10.5V4.25Z" fill="#F4C534"/></svg>'
      });
      
      const chatHostControl = await ChatHostControl.init({
          meeting,
          hostPresets: ['group_call_host', 'webinar_presenter'],
          targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
          addActionInParticipantMenu: true,
      });
      
      const micHostControl = await MicHostControl.init({
          meeting,
          hostPresets: ['group_call_host', 'webinar_presenter'],
          targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
          addActionInParticipantMenu: true,
      });
      
      const cameraHostControl = await CameraHostControl.init({
          meeting,
          hostPresets: ['group_call_host', 'webinar_presenter'],
          targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
          addActionInParticipantMenu: true,
      });
  
        const newConfig = registerAddons([videoBackground, handRaise, chatHostControl, micHostControl, cameraHostControl], meeting!);

        // This code ensure full screen toggle works fine. This will be ported to @cloudflare/realtimekit-ui-addons soon.
        if (newConfig.root && Array.isArray(newConfig.root['div#controlbar-left'])) {
          const fullScreenToggleIndex = newConfig.root['div#controlbar-left'].indexOf('rtk-fullscreen-toggle');
          if(fullScreenToggleIndex > -1){
              newConfig.root['div#controlbar-left'][fullScreenToggleIndex] = ['rtk-fullscreen-toggle', {
                  variant: 'vertical',
                  targetElement: document.getElementById(meetingIdentifier)!
              }];
          }
      }
      // Handle smaller screens
      ['rtk-more-toggle.activeMoreMenu', 'rtk-more-toggle.activeMoreMenu.md', 'rtk-more-toggle.activeMoreMenu.sm'].forEach((configElemKey) => {
          const configElem = newConfig?.root?.[configElemKey] as any;
          configElem?.forEach((dyteElemConfigSet: any) => {
              if (dyteElemConfigSet[0] === 'rtk-fullscreen-toggle') {
                  dyteElemConfigSet[1].targetElement = document.getElementById(meetingIdentifier)!;
              }
          });
      });

        setCustomConfig(newConfig);
      } 
      setupUiKitAddons();
    }, [meeting]);

  useEffect(() => {

    if (!initMeeting || !authToken) {
      console.log(`[${meetingIdentifier}] Missing initMeeting or authToken`);
      return;
    }

    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
      ...(baseURI && { baseURI }),
      modules: {
        devTools: {
          logs: false,
        }
      }
    })
    .then(() => {
      console.log(`[${meetingIdentifier}] Meeting initialized`);
    })
    .catch((error) => {
      console.error(`[${meetingIdentifier}] Error initializing meeting:`, error);
    });
  }, [initMeeting, authToken, baseURI, meetingIdentifier]);



  return (
    <div className="flex flex-col w-full h-full overflow-hidden" data-meeting-id={meetingIdentifier}>
        <RealtimeKitProvider value={meeting}>
            <RtkUiProvider
                meeting={meeting}
                config={customConfig!}
                showSetupScreen
                style={{ height: '100%', width: '100%', display: 'block', overflow: 'hidden' }}
                ref={(el) => {
                  if (!el) return;
                  
                  const handleStateUpdate = (e: CustomEvent) => {
                    // Only update states if this event is for our meeting
                    if (!meeting?.self?.id || e.detail?.peerId !== meeting?.self?.id) return;
                    console.log(`[${meetingIdentifier}] States updated:`, e.detail);
                    setStates(e.detail);
                  };
                  
                  // Add new listener
                  el.addEventListener('rtkStatesUpdate', handleStateUpdate);
                  
                  // Cleanup listener on unmount
                  return () => {
                    el.removeEventListener('rtkStatesUpdate', handleStateUpdate);
                  };
                }} >
                      <CustomRtkMeeting meetingIdentifier={meetingIdentifier} states={states} />
                      {/* FIXME: Dialog manager is not syncing states with store for some reason */}
                      <RtkDialogManager size={size} meeting={meeting} states={states}/>
            </RtkUiProvider>
        </RealtimeKitProvider>
    </div>
  );
}



================================================
FILE: samples/back-to-back-meetings/src/store.ts
================================================
import { getInitialStates, States } from '@cloudflare/realtimekit-ui';
import { create } from 'zustand';
import { CustomStates } from './types';

type StatesStore = {
  states: States;
  setStates: (states: States) => void;
};

type CustomStatesStore = {
  states: CustomStates;
  setCustomStates: (states: CustomStates) => void;
};

// Factory function to create isolated state stores per meeting
export const createStatesStore = () => create<StatesStore>((set) => ({
  states: getInitialStates(),
  setStates: (states) => set({ states }),
}));

// Factory function to create isolated custom state stores per meeting
export const createCustomStatesStore = () => create<CustomStatesStore>((set) => ({
  states: {},
  setCustomStates: (states) => set({ states }),
}));

// Store registry to manage multiple store instances
const storeRegistry = new Map<string, ReturnType<typeof createStatesStore>>();
const customStoreRegistry = new Map<string, ReturnType<typeof createCustomStatesStore>>();

// Get or create a store instance for a specific meeting
export const getStatesStore = (meetingId: string) => {
  if (!storeRegistry.has(meetingId)) {
    const newStore = createStatesStore();
    storeRegistry.set(meetingId, newStore);
  }
  return storeRegistry.get(meetingId)!;
};

// Get or create a custom store instance for a specific meeting
export const getCustomStatesStore = (meetingId: string) => {
  if (!customStoreRegistry.has(meetingId)) {
    const newStore = createCustomStatesStore();
    customStoreRegistry.set(meetingId, newStore);
  }
  return customStoreRegistry.get(meetingId)!;
};

// Cleanup function to remove stores when meetings are destroyed
export const cleanupStores = (meetingId: string) => {
  storeRegistry.delete(meetingId);
  customStoreRegistry.delete(meetingId);
};



================================================
FILE: samples/back-to-back-meetings/src/types.ts
================================================
// Custom states type for additional meeting-specific state management
export type CustomStates = {
  [key: string]: any;
};



================================================
FILE: samples/back-to-back-meetings/src/components/custom-rtk-meeting.tsx
================================================
import InMeeting from './in-meeting';
import {
  RtkEndedScreen,
  RtkIdleScreen,
  RtkSetupScreen,
  RtkWaitingScreen,
} from '@cloudflare/realtimekit-react-ui';
import { States } from '@cloudflare/realtimekit-ui';
import { useContainerSize } from '../hooks/useContainerSize';

export interface CustomRtkMeetingProps {
  states: States;
  meetingIdentifier: string;
}

function CustomRtkMeeting({ states, meetingIdentifier }: CustomRtkMeetingProps) {
  const size = useContainerSize(meetingIdentifier);
  
  switch (states.meeting) {
    case 'idle':
      return <RtkIdleScreen />;
    case 'setup':
      return <RtkSetupScreen size={size} />;
    case 'waiting':
      return <RtkWaitingScreen />;
    case 'ended':
      return <RtkEndedScreen />;
    case 'joined':
    default:
      return <InMeeting states={states} meetingIdentifier={meetingIdentifier} />;
  }
}

export default CustomRtkMeeting;



================================================
FILE: samples/back-to-back-meetings/src/components/in-meeting.tsx
================================================
import {
  RtkStage,
  RtkGrid,
  RtkNotifications,
  RtkParticipantsAudio,
  RtkSidebar,
  RtkControlbar,
  RtkHeader,
} from '@cloudflare/realtimekit-react-ui';
import type { CustomRtkMeetingProps } from './custom-rtk-meeting';
import { useContainerSize } from '../hooks/useContainerSize';

function InMeeting({ states, meetingIdentifier }: CustomRtkMeetingProps) {
  const size = useContainerSize(meetingIdentifier);
  return (
    <div className="flex flex-col w-full h-full overflow-hidden">
      <header className="flex-shrink-0 w-full">
        <RtkHeader size={size} style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
          gap: 'var(--rtk-space-2, 8px)',
          '--header-section-gap': 'var(--rtk-space-2, 8px)',
        }}/>
      </header>
      <main className="flex-1 w-full overflow-hidden relative">
        <RtkStage className="w-full h-full p-2 overflow-hidden relative">
          <RtkGrid size={size} />
          <RtkNotifications size={size} />
          { states.activeSidebar && <RtkSidebar size={size}/>}
        </RtkStage>
        <RtkParticipantsAudio />
      </main>
      <footer className="flex-shrink-0 w-full">
        <RtkControlbar size={size} style={{display: 'flex', justifyContent: 'space-between'}} />
      </footer>
    </div>
  );
}

export default InMeeting;



================================================
FILE: samples/back-to-back-meetings/src/hooks/useContainerSize.ts
================================================
import { useState, useEffect } from 'react';
import ResizeObserver from 'resize-observer-polyfill';

// Breakpoints configuration
const breakpoints = {
  sm: 640,
  md: 768,
  lg: 1080,
  xl: 2160
} as const;

export type BreakpointSize = keyof typeof breakpoints;

// Function to determine size based on width
const getSizeFromWidth = (width: number): BreakpointSize => {
  if (width >= breakpoints.xl) return 'xl';
  if (width >= breakpoints.lg) return 'lg';
  if (width >= breakpoints.md) return 'md';
  return 'sm';
};

// Global state to store size for each meeting
const meetingSizes = new Map<string, BreakpointSize>();
const meetingListeners = new Map<string, Set<(size: BreakpointSize) => void>>();

/**
 * Custom hook to track container size based on breakpoints
 * @param meetingIdentifier - Unique identifier for the meeting container
 * @returns Current breakpoint size ('sm' | 'md' | 'lg' | 'xl')
 */
export const useContainerSize = (meetingIdentifier: string): BreakpointSize => {
  const [size, setSize] = useState<BreakpointSize>(
    meetingSizes.get(meetingIdentifier) || 'md'
  );

  useEffect(() => {
    // Add this component's setter to the listeners for this meeting
    if (!meetingListeners.has(meetingIdentifier)) {
      meetingListeners.set(meetingIdentifier, new Set());
    }
    meetingListeners.get(meetingIdentifier)!.add(setSize);

    // If size is already tracked, use it
    const existingSize = meetingSizes.get(meetingIdentifier);
    if (existingSize) {
      setSize(existingSize);
      return;
    }

    // Set up ResizeObserver for this meeting if not already done
    const containerElement = document.getElementById(meetingIdentifier);
    if (containerElement) {
      setupResizeObserver(containerElement, meetingIdentifier);
    } else {
      // If container doesn't exist yet, wait for it
      const observer = new MutationObserver(() => {
        const element = document.getElementById(meetingIdentifier);
        if (element) {
          setupResizeObserver(element, meetingIdentifier);
          observer.disconnect();
        }
      });
      observer.observe(document.body, { childList: true, subtree: true });
    }

    // Cleanup listener on unmount
    return () => {
      meetingListeners.get(meetingIdentifier)?.delete(setSize);
      if (meetingListeners.get(meetingIdentifier)?.size === 0) {
        meetingListeners.delete(meetingIdentifier);
        meetingSizes.delete(meetingIdentifier);
      }
    };
  }, [meetingIdentifier]);

  return size;
};

// Helper function to set up ResizeObserver
const setupResizeObserver = (containerElement: HTMLElement, meetingIdentifier: string) => {
  const resizeObserver = new ResizeObserver((entries) => {
    for (const entry of entries) {
      const { width } = entry.contentRect;
      const newSize = getSizeFromWidth(width);
      
      // Update global state
      meetingSizes.set(meetingIdentifier, newSize);
      
      // Notify all listeners for this meeting
      const listeners = meetingListeners.get(meetingIdentifier);
      if (listeners) {
        listeners.forEach(listener => listener(newSize));
      }
    }
  });

  resizeObserver.observe(containerElement);
  
  // Initial size calculation
  const rect = containerElement.getBoundingClientRect();
  const initialSize = getSizeFromWidth(rect.width);
  meetingSizes.set(meetingIdentifier, initialSize);
  
  // Notify listeners of initial size
  const listeners = meetingListeners.get(meetingIdentifier);
  if (listeners) {
    listeners.forEach(listener => listener(initialSize));
  }
};

export { breakpoints };



================================================
FILE: samples/chat/README.md
================================================
# Default Meeting UI Sample

This sample showcases the simplest way to integrate RealtimeKit's React UI Kit in your app!

---

![A screenshot of the RtkMeeting component](./screenshot.png)

Just pop in the `<RtkMeeting />` component, and pass the initialised
`meeting` object to it and you're good to go!

[See source](./src/App.tsx)



================================================
FILE: samples/chat/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat App - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>

    <svg width="0" height="0">
      <defs>
        <clipPath id="squircle" clipPathUnits="objectBoundingBox">
          <path
            d="M .5,0 C .1,0 0,.1 0,.5 0,.9 .1,1 .5,1 .9,1 1,.9 1,.5 1,.1 .9,0 .5,0 Z"
          />
        </clipPath>
      </defs>
    </svg>

    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/chat/package.json
================================================
{
  "name": "chat",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-feather": "^2.0.10",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.14",
    "clsx": "^1.2.1",
    "postcss": "^8.4.24",
    "tailwindcss": "^3.3.2",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/chat/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/chat/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/chat/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/chat/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/chat/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/chat/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/chat/src/App.tsx
================================================
import { useEffect } from 'react';
import { useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import {
  RtkChat,
  RtkDialogManager,
  RtkUiProvider,
  provideRtkDesignSystem,
} from '@cloudflare/realtimekit-react-ui';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }

    initMeeting({
      authToken,
      defaults: {
        video: false,
        audio: false,
      },
    }).then((m) => {
      // NOTE: for debugging
      Object.assign(window, { meeting: m });
    });
  }, []);

  if (!meeting) return <div>"Loading..."</div>;

  return (
    <RtkUiProvider meeting={meeting}>
      <RtkChat />
      <RtkDialogManager />
    </RtkUiProvider>
  );
}

export default App;



================================================
FILE: samples/chat/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    height: 100%;
  }
}

@layer components {
  .squircle {
    clip-path: url(#squircle);
  }

  .icon-btn {
    @apply h-9 px-2 bg-gray-200 border rounded-md;
    @apply inline-flex place-items-center justify-center gap-2;
  }

  .icon-btn > svg {
    @apply h-5 w-5;
  }
}



================================================
FILE: samples/chat/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/chat/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/chat-widget/README.md
================================================
# RealtimeKit Chat Widget demo

This sample showcases how you can build a Chat widget using RealtimeKit Chat SDK

---

![A screenshot of the RtkChat component](./screenshot.png)

[See source](./src/components/App.tsx)

## Prerequisites

1. Make sure to have a preset named `chat`, that has Chat permissions enabled.

## Getting started

1. rename `.env.sample` to `.env` and update the variables with your organization details
2. `npm install`
3. `npm run dev`



================================================
FILE: samples/chat-widget/index.html
================================================
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>RealtimeKit Chat Widget demo</title>
</head>

<body>
	<div id="root"></div>
	<script type="module" src="/src/index.tsx"></script>
</body>

</html>


================================================
FILE: samples/chat-widget/package.json
================================================
{
	"name": "realtimekit-chat-widget-demo",
	"description": "RealtimeKit Chat Widget demo",
	"version": "0.1.0",
	"private": true,
	"scripts": {
		"dev": "vite",
		"build": "tsc && vite build",
		"serve": "vite preview",
		"test": "vitest",
		"test:ui": "vitest --ui",
		"lint": "eslint src --max-warnings=0",
		"typecheck": "tsc --project tsconfig.json --noEmit"
	},
	"dependencies": {
		"@cloudflare/realtimekit": "^1.1.6",
		"@cloudflare/realtimekit-react": "^1.1.6",
		"@cloudflare/realtimekit-ui": "^1.0.5",
		"@cloudflare/realtimekit-react-ui": "^1.0.5",
		"@cloudflare/realtimekit-ui-addons": "^0.0.4",
		"react": "^18.2.0",
		"react-dom": "^18.2.0"
	},
	"devDependencies": {
		"@trivago/prettier-plugin-sort-imports": "^4.2.1",
		"@types/node": "^20.8.10",
		"@types/react": "^18.2.34",
		"@types/react-dom": "^18.2.14",
		"@typescript-eslint/eslint-plugin": "^6.9.1",
		"@typescript-eslint/parser": "^6.9.1",
		"@vitejs/plugin-react": "^4.3.0",
		"autoprefixer": "^10.4.16",
		"eslint": "^8.53.0",
		"eslint-config-prettier": "^9.0.0",
		"eslint-plugin-prettier": "^5.0.1",
		"eslint-plugin-react": "^7.33.2",
		"eslint-plugin-react-hooks": "^4.6.0",
		"eslint-plugin-tailwindcss": "^3.13.0",
		"postcss": "^8.4.31",
		"prettier": "3.0.3",
		"tailwindcss": "^3.3.5",
		"typescript": "^5.2.2",
		"vite": "^4.5.0",
		"vite-tsconfig-paths": "^4.2.1"
	}
}



================================================
FILE: samples/chat-widget/postcss.config.js
================================================
// eslint-disable-next-line no-undef
module.exports = {
	plugins: {
		'postcss-import': {},
		'tailwindcss/nesting': {},
		tailwindcss: {},
		autoprefixer: {},
	},
};



================================================
FILE: samples/chat-widget/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
	content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
	theme: {
		extend: {},
	},
	plugins: [],
};



================================================
FILE: samples/chat-widget/tsconfig.json
================================================
{
  "compilerOptions": {
    "baseUrl": "./src",
    "target": "esnext",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "types": ["vite/client"]
  },
  "include": ["src"],
  "exclude": ["node_modules"]
}



================================================
FILE: samples/chat-widget/vite.config.ts
================================================
import react from '@vitejs/plugin-react';
import { defineConfig } from 'vite';

// https://vitejs.dev/config https://vitest.dev/config
export default defineConfig({
	base: './',
	plugins: [react()],
});



================================================
FILE: samples/chat-widget/.editorconfig
================================================
root = true

[*]
indent_style = tab
indent_size = 4
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true


================================================
FILE: samples/chat-widget/.env.sample
================================================
VITE_ORG_ID=
VITE_API_KEY=



================================================
FILE: samples/chat-widget/.eslintrc
================================================
{
	"env": {
		"browser": true,
		"es2020": true,
		"jest": true,
		"node": true
	},
	"settings": {
		"react": {
			"version": "detect"
		}
	},
	"extends": [
		"eslint:recommended",
		"plugin:react/recommended",
		"plugin:@typescript-eslint/eslint-recommended",
		"plugin:@typescript-eslint/recommended",
		"plugin:prettier/recommended",
		"plugin:tailwindcss/recommended"
	],
	"parser": "@typescript-eslint/parser",
	"parserOptions": {
		"ecmaFeatures": {
			"jsx": true
		},
		"ecmaVersion": 11,
		"sourceType": "module"
	},
	"plugins": ["react", "react-hooks", "@typescript-eslint", "tailwindcss"],
	"rules": {
		"react-hooks/rules-of-hooks": "error",
		"react-hooks/exhaustive-deps": "warn",
		"react/prop-types": "off",
		"react/react-in-jsx-scope": "off",
		"@typescript-eslint/explicit-module-boundary-types": "off",
		"@typescript-eslint/no-non-null-assertion": "off",
		"tailwindcss/classnames-order": "warn",
		"tailwindcss/no-custom-classname": "warn",
		"tailwindcss/no-contradicting-classname": "error"
	}
}



================================================
FILE: samples/chat-widget/.gitignore
================================================
dist
dist-ssr
*.local


# dependencies
/node_modules
/.pnp
.pnp.js


# testing
/coverage


# next.js
/.next/
/out/


# production
/build


# misc
.DS_Store
*.pem


# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*


# local env files
.env
.env.local
.env.development.local
.env.test.local
.env.production.local


# vercel
.vercel



================================================
FILE: samples/chat-widget/.prettierignore
================================================
node_modules



================================================
FILE: samples/chat-widget/.prettierrc
================================================
{
	"trailingComma": "es5",
	"tabWidth": 4,
	"semi": true,
	"singleQuote": true,
	"endOfLine": "lf",
	"printWidth": 150,
	"plugins": ["@trivago/prettier-plugin-sort-imports"]
}




================================================
FILE: samples/chat-widget/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;



================================================
FILE: samples/chat-widget/src/index.tsx
================================================
import App from './components/App';
import './index.css';
import { provideRtkDesignSystem } from '@cloudflare/realtimekit-react-ui';
import { createRoot } from 'react-dom/client';

// change theme to light
provideRtkDesignSystem(document.body, {
	theme: 'light',
	colors: {
		background: {
			1000: '#FFFFFF',
			900: '#F5F5F5',
			800: '#EBEBEB',
			700: '#E0E0E0',
			600: '#D6D6D6',
		},
		text: '#111111',
		'text-on-brand': '#ffffff',
		'video-bg': '#DADADA',
	},
});

const container = document.getElementById('root') as HTMLDivElement;
const root = createRoot(container);

root.render(<App />);



================================================
FILE: samples/chat-widget/src/server.ts
================================================
/* eslint-disable @typescript-eslint/no-unused-vars */

/** NOTE: This code should be on the server side */
const ORG_ID = import.meta.env.VITE_ORG_ID;
const API_KEY = import.meta.env.VITE_API_KEY;
const API_BASE = 'https://api.dyte.io';

const getAuthToken = () => {
	return `Basic ${btoa(`${ORG_ID}:${API_KEY}`)}`;
};

export const createParticipant = async (meetingId: string, name: string, email: string) => {
	const participantResponse = await fetch(`${API_BASE}/v2/meetings/${meetingId}/participants`, {
		headers: {
			accept: 'application/json',
			authorization: getAuthToken(),
			'content-type': 'application/json',
		},
		body: `{"client_specific_id":"${email}","preset_name":"chat","name":"${name}"}`,
		method: 'POST',
		mode: 'cors',
	})
		.then((res) => res.json())
		.catch((err) => {
			console.log('Error: ', err);
		});

	const participant = participantResponse.data;

	return participant.token as string;
};

export const createMeeting = async (name: string, email: string) => {
	const meetingResponse = await fetch(`${API_BASE}/v2/meetings`, {
		headers: {
			accept: 'application/json',
			authorization: getAuthToken(),
			'content-type': 'application/json',
		},
		body: `{"title":"RealtimeKit <> ${name}"}`,
		method: 'POST',
		mode: 'cors',
	})
		.then((res) => res.json())
		.catch((err) => {
			console.log('Error: ', err);
		});

	const meeting = meetingResponse.data;

	// create participant for agent and notify them that someone has initiated a chat
	const _agentToken = await createParticipant(meeting.id, 'Agent', 'support@dyte.io');
	// notify(_agentToken);

	const token = await createParticipant(meeting.id, name, email);
	return token;
};



================================================
FILE: samples/chat-widget/src/components/App.tsx
================================================
import Widget from './Widget';

function App() {
	return (
		<div>
			Welcome
			<Widget />
		</div>
	);
}

export default App;



================================================
FILE: samples/chat-widget/src/components/ChatPopup.tsx
================================================
import { RtkChat, RtkMeeting, RtkSpinner } from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import { ChatChannel } from '@cloudflare/realtimekit';
import { useEffect, useState } from 'react';

type RtkMeeting = Awaited<ReturnType<typeof useRealtimeKitClient>>[0];

const ChatPopup = ({ meeting }: { meeting: RtkMeeting }) => {
	const [channel, setChannel] = useState<ChatChannel | null>(null);

	useEffect(() => {
		if (!meeting) return;
		if (channel) return;
		const createChannel = async () => {
			if (!meeting.self.roomJoined) {
				await meeting.joinRoom();
			}
			const memberIds = meeting.participants.all.toArray().map((p) => p.userId);
			const createdChannel = await meeting.chat.createChannel(meeting.meta.meetingTitle, memberIds);
			setChannel(createdChannel);
		};
		createChannel();
	}, [channel, meeting]);

	if (meeting && channel) {
		return (
            <main className="flex h-96 w-96 flex-col rounded-md p-2">
                <RtkChat meeting={meeting} />
            </main>
        );
	}

	// loader
	return (
        <main className="flex w-96 justify-center rounded-md p-2">
            <RtkSpinner size="xl" />
        </main>
    );
};
export default ChatPopup;



================================================
FILE: samples/chat-widget/src/components/Form.tsx
================================================
import { useRef } from 'react';

export default function Form({ onSubmit }: { onSubmit: (args: { name: string; email: string }) => void }) {
	const nameRef = useRef<HTMLInputElement>(null);
	const emailRef = useRef<HTMLInputElement>(null);

	const handleFormData = () => {
		const name = nameRef.current?.value;
		const email = emailRef.current?.value;
		if (name && email) {
			onSubmit({ name, email });
		}
	};

	return (
		<div className="mx-auto rounded-md bg-white p-6 shadow-sm">
			<div className="space-y-4">
				<div className="relative">
					<input
						className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm file:border-0 file:bg-transparent file:text-sm file:font-medium focus:border-blue-400 focus:outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
						id="name"
						placeholder="Enter your name"
						type="text"
						ref={nameRef}
					/>
				</div>
				<div className="relative">
					<input
						className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm file:border-0 file:bg-transparent file:text-sm file:font-medium focus:border-blue-400 focus:outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
						id="email"
						placeholder="Enter your email"
						type="email"
						ref={emailRef}
					/>
				</div>
				<button
					className="inline-flex w-full items-center justify-center whitespace-nowrap rounded-md bg-blue-500 px-3 py-2 text-sm font-medium text-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"
					type="button"
					onClick={handleFormData}
				>
					Submit
				</button>
			</div>
		</div>
	);
}



================================================
FILE: samples/chat-widget/src/components/Widget.tsx
================================================
import { createMeeting } from '../server';
import ChatPopup from './ChatPopup';
import Form from './Form';
import WidgetLauncher from './WidgetLauncher';
import { useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import { useState } from 'react';

const STEP = {
	FORM: 0,
	CHAT: 1,
};

const Widget = () => {
	const [step, setStep] = useState(STEP.FORM);
	const [popupVisible, setPopupVisible] = useState(false);
	const [meeting, initMeeting] = useRealtimeKitClient();

	const onSubmit = async ({ name, email }: { name: string; email: string }) => {
		setStep(STEP.CHAT);
		const authToken = await createMeeting(name, email);
		initMeeting({
			authToken,
			defaults: {
				audio: false,
				video: false,
			},
		});
	};

	const togglePopup = () => {
		setPopupVisible(!popupVisible);
	};

	return (
		<div className="fixed bottom-10 right-6 flex flex-col items-end gap-2">
			{popupVisible && (
				<div className="max-w-md rounded-md shadow-md ring-1 ring-gray-200">
					{step === STEP.CHAT && <ChatPopup meeting={meeting} />}
					{step === STEP.FORM && <Form onSubmit={onSubmit} />}
				</div>
			)}
			<WidgetLauncher onClick={togglePopup} />
		</div>
	);
};
export default Widget;



================================================
FILE: samples/chat-widget/src/components/WidgetLauncher.tsx
================================================
import * as React from 'react';

const WidgetLauncher = ({ onClick }: { onClick: () => void }) => (
	<aside className="h-12 w-12 cursor-pointer rounded-full bg-blue-600 p-2 text-white" onClick={onClick}>
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height={32} width={32}>
			<path
				fill="currentColor"
				d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.96 9.96 0 0 1-4.587-1.112l-3.826 1.067a1.25 1.25 0 0 1-1.54-1.54l1.068-3.823A9.96 9.96 0 0 1 2 12C2 6.477 6.477 2 12 2Zm0 1.5A8.5 8.5 0 0 0 3.5 12c0 1.47.373 2.883 1.073 4.137l.15.27-1.112 3.984 3.987-1.112.27.15A8.5 8.5 0 1 0 12 3.5ZM8.75 13h4.498a.75.75 0 0 1 .102 1.493l-.102.007H8.75a.75.75 0 0 1-.102-1.493L8.75 13h4.498H8.75Zm0-3.5h6.505a.75.75 0 0 1 .101 1.493l-.101.007H8.75a.75.75 0 0 1-.102-1.493L8.75 9.5h6.505H8.75Z"
			/>
		</svg>
	</aside>
);
export default WidgetLauncher;



================================================
FILE: samples/clubhouse/README.md
================================================
# Default Meeting UI Sample

This sample showcases the simplest way to create a Clubhouse clone with RealtimeKit's React UI Kit!

## Prerequisites

1. Preset for Speaker should have the following.
- Stage & Media Enabled
- Accept Requests Enabled
- "Allowed to Join" as Behaviour

2. Preset for Listener should have the following.
- Stage & Media Enabled
- Accept Requests Disabled
- "Can request to join" as Behaviour

### Screenshots

Speaker's UI:

<img src="./docs/screenshot-speaker.png" width="280" alt="A screenshot of the clubhouse sample for the speaker" />

Listener's UI:

<img src="./docs/screenshot-listener.png" width="280" alt="A screenshot of the clubhouse sample for the listener" />

[See source](./src/App.tsx)



================================================
FILE: samples/clubhouse/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Default Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>

    <svg width="0" height="0">
      <defs>
        <clipPath id="squircle" clipPathUnits="objectBoundingBox">
          <path
            d="M .5,0 C .1,0 0,.1 0,.5 0,.9 .1,1 .5,1 .9,1 1,.9 1,.5 1,.1 .9,0 .5,0 Z"
          />
        </clipPath>
      </defs>
    </svg>

    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/clubhouse/package.json
================================================
{
  "name": "clubhouse",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-feather": "^2.0.10"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^4.3.0",
    "autoprefixer": "^10.4.14",
    "clsx": "^1.2.1",
    "postcss": "^8.4.24",
    "tailwindcss": "^3.3.2",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/clubhouse/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/clubhouse/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/clubhouse/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/clubhouse/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/clubhouse/vite.config.ts
================================================
import react from '@vitejs/plugin-react';
import { defineConfig } from 'vite';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/clubhouse/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?




================================================
FILE: samples/clubhouse/src/App.tsx
================================================
import Meeting from './components/Meeting';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
} from '@cloudflare/realtimekit-react';
import {
  provideRtkDesignSystem,
  RtkUiProvider,
} from '@cloudflare/realtimekit-react-ui';
import { useEffect } from 'react';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }
    const baseURI = searchParams.get('baseURI') ?? 'realtime.cloudflare.com';

    initMeeting({
      authToken,
      defaults: {
        video: false,
        audio: false,
      },
      baseURI,
    }).then((m) => {
      Object.assign(window, { meeting: m });
    });
  }, []);

  return (
    <div className="w-full max-w-lg mx-auto h-full bg-gray-100">
      <RealtimeKitProvider
        value={meeting}
        fallback={
          <div className="w-full h-full flex  items-center justify-center">
            Loading...
          </div>
        }
      >
        <RtkUiProvider
          meeting={meeting}
          showSetupScreen={window.location.search.includes('showSetupScreen')}
        >
          <Meeting />
        </RtkUiProvider>
      </RealtimeKitProvider>
    </div>
  );
}

export default App;



================================================
FILE: samples/clubhouse/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    height: 100%;
  }
}

@layer components {
  .squircle {
    clip-path: url(#squircle);
  }

  .icon-btn {
    @apply h-9 px-2 bg-gray-200 border rounded-md;
    @apply inline-flex place-items-center justify-center gap-2;
  }

  .icon-btn > svg {
    @apply h-5 w-5;
  }
}



================================================
FILE: samples/clubhouse/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/clubhouse/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/clubhouse/src/components/icons.tsx
================================================
import { ComponentProps } from 'react';

export function StarIcon(props: ComponentProps<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      {...props}
    >
      <path
        fill="currentColor"
        d="M10.788 3.103c.495-1.004 1.926-1.004 2.421 0l2.358 4.777 5.273.766c1.107.161 1.549 1.522.748 2.303l-3.816 3.72.901 5.25c.19 1.103-.968 1.944-1.959 1.424l-4.716-2.48-4.715 2.48c-.99.52-2.148-.32-1.96-1.424l.901-5.25-3.815-3.72c-.801-.78-.359-2.142.748-2.303L8.43 7.88l2.358-4.777z"
      />
    </svg>
  );
}

export function HandIcon(props: ComponentProps<'svg'>) {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      {...props}
    >
      <path
        fill="currentColor"
        d="M11.998 3.997v6.253a.75.75 0 001.5 0V5.223c0-.239.204-.475.498-.477a.527.527 0 01.504.504v7.5a.75.75 0 001.295.515l.004-.003a1.958 1.958 0 01.124-.119 4.42 4.42 0 01.401-.32c.352-.25.81-.496 1.303-.582.537-.094 1.047-.037 1.385.138a.819.819 0 01.446.528l-1.659 1.247a.764.764 0 00-.08.069l-2.174 2.173a12.265 12.265 0 00-2.303 3.194 1.65 1.65 0 01-1.475.911H9.04c-.571 0-1.068-.273-1.325-.713C6.978 18.528 6 16.5 6 14.754V7a.5.5 0 01.501-.5c.29 0 .503.23.503.5v3.5a.75.75 0 001.5 0V5.25c0-.278.215-.504.496-.504.287 0 .5.225.5.504v5a.75.75 0 001.5 0V3.997c0-.273.212-.5.499-.5.29 0 .5.223.5.5zm1.989-.751a2.028 2.028 0 00-.6.093l.6-.093zm-.6.093a1.977 1.977 0 00-1.89-1.342c-.915 0-1.622.586-1.885 1.341A2.032 2.032 0 009 3.246c-1.109 0-1.896.856-1.987 1.818A2.043 2.043 0 006.5 5c-1.169 0-2 .96-2 2v7.754c0 2.18 1.171 4.511 1.918 5.79.557.954 1.58 1.457 2.621 1.457h2.728a3.149 3.149 0 002.817-1.74 10.764 10.764 0 012.02-2.804l2.139-2.136L20.7 13.85a.75.75 0 00.299-.6c0-1.062-.531-1.807-1.3-2.204-.715-.37-1.581-.414-2.332-.283a4.464 4.464 0 00-1.368.495V5.25c0-1.06-.888-2.01-2.013-2.004"
      />
    </svg>
  );
}



================================================
FILE: samples/clubhouse/src/components/Meeting.tsx
================================================
import Requests from './Requests';
import User from './User';
import { HandIcon } from './icons';
import {
  useRealtimeKitMeeting,
  useRealtimeKitSelector,
} from '@cloudflare/realtimekit-react';
import {
  RtkParticipantsAudio,
  RtkSetupScreen,
} from '@cloudflare/realtimekit-react-ui';
import clsx from 'clsx';
import { useEffect, useState } from 'react';
import { Clipboard, Mic, MicOff, XSquare } from 'react-feather';

export default function Meeting() {
  const [showRequests, setShowRequests] = useState(true);

  const { meeting } = useRealtimeKitMeeting();
  const audioEnabled = useRealtimeKitSelector((m) => m.self.audioEnabled);
  const roomJoined = useRealtimeKitSelector((m) => m.self.roomJoined);

  const title = useRealtimeKitSelector((m) => m.meta.meetingTitle);

  const status = useRealtimeKitSelector((m) => m.stage.status);

  const onStageParticipants = useRealtimeKitSelector((m) =>
    m.participants.joined.toArray().filter((p) => p.stageStatus === 'ON_STAGE')
  );

  const listeners = useRealtimeKitSelector((m) =>
    m.participants.joined.toArray().filter((p) => p.stageStatus !== 'ON_STAGE')
  );

  const isSelfListener = meeting.stage.status !== 'ON_STAGE';

  useEffect(() => {
    if (status === 'ACCEPTED_TO_JOIN_STAGE') {
      meeting.stage.join();
    }
  }, [status]);

  if (!roomJoined && window.location.search.includes('showSetupScreen')) {
    return <RtkSetupScreen meeting={meeting} size="sm" />;
  }

  return (
    <div className="flex flex-col w-full h-full">
      <RtkParticipantsAudio meeting={meeting} />
      <div className="flex-1 flex flex-col">
        <h1 className="text-lg font-bold p-4">{title}</h1>

        <main className="flex flex-col gap-4 flex-1 overflow-y-auto p-4">
          <div className="flex flex-wrap gap-4">
            {onStageParticipants.map((participant) => (
              <User participant={participant} key={participant.id} />
            ))}
            {!isSelfListener && <User participant={meeting.self} />}
          </div>

          {(isSelfListener || listeners.length > 0) && (
            <div className="mt-4">
              <h3 className="text-xs text-gray-500 font-medium">Listeners</h3>

              <div className="flex flex-wrap gap-4 mt-4">
                {isSelfListener && (
                  <User participant={meeting.self} size="sm" />
                )}

                {listeners.map((participant) => (
                  <User
                    participant={participant}
                    key={participant.id}
                    size="sm"
                  />
                ))}
              </div>
            </div>
          )}
        </main>

        <div className="border-t w-full flex items-center justify-between p-4 text-xs">
          <div className="flex items-center gap-2">
            <button
              className="icon-btn text-red-500"
              onClick={() => meeting.stage.leave()}
            >
              <XSquare />
              Leave
            </button>
          </div>

          <div className="flex items-center gap-2">
            {meeting.self.permissions.acceptPresentRequests && (
              <button
                className="icon-btn"
                onClick={() => setShowRequests((r) => !r)}
              >
                <Clipboard className="" />
              </button>
            )}

            {(status === 'OFF_STAGE' ||
              status === 'REQUESTED_TO_JOIN_STAGE') && (
              <button
                className="icon-btn"
                onClick={() => {
                  if (status === 'REQUESTED_TO_JOIN_STAGE') {
                    meeting.stage.cancelRequestAccess();
                  } else {
                    meeting.stage.requestAccess();
                  }
                }}
              >
                <HandIcon
                  className={clsx(
                    status === 'REQUESTED_TO_JOIN_STAGE' && 'rotate-180'
                  )}
                />
                {status === 'REQUESTED_TO_JOIN_STAGE'
                  ? 'Lower hand'
                  : 'Raise hand'}
              </button>
            )}

            {status === 'ON_STAGE' && (
              <button
                className="icon-btn"
                onClick={() => {
                  if (meeting.self.audioEnabled) {
                    meeting.self.disableAudio();
                  } else {
                    meeting.self.enableAudio();
                  }
                }}
              >
                {audioEnabled ? <Mic /> : <MicOff />}
              </button>
            )}
          </div>
        </div>
      </div>
      {showRequests && <Requests />}
    </div>
  );
}



================================================
FILE: samples/clubhouse/src/components/Requests.tsx
================================================
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import { Check, X } from 'react-feather';

export default function Requests() {
  const { meeting } = useRealtimeKitMeeting();

  const participants = useRealtimeKitSelector((m) => m.participants.joined).toArray();

  const requestedParticipants = participants.filter(
    (p) => p.stageStatus === 'REQUESTED_TO_JOIN_STAGE'
  );

  if (!meeting.self.permissions.acceptPresentRequests) {
    return null;
  }

  return (
    <div className="w-full min-h-[20vh] max-h-[50vh] p-4 bg-gray-200">
      <h2 className="text-lg font-semibold">Requests</h2>

      {requestedParticipants.length === 0 && (
        <p className="text-xs text-gray-600">There are no requests.</p>
      )}

      <div className="flex flex-col gap-2 mt-3">
        {requestedParticipants.map((p) => (
          <div className="flex items-center justify-between text-sm" key={p.id}>
            <div>{p.name}</div>
            <div className="flex gap-2">
              <button
                className="icon-btn text-red-600"
                onClick={() => meeting.stage.denyAccess([p.id])}
              >
                <X />
              </button>
              <button
                className="icon-btn text-green-700"
                onClick={() => meeting.stage.grantAccess([p.userId])}
              >
                <Check />
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}



================================================
FILE: samples/clubhouse/src/components/User.tsx
================================================
import { RtkAvatar, RtkAudioVisualizer } from '@cloudflare/realtimekit-react-ui';
import type { RTKParticipant, RTKSelf } from '@cloudflare/realtimekit';
import { StarIcon } from './icons';
import clsx from 'clsx';

export default function User({
  participant,
  size,
}: {
  participant: RTKParticipant | RTKSelf;
  size?: 'sm';
}) {
  return (
    <div className="flex flex-col items-center gap-2">
      <div className="relative">
        <RtkAvatar
          participant={participant}
          size="sm"
          className={clsx(
            'rounded-none squircle',
            size === 'sm' ? 'h-14 w-14' : 'h-16 w-16'
          )}
        />
        <div className="absolute -bottom-2 -right-1 bg-white rounded-full p-1 scale-[80%]">
          <RtkAudioVisualizer participant={participant} size="sm" />
        </div>
      </div>
      <div className="text-xs font-medium flex items-center gap-0.5 flex-wrap">
        {participant.presetName === 'webinar_presenter' &&
          participant.stageStatus === 'ON_STAGE' && (
            <StarIcon className="h-4 w-4 text-green-600" />
          )}
        {participant.name}
      </div>
    </div>
  );
}



================================================
FILE: samples/create-your-own-ui/README.md
================================================
# Create Your Own UI

Unlike traditional samples where devs are given a fixed UI, this sample let's you pick your own variant from a variety of variants for a component.

For example, There are a few variants of [Setup Screen component file](./src/components/setup-screen.tsx).

```tsx
export default SetupScreenPreBuilt;

export default CustomSetupScreenWithPrebuiltMediaPreviewModal;

export default CustomSetupScreenWithCustomMediaPreviewModal;
```

All you have to do, to pick a variant of your choice, is to comment out the undesired variants and only uncomment the one you want. Once you have made up your mind, you can copy paste the code to your application.

## How to run?

1. Run `npm install` in the current [folder](./)
2. Run `npm run dev` to start a server. See the port in the logs of this command. Default is 5173.
3. Open browser with the URL `http://localhost:5173/?authToken=PUT_PARTICIPANT_AUTH_TOKEN_HERE`. Change the port if needed.

To learn more, refer to [the source code](./src/App.tsx)



================================================
FILE: samples/create-your-own-ui/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/create-your-own-ui/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^5.0.3",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
   "@vitejs/plugin-react": "^4.3.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.30",
    "prettier": "^3.0.3",
    "tailwindcss": "^3.3.3",
    "typescript": "^5.8.2",
    "vite": "^6.2.3"
  }
}



================================================
FILE: samples/create-your-own-ui/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/create-your-own-ui/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/create-your-own-ui/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/create-your-own-ui/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/create-your-own-ui/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base: './',
  plugins: [react()],
});



================================================
FILE: samples/create-your-own-ui/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/create-your-own-ui/src/App.tsx
================================================
import { useEffect } from 'react';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
  useRealtimeKitMeeting,
} from '@cloudflare/realtimekit-react';
import { RtkDialogManager, RtkUiProvider } from '@cloudflare/realtimekit-react-ui';
import CustomRtkMeeting from './components/custom-rtk-meeting';
import { useStatesStore } from './store';

function Meeting() {
  const { meeting } = useRealtimeKitMeeting();

  useEffect(() => {
    if (meeting) {
      /**
       * NOTE(ravindra-dyte):
       * During development phase, make sure to expose meeting object to window,
       * for debugging purposes.
       */
      Object.assign(window, {
        meeting,
      });
    }
  }, [meeting]);

  return <CustomRtkMeeting />;
}

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();
  const setStates = useStatesStore((s) => s.setStates);

  useEffect(() => {
    async function initalizeMeeting() {
      const searchParams = new URL(window.location.href).searchParams;

      const authToken = searchParams.get('authToken');

      if (!authToken) {
        alert(
          "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting.",
        );
        return;
      }

      initMeeting({
        authToken,
        defaults: {
          audio: false,
          video: false,
        },
      });
    }

    if (!meeting) {
      initalizeMeeting();
    }
  }, [meeting]);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider value={meeting}>
      <RtkUiProvider
        meeting={meeting}
        onRtkStatesUpdate={(e) => {
          setStates(e.detail);
        }}
        showSetupScreen
        style={{ height: '100%', width: '100%', display: 'block' }}
      >
        <Meeting />
        <RtkDialogManager />
      </RtkUiProvider>
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/create-your-own-ui/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    height: 100%;
    background: #000;
    color: #fff;
  }
}



================================================
FILE: samples/create-your-own-ui/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root')!).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />,
);



================================================
FILE: samples/create-your-own-ui/src/store.ts
================================================
import { getInitialStates, States } from '@cloudflare/realtimekit-ui';
import { create } from 'zustand';
import { CustomStates } from './types';

type StatesStore = {
  states: States;
  setStates: (states: States) => void;
};

export const useStatesStore = create<StatesStore>((set) => ({
  states: getInitialStates(),
  setStates: (states) => set({ states }),
}));

type CustomStatesStore = {
  states: CustomStates;
  setCustomStates: (states: CustomStates) => void;
};

export const useCustomStatesStore = create<CustomStatesStore>((set) => ({
  states: {},
  setCustomStates: (states) => set({ states }),
}));



================================================
FILE: samples/create-your-own-ui/src/types.tsx
================================================
import { RtkSidebarSection } from '@cloudflare/realtimekit-ui/dist/types/components/rtk-sidebar/rtk-sidebar';

export type CustomSideBarTabs = RtkSidebarSection | 'warnings';

export type CustomStates = {
  activeMediaPreviewModal?: boolean;
};

export type SetStates = React.Dispatch<React.SetStateAction<CustomStates>>;



================================================
FILE: samples/create-your-own-ui/src/utils.ts
================================================
import { UIConfig } from '@cloudflare/realtimekit-ui';

export function setFullScreenToggleTargetElement({config, targetElementId}: { config: UIConfig, targetElementId: string }){
    if (config.root && Array.isArray(config.root['div#controlbar-left'])) {
        const fullScreenToggleIndex = config.root['div#controlbar-left'].indexOf('rtk-fullscreen-toggle');
        if(fullScreenToggleIndex > -1){
            config.root['div#controlbar-left'][fullScreenToggleIndex] = ['rtk-fullscreen-toggle', {
                variant: 'vertical',
                targetElement: document.querySelector(`#${targetElementId}`),
            }];
        }
    }
    ['rtk-more-toggle.activeMoreMenu', 'rtk-more-toggle.activeMoreMenu.md', 'rtk-more-toggle.activeMoreMenu.sm'].forEach((configElemKey) => {
        const configElem = config?.root?.[configElemKey] as any;
        configElem?.forEach((rtkElemConfigSet: any) => {
            if (rtkElemConfigSet[0] === 'rtk-fullscreen-toggle') {
                rtkElemConfigSet[1].targetElement = document.querySelector(`#${targetElementId}`);
            }
        });
    });
}


================================================
FILE: samples/create-your-own-ui/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/create-your-own-ui/src/components/audio-preview.tsx
================================================
import { useEffect, useRef, useState } from 'react';
import {
  RtkAudioVisualizer,
  RtkButton,
  RtkIcon,
  RtkSettingsAudio,
  RtkSwitch,
  defaultIconPack,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
interface CurrentDevices {
  audio?: MediaDeviceInfo;
  speaker?: MediaDeviceInfo;
}

function AudioPreviewPreBuilt() {
  return <RtkSettingsAudio />;
}

function AudioPreviewWithCustomUI() {
  const { meeting } = useRealtimeKitMeeting();

  const [audioDevices, setAudioDevices] = useState<MediaDeviceInfo[]>([]);
  const [speakerDevices, setSpeakerDevices] = useState<MediaDeviceInfo[]>([]);
  const [currentDevices, setCurrentDevices] = useState<CurrentDevices>({});
  const testAudioEl = useRef<HTMLAudioElement>(null);

  useEffect(() => {
    if (!meeting) {
      return;
    }
    const deviceListUpdateCallback = async () => {
      setAudioDevices(await meeting.self.getAudioDevices());
      setSpeakerDevices(await meeting.self.getSpeakerDevices());
    };
    meeting.self.addListener('deviceListUpdate', deviceListUpdateCallback);
    //populate first time values
    deviceListUpdateCallback();
    setCurrentDevices({
      audio: meeting.self.getCurrentDevices().audio,
      speaker: meeting.self.getCurrentDevices().speaker,
    });
    return () => {
      meeting.self.removeListener('deviceListUpdate', deviceListUpdateCallback);
    };
  }, [meeting]);
  const setDevice = (kind: 'audio' | 'speaker', deviceId: string) => {
    // if (disableSettingSinkId(this.meeting)) return;
    const device =
      kind === 'audio'
        ? audioDevices.find((d) => d.deviceId === deviceId)
        : speakerDevices.find((d) => d.deviceId === deviceId);
    setCurrentDevices((oldDevices) => {
      return {
        ...oldDevices,
        [kind]: device,
      };
    });
    if (device != null) {
      meeting.self.setDevice(device);
      if (device.kind === 'audiooutput') {
        if ((testAudioEl.current as any)?.setSinkId) {
          (testAudioEl.current as any)?.setSinkId(device.deviceId);
        }
      }
    }
  };
  let unnamedMicCount = 0;
  let unnamedSpeakerCount = 0;
  const testAudio = () => {
    testAudioEl?.current?.play();
  };
  return (
    <div className="flex flex-col p-4">
      <audio
        preload="auto"
        src="https://assets.dyte.io/ui-kit/speaker-test.mp3"
        ref={testAudioEl}
      />
      {meeting.self.permissions.canProduceAudio === 'ALLOWED' && (
        <div>
          <label>Microphone</label>
          <div>
            <select
              className="mt-2 w-full text-ellipsis bg-[#1F1F1F] p-2"
              onChange={(e) =>
                setDevice('audio', (e.target as HTMLSelectElement).value)
              }
            >
              {audioDevices.map(({ deviceId, label }) => (
                <option
                  key={deviceId}
                  value={deviceId}
                  selected={currentDevices.audio?.deviceId === deviceId}
                >
                  {label || `Microphone ${++unnamedMicCount}`}
                </option>
              ))}
            </select>
            <RtkAudioVisualizer participant={meeting?.self} />
          </div>
        </div>
      )}
      <div>
        {speakerDevices.length > 0 && (
          <div>
            <label>Speaker Output</label>
            <div>
              <select
                className="mt-2 w-full text-ellipsis bg-[#1F1F1F] p-2"
                onChange={(e) =>
                  setDevice('speaker', (e.target as HTMLSelectElement).value)
                }
              >
                {speakerDevices.map(({ deviceId, label }) => (
                  <option
                    key={deviceId}
                    value={deviceId}
                    selected={currentDevices.speaker?.deviceId === deviceId}
                  >
                    {label || `Speaker ${++unnamedSpeakerCount}`}
                  </option>
                ))}
              </select>
            </div>
          </div>
        )}
        <RtkButton
          className="mt-2 bg-[#1F1F1F]"
          onClick={() => testAudio()}
          size="lg"
        >
          <RtkIcon icon={defaultIconPack.speaker} slot="start" />
          Test
        </RtkButton>
      </div>
    </div>
  );
}

// export default AudioPreviewPreBuilt; // uncomment if you want to use prebuilt audio preview
export default AudioPreviewWithCustomUI; // uncomment if you want custom ui for audio preview



================================================
FILE: samples/create-your-own-ui/src/components/custom-rtk-meeting.tsx
================================================
import InMeeting from './in-meeting';
import {
  RtkEndedScreen,
  RtkIdleScreen,
  RtkSetupScreen,
  RtkWaitingScreen,
} from '@cloudflare/realtimekit-react-ui';
import { useCustomStatesStore, useStatesStore } from '../store';
import SetupScreen from './setup-screen';

function CustomRtkMeeting() {
  const states = useStatesStore((s) => s.states);
  const customStates = useCustomStatesStore((s) => s.states);
  console.log(states, customStates);

  switch (states.meeting) {
    case 'idle':
      return <RtkIdleScreen />;
    case 'setup':
      return <SetupScreen />;
    case 'waiting':
      return <RtkWaitingScreen />;
    case 'ended':
      return <RtkEndedScreen />;
    case 'joined':
    default:
      return <InMeeting />;
  }
}

export default CustomRtkMeeting;



================================================
FILE: samples/create-your-own-ui/src/components/in-meeting.tsx
================================================
import {
  RtkStage,
  RtkGrid,
  RtkNotifications,
  RtkParticipantsAudio,
} from '@cloudflare/realtimekit-react-ui';
import MeetingHeader from './meeting-header';
import MeetingControlBar from './meeting-control-bar';
import MeetingSideBar from './meeting-sidebar';

function InMeeting() {
  return (
    <div className="flex flex-col w-full h-full">
      <header>
        <MeetingHeader />
      </header>
      <main className="flex w-full flex-1">
        <RtkStage className="flex w-full flex-1 p-2">
          <RtkGrid />
          <RtkNotifications />
          <MeetingSideBar />
        </RtkStage>
        <RtkParticipantsAudio />
      </main>
      <footer className="flex w-full overflow-visible">
        <MeetingControlBar />
      </footer>
    </div>
  );
}

export default InMeeting;



================================================
FILE: samples/create-your-own-ui/src/components/media-preview-modal.tsx
================================================
import { RtkDialog, RtkIcon, defaultIconPack } from '@cloudflare/realtimekit-react-ui';
import { useState } from 'react';
import AudioPreview from './audio-preview';
import VideoPreview from './video-preview';
import { useCustomStatesStore } from '../store';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';

function MediaPreviewModal({ open }: { open: boolean }) {
  const { meeting } = useRealtimeKitMeeting();
  const [activeTab, setActiveTab] = useState<'audio' | 'video'>('video');
  const setCustomStates = useCustomStatesStore((s) => s.setCustomStates);

  return (
    <RtkDialog
      open={open}
      onRtkDialogClose={() => {
        setCustomStates({ activeMediaPreviewModal: false });
      }}
    >
      <div className="flex min-w-[720px] min-h-[480px] bg-[#222222]">
        <aside className="flex flex-col w-1/3 bg-[#181818]">
          <header className="flex justify-center items-center h-[100px]">
            <h2>Media Preview</h2>
          </header>
          {meeting.self.permissions.canProduceAudio === 'ALLOWED' && (
            <button
              type="button"
              className={`${activeTab === 'audio' ? 'bg-[#2160FD]' : ''} flex justify-between p-2 rounded`}
              onClick={() => setActiveTab('audio')}
            >
              Audio
              <div>
                <RtkIcon icon={defaultIconPack.mic_on} />
              </div>
            </button>
          )}
          {meeting.self.permissions.canProduceVideo === 'ALLOWED' && (
            <button
              type="button"
              className={`${activeTab === 'video' ? 'bg-[#2160FD]' : ''} flex justify-between p-2 rounded`}
              onClick={() => setActiveTab('video')}
            >
              Video
              <div>
                <RtkIcon icon={defaultIconPack.video_on} />
              </div>
            </button>
          )}
        </aside>
        <main className="flex flex-col w-2/3">
          {activeTab === 'audio' && <AudioPreview />}
          {activeTab === 'video' && <VideoPreview />}
        </main>
      </div>
    </RtkDialog>
  );
}

export default MediaPreviewModal;



================================================
FILE: samples/create-your-own-ui/src/components/meeting-control-bar.tsx
================================================
import {
  RtkBreakoutRoomsToggle,
  RtkCameraToggle,
  RtkChatToggle,
  RtkControlbar,
  RtkControlbarButton,
  RtkFullscreenToggle,
  RtkLeaveButton,
  RtkMicToggle,
  RtkMoreToggle,
  RtkMuteAllButton,
  RtkParticipantsToggle,
  RtkPipToggle,
  RtkPluginsToggle,
  RtkPoll,
  RtkPollsToggle,
  RtkRecordingToggle,
  RtkScreenShareToggle,
  RtkSettingsToggle,
  RtkStageToggle,
} from '@cloudflare/realtimekit-react-ui';
import { defaultIconPack } from '@cloudflare/realtimekit-ui';
import { useStatesStore } from '../store';

function ControlBarPreBuilt() {
  return (<RtkControlbar className="flex w-full overflow-visible	justify-between" />);
}

function ControlBarWithCustomUI() {
  const fullScreenTargetElement = document.querySelector(
    '#root',
  ) as HTMLElement;

  const states = useStatesStore((s) => s.states);

  return (
    <div className="flex w-full py-2 px-3 text-white justify-between">
      <div
        id="controlbar-left"
        className="flex items-center overflow-visible justify-center"
      >
        <RtkFullscreenToggle targetElement={fullScreenTargetElement} />
        <RtkSettingsToggle />
        <RtkScreenShareToggle />
      </div>
      <div
        id="controlbar-center"
        className="flex items-center overflow-visible justify-center"
      >
        <RtkMicToggle />
        <RtkCameraToggle />
        <RtkStageToggle />
        <RtkLeaveButton />
        <RtkMoreToggle>
          <div slot="more-elements">
            <RtkPipToggle variant="horizontal" />
            <RtkMuteAllButton variant="horizontal" />
            <RtkBreakoutRoomsToggle variant="horizontal" />
            <RtkRecordingToggle variant="horizontal" />
          </div>
        </RtkMoreToggle>
      </div>
      <div
        id="controlbar-right"
        className="flex items-center overflow-visible justify-center"
      >
        <RtkChatToggle />
        <RtkPollsToggle />
        <RtkParticipantsToggle />
        <RtkPluginsToggle />
        <RtkControlbarButton
          icon={defaultIconPack.add}
          label="Open Custom Sidebar"
          onClick={(e) => {
            console.log(states.activeSidebar);
            e.currentTarget.dispatchEvent(
              new CustomEvent('rtkStateUpdate', {
                detail: {
                  activeSidebar:
                    (states.sidebar as any) !== 'warnings'
                      ? true
                      : !states.activeSidebar,
                  sidebar: 'warnings',
                },
                bubbles: true,
                composed: true,
              }),
            );
          }}
        />
      </div>
    </div>
  );
}

// export default ControlBarPreBuilt; // uncomment if you are fine with prebuilt control bar
export default ControlBarWithCustomUI; // uncomment if you want to create a custom control bar



================================================
FILE: samples/create-your-own-ui/src/components/meeting-header.tsx
================================================
import {
  RtkClock,
  RtkGridPagination,
  RtkHeader,
  RtkLivestreamIndicator,
  RtkLogo,
  RtkMeetingTitle,
  RtkParticipantCount,
  RtkRecordingIndicator,
  RtkViewerCount,
} from '@cloudflare/realtimekit-react-ui';

function HeaderPreBuilt() {
  return <RtkHeader className="flex justify-between bg-black" />;
}

function HeaderWithCustomUI() {
  return (
    <div className="flex justify-between bg-black text-white">
      <div id="header-left" className="flex items-center h-[48px]">
        <RtkLogo />
        <RtkRecordingIndicator />
        <RtkLivestreamIndicator />
      </div>
      <div id="header-center" className="flex items-center h-[48px]">
        <RtkMeetingTitle />
      </div>
      <div id="header-right" className="flex items-center h-[48px]">
        <RtkGridPagination />
        <RtkParticipantCount />
        <RtkViewerCount />
        <RtkClock />
      </div>
    </div>
  );
}

export default HeaderPreBuilt; // uncomment if you want the pre built RealtimeKit header
// export default HeaderWithCustomUI; // uncomment if yoi want custom UI



================================================
FILE: samples/create-your-own-ui/src/components/meeting-sidebar.tsx
================================================
import {
  RtkChat,
  RtkParticipants,
  RtkPlugins,
  RtkPolls,
  RtkSidebar,
  RtkSidebarUi,
} from '@cloudflare/realtimekit-react-ui';
import { useState } from 'react';
import { RtkSidebarView } from '@cloudflare/realtimekit-ui/dist/types/components/rtk-sidebar-ui/rtk-sidebar-ui';
import { useCustomStatesStore, useStatesStore } from '../store';

function SidebarPreBuilt() {
  const states = useStatesStore((s) => s.states);

  if (!states.activeSidebar) {
    return null;
  }

  return <RtkSidebar />;
}

const tabs = [
  { id: 'chat', name: 'chat' },
  { id: 'polls', name: 'polls' },
  { id: 'participants', name: 'participants' },
  { id: 'plugins', name: 'plugins' },
  { id: 'warnings', name: 'warnings' },
];

function SidebarWithCustomUI() {
  const states = useStatesStore((s) => s.states);
  const [view] = useState<RtkSidebarView>('sidebar');

  if (!states.activeSidebar || !states.sidebar) {
    return null;
  }

  const currentTab: typeof states.sidear | 'warnings' = states.sidebar;

  return (
    <RtkSidebarUi
      tabs={tabs}
      currentTab={currentTab}
      view={view}
      className="w-96 max-w-full rounded-xl"
      onSidebarClose={() => {
        // 1. Get a reference to your component's host element
        const rtkSidebarElement = document.querySelector('rtk-sidebar-ui') as HTMLElement;

        // 2. Define the data payload for the event
        const eventPayload = {
          activeSidebar: false,
          sidebar: 'chat' // Assuming 'this.defaultSection' holds a value like 'chat'
        };

        // 3. Create the custom event
        const stateUpdateEvent = new CustomEvent('rtkStateUpdate', {
          detail: eventPayload,
          bubbles: true,  // Allows the event to bubble up through the DOM
          composed: true // Allows the event to cross Shadow DOM boundaries
        });

        // 4. Dispatch the event from the element
        rtkSidebarElement.dispatchEvent(stateUpdateEvent);
      }}
    >
      {currentTab === 'chat' && <RtkChat slot="chat" />}
      {currentTab === 'polls' && <RtkPolls slot="polls" />}
      {currentTab === 'participants' && (
        <RtkParticipants slot="participants" />
      )}
      {currentTab === 'plugins' && <RtkPlugins slot="plugins" />}
      {currentTab === 'warnings' && (
        <div slot="warnings" className="flex justify-center items-center">
          <div>Do not cheat in the exam</div>
        </div>
      )}
    </RtkSidebarUi>
  );
}

// export default SidebarPreBuilt; // Uncomment if you want prebuilt sidebar
export default SidebarWithCustomUI; // Uncomment if you want custom sidebar



================================================
FILE: samples/create-your-own-ui/src/components/setup-screen.tsx
================================================
import type RealtimeKitClient from '@cloudflare/realtimekit';
import { UIConfig } from '@cloudflare/realtimekit-ui/dist/types/types/ui-config';
import { CustomStates, SetStates } from '../types';
import { RtkDialogManager, RtkSetupScreen } from '@cloudflare/realtimekit-react-ui';
import {
  RtkParticipantTile,
  RtkAvatar,
  RtkNameTag,
  RtkAudioVisualizer,
  RtkMicToggle,
  RtkCameraToggle,
  RtkSettingsToggle,
  RtkButton,
  RtkControlbarButton,
  defaultIconPack,
} from '@cloudflare/realtimekit-react-ui';
import MediaPreviewModal from './media-preview-modal';
import { useEffect, useState } from 'react';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
import { useCustomStatesStore } from '../store';

export function SetupScreenPreBuilt() {
  return (
    <main
      className="w-full h-full"
      style={{
        backgroundColor: '#272727',
        color: '#ffffff',
      }}
    >
      <RtkSetupScreen />
    </main>
  );
}

export function CustomSetupScreenWithPrebuiltMediaPreviewModal() {
  const { meeting } = useRealtimeKitMeeting();
  const [participantName, setParticipantName] = useState('');

  useEffect(() => {
    if (!meeting) {
      return;
    }
    setParticipantName(meeting.self.name);
  }, [meeting]);

  return (
    <main>
      <div
        key="on-setup-screen"
        className="flex justify-around w-full h-full p-[5%] bg-black text-white"
      >
        <div className="flex justify-around w-full h-full p-[5%]">
          <RtkParticipantTile participant={meeting.self}>
            <RtkAvatar participant={meeting.self} />
            <RtkNameTag participant={meeting.self}>
              <RtkAudioVisualizer participant={meeting.self} slot="start" />
            </RtkNameTag>
            <div id="user-actions" className="absolute flex bottom-2 right-2">
              <RtkMicToggle size="sm"></RtkMicToggle>
              <RtkCameraToggle size="sm"></RtkCameraToggle>
            </div>
            <div className="absolute top-2 right-2">
              <RtkSettingsToggle size="sm"></RtkSettingsToggle>
            </div>
          </RtkParticipantTile>
          <div className="h-1/2 w-1/4 flex flex-col justify-between">
            <div className="flex flex-col items-center">
              <p>Joining as</p>
              <div>{participantName}</div>
            </div>
            <input
              hidden={!meeting.self.permissions.canEditDisplayName}
              placeholder="Your name"
              className="bg-[#141414] rounded-sm border-[#EEEEEE] focus:border-[#2160FD] p-2.5 mb-10"
              autoFocus
              value={participantName}
              onChange={(event) => setParticipantName(event.target.value)}
            />
            <RtkButton
              kind="wide"
              size="lg"
              style={{ cursor: participantName ? 'pointer' : 'not-allowed' }}
              onClick={async () => {
                if (participantName) {
                  if (meeting.self.permissions.canEditDisplayName) {
                    meeting.self.setName(participantName);
                  }
                  await meeting.join();
                }
              }}
            >
              Join
            </RtkButton>
          </div>
        </div>
      </div>
    </main>
  );
}

export function CustomSetupScreenWithCustomMediaPreviewModal() {
  const { meeting } = useRealtimeKitMeeting();
  const customStates = useCustomStatesStore((s) => s.states);
  const setCustomStates = useCustomStatesStore((s) => s.setCustomStates);
  const [participantName, setParticipantName] = useState('');

  useEffect(() => {
    if (!meeting) {
      return;
    }
    setParticipantName(meeting.self.name);
  }, [meeting]);

  return (
    <div
      key="on-setup-screen"
      className="flex justify-around w-full h-full p-[5%] bg-black text-white"
    >
      <div className="flex justify-around w-full h-full p-[5%]">
        <RtkParticipantTile participant={meeting.self}>
          <RtkAvatar participant={meeting.self} />
          <RtkNameTag participant={meeting.self}>
            <RtkAudioVisualizer participant={meeting.self} slot="start" />
          </RtkNameTag>
          <div id="user-actions" className="absolute flex bottom-2 right-2">
            <RtkMicToggle size="sm" />
            <RtkCameraToggle size="sm" />
          </div>
          <div className="absolute top-2 right-2">
            <RtkControlbarButton
              onClick={() => {
                setCustomStates({
                  activeMediaPreviewModal: true,
                });
              }}
              icon={defaultIconPack.settings}
              label={'Media Preview'}
            />
          </div>
        </RtkParticipantTile>
        <div className="h-1/2 w-1/4 flex flex-col justify-between">
          <div className="flex flex-col items-center">
            <p>Joining as</p>
            <div>{participantName}</div>
          </div>
          <input
            hidden={!meeting.self.permissions.canEditDisplayName}
            placeholder="Your name"
            className="bg-[#141414] rounded-sm border-[#EEEEEE] focus:border-[#2160FD] p-2.5 mb-10"
            autoFocus
            value={participantName}
            onChange={(event) => setParticipantName(event.target.value)}
          />
          <RtkButton
            kind="wide"
            size="lg"
            style={{ cursor: participantName ? 'pointer' : 'not-allowed' }}
            onClick={async () => {
              if (participantName) {
                if (meeting.self.permissions.canEditDisplayName) {
                  meeting.self.setName(participantName);
                }
                await meeting.join();
              }
            }}
          >
            Join
          </RtkButton>
        </div>
        <MediaPreviewModal open={!!customStates.activeMediaPreviewModal} />
      </div>
    </div>
  );
}

// export default SetupScreenPreBuilt; // Uncomment, if you want prebuild setup screen
// export default CustomSetupScreenWithPrebuiltMediaPreviewModal; // Uncomment, if you want custom setup screen with prebuilt media preview
export default CustomSetupScreenWithCustomMediaPreviewModal; // Uncomment, if you want custom setup screen with custom media preview



================================================
FILE: samples/create-your-own-ui/src/components/video-preview.tsx
================================================
import { useEffect, useRef, useState } from 'react';
import {
  RtkIcon,
  RtkParticipantTile,
  RtkSettingsVideo,
  defaultIconPack,
} from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';

interface CurrentDevices {
  video?: MediaDeviceInfo;
}

function VideoPreviewPreBuilt() {
  return <RtkSettingsVideo />;
}

function VideoPreviewWithCustomUI() {
  const { meeting } = useRealtimeKitMeeting();

  const [videoDevices, setVideoDevices] = useState<MediaDeviceInfo[]>([]);
  const [currentDevices, setCurrentDevices] = useState<CurrentDevices>({});
  useEffect(() => {
    if (!meeting) {
      return;
    }

    const deviceListUpdateCallback = async () => {
      setVideoDevices(await meeting.self.getVideoDevices());
    };
    meeting.self.addListener('deviceListUpdate', deviceListUpdateCallback);
    //populate first time values
    deviceListUpdateCallback();
    setCurrentDevices({
      video: meeting.self.getCurrentDevices().video,
    });
    return () => {
      meeting.self.removeListener('deviceListUpdate', deviceListUpdateCallback);
    };
  }, [meeting]);
  const setDevice = async (kind: 'video', deviceId: string) => {
    const device = videoDevices.find((d) => d.deviceId === deviceId);
    setCurrentDevices((oldDevices) => {
      return {
        ...oldDevices,
        [kind]: device,
      };
    });
    if (device != null) {
      await meeting?.self.setDevice(device);
    }
  };
  let unnamedCameraCount = 0;
  return (
    <div className="flex flex-col p-4">
      <div>
        {meeting.self.videoEnabled === true ? (
          <RtkParticipantTile participant={meeting?.self} isPreview />
        ) : (
          <div>
            <RtkParticipantTile participant={meeting?.self}>
              <div>
                <RtkIcon icon={defaultIconPack.video_off} />
                <div>Camera Off</div>
              </div>
            </RtkParticipantTile>
          </div>
        )}
      </div>
      <div>
        <label>Camera</label>
        <div>
          <select
            className="mt-2 w-full text-ellipsis bg-[#1F1F1F] p-2"
            onChange={(e) =>
              setDevice('video', (e.target as HTMLSelectElement).value)
            }
          >
            {videoDevices.map(({ deviceId, label }) => (
              <option
                key={deviceId}
                selected={currentDevices?.video?.deviceId === deviceId}
                value={deviceId}
              >
                {label || `Camera ${++unnamedCameraCount}`}
              </option>
            ))}
          </select>
        </div>
      </div>
    </div>
  );
}

// export default VideoPreviewPreBuilt; // uncomment if you want to use prebuilt video preview
export default VideoPreviewWithCustomUI; // uncomment if you want custom ui for video preview



================================================
FILE: samples/default-meeting-ui/README.md
================================================
# Default Meeting UI Sample

This sample showcases the simplest way to integrate RealtimeKit's React UI Kit in your app!

---

![A screenshot of the RtkMeeting component](./screenshot.png)

Just pop in the `<RtkMeeting />` component, and pass the initialised
`meeting` object to it and you're good to go!

[See source](./src/App.tsx)



================================================
FILE: samples/default-meeting-ui/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Default Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/default-meeting-ui/package.json
================================================
{
  "name": "default-meeting-ui",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/default-meeting-ui/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/default-meeting-ui/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/default-meeting-ui/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/default-meeting-ui/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/default-meeting-ui/src/App.tsx
================================================
import { useEffect } from 'react';
import { RtkMeeting } from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitClient } from '@cloudflare/realtimekit-react';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }

    initMeeting({
      authToken,
    });
  }, []);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return <RtkMeeting meeting={meeting!} />;
}

export default App;



================================================
FILE: samples/default-meeting-ui/src/index.css
================================================



================================================
FILE: samples/default-meeting-ui/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/default-meeting-ui/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/facetime/README.md
================================================
# Facetime UI Sample

This sample showcases how you can build a Facetime like UI with RealtimeKit's React UI Kit!

---

![A screenshot of the RtkMeeting component](./screenshot.png)

[See source](./src/App.tsx)



================================================
FILE: samples/facetime/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Facetime UI</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/facetime/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "clsx": "^1.2.1",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-draggable": "^4.4.5",
    "react-feather": "^2.0.10",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.14",
    "postcss": "^8.4.21",
    "tailwindcss": "^3.3.1",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/facetime/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};



================================================
FILE: samples/facetime/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.{ts,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
};



================================================
FILE: samples/facetime/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/facetime/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/facetime/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/facetime/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/facetime/src/App.tsx
================================================
import Facetime from './components/Facetime';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
} from '@cloudflare/realtimekit-react';
import { useEffect } from 'react';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }
    const baseURI = searchParams.get('baseURI') ?? 'realtime.cloudflare.com';

    initMeeting({
      authToken,
      defaults: {
        video: false,
        audio: false,
      },
      baseURI,
    }).then((m) => m?.joinRoom());
  }, []);

  Object.assign(window, { meeting });

  console.log(meeting?.self.waitlistStatus);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider
      value={meeting}
      fallback={
        <div className="bg-black text-white text-lg h-full w-full flex items-center justify-center">
          Joining...
        </div>
      }
    >
      <Facetime />
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/facetime/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    @apply h-full;
  }
}



================================================
FILE: samples/facetime/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/facetime/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/facetime/src/components/Facetime.tsx
================================================
import {
  useRealtimeKitMeeting,
  useRealtimeKitSelector,
} from '@cloudflare/realtimekit-react';
import {
  RtkAudioVisualizer,
  RtkAvatar,
  RtkNameTag,
  RtkParticipantTile,
  RtkParticipantsAudio,
  RtkSimpleGrid,
  provideRtkDesignSystem,
} from '@cloudflare/realtimekit-react-ui';
import clsx from 'clsx';
import { useEffect } from 'react';
import Draggable from 'react-draggable';
import { Mic, Video, X } from 'react-feather';

function Grid() {
  const { meeting } = useRealtimeKitMeeting();
  const participants = useRealtimeKitSelector((m) => m.participants.active);

  return (
    <div className="relative flex place-items-center justify-center flex-1 overflow-hidden -m-4">
      {participants.size === 0 && (
        <p className="text-2xl">People haven't joined yet.</p>
      )}
      {participants.size > 0 && (
        <RtkSimpleGrid
          participants={participants.toArray()}
          meeting={meeting}
          aspectRatio="1:1"
          gap={18}
        />
      )}
    </div>
  );
}

function Controlbar() {
  const { meeting } = useRealtimeKitMeeting();

  const participants = useRealtimeKitSelector((m) => m.participants.joined);

  const { videoEnabled, audioEnabled } = useRealtimeKitSelector((m) => ({
    videoEnabled: m.self.videoEnabled,
    audioEnabled: m.self.audioEnabled,
  }));

  const toggleCamera = () => {
    if (meeting.self.videoEnabled) {
      meeting.self.disableVideo();
    } else {
      meeting.self.enableVideo();
    }
  };

  const toggleMic = () => {
    if (meeting.self.audioEnabled) {
      meeting.self.disableAudio();
    } else {
      meeting.self.enableAudio();
    }
  };

  const leaveMeeting = () => {
    meeting.leaveRoom();
  };

  return (
    <div className="z-20 flex w-full max-w-xs sm:w-min pt-4">
      <div className="w-full p-4 gap-4 bg-neutral-800 shadow-2xl shadow-black rounded-2xl md:rounded-3xl flex flex-col">
        <div className="text-sm">
          <h1>{meeting.meta.meetingTitle}</h1>
          <div className="text-stone-400">
            {participants.size + 1} People Active
          </div>
        </div>
        <div className="flex items-center justify-evenly gap-10">
          <button
            className={clsx(
              'p-3 flex items-center justify-center rounded-full',
              audioEnabled ? 'bg-white text-black' : 'bg-neutral-700 text-white'
            )}
            onClick={toggleMic}
          >
            <Mic />
          </button>
          <button
            className={clsx(
              'p-3 flex items-center justify-center rounded-full',
              videoEnabled ? 'bg-white text-black' : 'bg-neutral-700 text-white'
            )}
            onClick={toggleCamera}
          >
            <Video />
          </button>
          <button
            className="bg-red-500 text-white p-3 flex items-center justify-center rounded-full"
            onClick={leaveMeeting}
          >
            <X />
          </button>
        </div>
      </div>
    </div>
  );
}

export default function Facetime() {
  const { meeting } = useRealtimeKitMeeting();

  const roomJoined = useRealtimeKitSelector((m) => m.self.roomJoined);
  const waitlisted =
    useRealtimeKitSelector((m) => m.self.waitlistStatus) === 'waiting';

  useEffect(() => {
    provideRtkDesignSystem(document.body, {
      colors: {
        'video-bg': '#333333',
      },
    });
  }, []);

  if (waitlisted) {
    return (
      <div className="bg-black text-white w-full h-full flex place-items-center justify-center">
        <p className="text-2xl">You are in the waiting room.</p>
      </div>
    );
  }
  if (!roomJoined) {
    return (
      <div className="bg-black text-white w-full h-full flex place-items-center justify-center">
        <p className="text-2xl">You are not in the meeting.</p>
      </div>
    );
  }

  return (
    <div className="h-full w-full p-4 flex flex-col bg-black text-white overflow-hidden">
      <RtkParticipantsAudio meeting={meeting} />
      <Grid />
      <Draggable bounds="parent">
        <RtkParticipantTile
          participant={meeting.self}
          meeting={meeting}
          key={meeting.self.id}
          className="z-10 absolute bottom-44 right-4 sm:bottom-4 shadow-black shadow-2xl aspect-square w-52 h-auto cursor-move duration-0"
        >
          <RtkAvatar participant={meeting.self} size="md" />
          <RtkNameTag participant={meeting.self} size="md">
            <RtkAudioVisualizer
              participant={meeting.self}
              size="md"
              slot="start"
            />
          </RtkNameTag>
        </RtkParticipantTile>
      </Draggable>
      <Controlbar />
    </div>
  );
}



================================================
FILE: samples/live-auction/README.md
================================================
# Live Auction Sample App

This sample showcases how you can build a Live Auction App with RealtimeKit's React UI Kit!

---
Host's UI:

<img src="./assets/screenshot-host.png" width="280" alt="A screenshot of the live auction sample for the host" />

Participants's UI:

<img src="./assets/screenshot-participant.png" width="280" alt="A screenshot of the live auction sample for the user" />

[See source](./src/App.tsx)



================================================
FILE: samples/live-auction/index.html
================================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Auction App</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/live-auction/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.2.15",
    "@types/react-dom": "^18.2.7",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "@vitejs/plugin-react": "^4.0.3",
    "eslint": "^8.45.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.3",
    "typescript": "^5.0.2",
    "vite": "^4.4.5"
  }
}



================================================
FILE: samples/live-auction/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/live-auction/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/live-auction/vite.config.ts
================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
})



================================================
FILE: samples/live-auction/.eslintrc.cjs
================================================
module.exports = {
  root: true,
  env: { browser: true, es2020: true },
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
  ],
  ignorePatterns: ['dist', '.eslintrc.cjs'],
  parser: '@typescript-eslint/parser',
  plugins: ['react-refresh'],
  rules: {
    'react-refresh/only-export-components': [
      'warn',
      { allowConstantExport: true },
    ],
  },
}



================================================
FILE: samples/live-auction/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?




================================================
FILE: samples/live-auction/src/App.css
================================================
rtk-ended-screen {
    display: flex;
    width: 100vw;
    height: 100vh;
    justify-content: center;
    align-items: center;
}


================================================
FILE: samples/live-auction/src/App.tsx
================================================
/* eslint-disable react-hooks/exhaustive-deps */
import { useEffect, useRef, useState } from 'react';
import { RealtimeKitProvider, useRealtimeKitClient, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import { provideRtkDesignSystem, RtkEndedScreen, RtkLeaveMeeting, RtkUiProvider } from '@cloudflare/realtimekit-react-ui';
import { LoadingScreen } from './pages';
import { Meeting, SetupScreen } from './pages';
import './App.css';

function App() {
  const meetingEl = useRef<HTMLDivElement>(null);
  const [meeting, initMeeting] = useRealtimeKitClient();
  const [roomJoined, setRoomJoined] = useState<boolean>(false);
  const [roomLeft, setRoomLeft] = useState<boolean>(false);

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;
    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
    });
  }, []);

  useEffect(() => {
    if (!meetingEl.current) return;
    provideRtkDesignSystem(meetingEl.current, {
      googleFont: 'Poppins',
      theme: 'light',
      colors: {
        danger: '#ffb31c',
        brand: {
          300: '#c6a6ff',
          400: '#9e77e0',
          500: '#754cba',
          600: '#4e288f',
          700: '#2e0773',
        },
        text: '#071428',
        'text-on-brand': '#ffffff',
        'video-bg': '#E5E7EB',
      },
      borderRadius: 'rounded',
    });
  }, []);

  useEffect(() => {
    if (!meeting) return;

    const roomJoinedListener = () => {
      setRoomJoined(true);
    };
    const roomLeftListener = () => {
      setRoomLeft(true);
    };
    meeting.self.on('roomJoined', roomJoinedListener);
    meeting.self.on('roomLeft', roomLeftListener);

    return () => {
      meeting.self.removeListener('roomJoined', roomJoinedListener);
      meeting.self.removeListener('roomLeft', roomLeftListener);
    }

  }, [meeting])

  return (
    <div ref={meetingEl} >
      <RealtimeKitProvider value={meeting} fallback={<LoadingScreen />}>
        <RtkUiProvider meeting={meeting} showSetupScreen>
          {
            !roomJoined ? <SetupScreen /> : !roomLeft ? <Meeting /> : <RtkEndedScreen />
          }
        </RtkUiProvider>
      </RealtimeKitProvider>
    </div>
  );
}

export default App



================================================
FILE: samples/live-auction/src/constants.ts
================================================

export const bidItems = [
    {
        link:'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2787&q=80',
        startingBid: 100,
        description: 'The radiance lives on in the Air Force 1 \'07. This b-ball icon puts a fresh spin on what you know best: crisp leather, bold colours and just the right amount of cushioning. Exposed foam on the tongue and an aged neutral palette throw it back to an era that can only be described as heritage.',
    },
    {
        link:'https://images.unsplash.com/photo-1560769629-975ec94e6a86?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2864&q=80',
        startingBid: 100,
        description: 'The Tech Hera is here to fulfil all of your chunky sneaker wishes. The wavy, lifted midsole and aged neutral palette level up your look while keeping you comfortable. Its durable design holds up beautifully to everyday wearâ€”which is perfect, because you\'ll definitely want to wear these every day.',
    },
    {
        link:'https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2400&q=80',
        startingBid: 100,
        description: 'Looks Max. Feels Max. The Air Max SYSTM brings back everything you love about your favourite \'80s look (without the parachute trousers). Tried-and-tested Nike Air cushioning is paired with a sleek, sport-inspired upper for comfort that lasts. It\'s Air Max delivering again.',
    },
    {
        link:'https://images.unsplash.com/photo-1543508282-6319a3e2621f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2815&q=80',
        startingBid: 100,
        description: 'Raise the bar with the Nike Court Vision Alta. The modern design combines leather on top with the perfect lift underneath. The elevated hoops look then crowns your feet with its ultra-plush tongue.',
    },
    {
        link:'https://images.unsplash.com/photo-1562183241-b937e95585b6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2865&q=80',
        startingBid: 100,
        description: 'Harness the power of your serve in the NikeCourt Zoom Pro. Working in tandem with the Zoom Air unit, it has a full-length plate that acts like a springboard. Flexing with every step, it helps enhance energy return and increase stability. With a more linear, angular-shaped mesh and finish and a padded collar, this responsive design also helps keep your feet cool and comfortable during your toughest matches.',
    },
]


================================================
FILE: samples/live-auction/src/icons.json
================================================
{
    "auction": "<svg fill='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M7 7V5a3 3 0 0 1 5-2.236A3 3 0 0 1 17 5v2h1.5A1.5 1.5 0 0 1 20 8.5v10.005A3.495 3.495 0 0 1 16.505 22H8a4 4 0 0 1-4-4V8.5A1.5 1.5 0 0 1 5.5 7H7Zm6.635 13.5a3.479 3.479 0 0 1-.625-1.995V8.5H5.5V18A2.5 2.5 0 0 0 8 20.5h5.635ZM11.5 7V5a1.5 1.5 0 0 0-3 0v2h3ZM13 7h2.5V5a1.5 1.5 0 0 0-2.656-.956c.101.3.156.622.156.956v2Zm1.51 11.505a1.995 1.995 0 0 0 3.99 0V8.5h-3.99v10.005Z' fill='currentColor'/></svg>",
    "close": "<svg fill='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='m4.21 4.387.083-.094a1 1 0 0 1 1.32-.083l.094.083L12 10.585l6.293-6.292a1 1 0 1 1 1.414 1.414L13.415 12l6.292 6.293a1 1 0 0 1 .083 1.32l-.083.094a1 1 0 0 1-1.32.083l-.094-.083L12 13.415l-6.293 6.292a1 1 0 0 1-1.414-1.414L10.585 12 4.293 5.707a1 1 0 0 1-.083-1.32l.083-.094-.083.094Z' fill='currentColor'/></svg>",
    "next": "<svg fill='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M8.293 4.293a1 1 0 0 0 0 1.414L14.586 12l-6.293 6.293a1 1 0 1 0 1.414 1.414l7-7a1 1 0 0 0 0-1.414l-7-7a1 1 0 0 0-1.414 0Z' fill='currentColor'/></svg>",
    "prev": "<svg fill='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M15.707 4.293a1 1 0 0 1 0 1.414L9.414 12l6.293 6.293a1 1 0 0 1-1.414 1.414l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 0 1 1.414 0Z' fill='currentColor'/></svg>"
}


================================================
FILE: samples/live-auction/src/index.css
================================================
html, body {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  box-sizing: border-box;
  padding: 0;
  max-height: 100vh;
  margin: 0;
  background: rgb(255, 255, 255);
  color: rgb(31, 31, 31);
  display: flex;
  flex-direction: column;
}



================================================
FILE: samples/live-auction/src/main.tsx
================================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.js'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)



================================================
FILE: samples/live-auction/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/live-auction/src/components/index.ts
================================================
import Icon from "./icon/Icon";
import AuctionControlBar from "./auctionControlBar/AuctionControlBar";

export {
    Icon,
    AuctionControlBar,
}



================================================
FILE: samples/live-auction/src/components/auctionControlBar/auctionControlBar.css
================================================
.bidding-component {
    display: flex;
    box-sizing: border-box;
    flex-direction: row;
    padding:10px;
    background: #E5E7EB;
    width: 100%;
    align-items: center;
    justify-content: space-between;
}
.display-bid {
    margin-right: 5px;
    color: rgb(3, 3, 3);
}
.display-bid span {
    color: rgb(0, 0, 0);
}

.bid-collector {
    margin-left: 5px;
}

.bid-collector input {
    border: solid 1px #97999d;
    background: #c0c3c8;
    border-radius: 6px;
    outline: none;
    padding: 8px;
    color: rgb(12, 12, 12);
}
.bid-collector input::placeholder {
    color: rgb(118, 116, 116);
}
.bid-collector button {
    border: solid  1px #9e77e0;
    outline: none;
    margin-left: 10px;
    border-radius: 6px;
    padding: 7px;
    background-color: #754cba;
    color: white;
    cursor: pointer;
}
.pagination {
    display: flex;
    flex-direction: row;
    background: #c0c3c8;
    border-radius: 16px;
    overflow: hidden;
    border: solid  1px #97999d;
    color: rgb(107, 107, 107);
    align-items: center;
}
.pagination span {
    margin: 0 10px;
}

.pagination button {
    border: none;
    outline: none;
    padding: 7px;
    border-radius: 5px;
    overflow: hidden;
    background: none;
    color: white;
    cursor: pointer;
}


================================================
FILE: samples/live-auction/src/components/auctionControlBar/AuctionControlBar.tsx
================================================
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
import './auctionControlBar.css';
import { useState } from 'react';
import Icon from '../icon/Icon';

interface Bid {
    bid: number;
    user: string;
}

  
interface Props {
    isHost: boolean,
    item: number,
    highestBid: Bid,
    handlePrev: () => void;
    handleNext: () => void;
}

const AuctionControlBar = (props: Props) => {
    const { meeting } = useRealtimeKitMeeting();
    const [bid, setBid] = useState<string>('');
    const { isHost, item, highestBid, handleNext, handlePrev } = props;
    const placeBid = () => {
        const parsedBid = parseFloat(bid).toFixed(2);
        meeting.participants.broadcastMessage('new-bid', {
            bid: parsedBid,
            user: meeting.self.name,
        });
    }

    return (
        <div className="bidding-component">
            <div className="display-bid">
                <span>{highestBid.user === 'default' ? 'Starting' : 'Highest'} Bid: </span>$ {highestBid.bid}
            </div>
            
            {
                isHost && (
                    <div className="pagination">
                        <button onClick={handlePrev}><Icon size='sm' icon='prev' /></button>
                        <span>{item + 1}</span>
                        <button onClick={handleNext}><Icon size='sm' icon='next' /></button>
                    </div>
                )
            }
            {
                !isHost && <div className="bid-collector">
                <input onChange={(e) => {
                    setBid(e.target.value);
                }} placeholder='$ 345' value={bid} />
                <button onClick={placeBid}>Your Bid</button>
            </div>
            }
        </div>
    )
}

export default AuctionControlBar


================================================
FILE: samples/live-auction/src/components/icon/icon.css
================================================
.icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    outline: none;
    color: inherit;
    fill: pink;
}

.icon-wrapper img {
    display: flex;
    align-self: center;
    background: none;
}

.img-sm {
    width: 16px;
    height: 16px;
}

.img-md {
    width: 24px;
    height: 24px;
}

.img-lg {
    width: 32px;
    height: 32px;
}


================================================
FILE: samples/live-auction/src/components/icon/Icon.tsx
================================================
/* eslint-disable react-hooks/exhaustive-deps */
/* eslint-disable @typescript-eslint/no-explicit-any */
import './icon.css';
import iconPack from '../../icons.json'
import { useEffect, useState } from 'react';

interface Props {
    icon: keyof typeof iconPack;
    className?: string;
    size?: 'sm' | 'md' | 'lg';
    onClick?: (...args: any) => void;
}

const Icon = (props: Props) => {
  const { icon, className, onClick, size } = props;
  const [imgSrc, setImgSrc] = useState<string>('');

  useEffect(() => {
    const cont = document.getElementById('icon-cont');
    if (!cont) return;
    const color = window.getComputedStyle(cont).color;
    setImgSrc(`data:image/svg+xml;utf8,${encodeURIComponent(iconPack[icon].replaceAll('currentColor', color))}`)
  }, [icon]);

  return (
    <div id='icon-cont' onClick={onClick} className={`icon-wrapper ${className}`}>
      <img className={`img-${size}`} src={imgSrc} />
    </div>
  )
}

export default Icon

Icon.defaultProps = {
  className: '',
  size: 'md',
  onClick: () => {},
}


================================================
FILE: samples/live-auction/src/pages/index.ts
================================================
import Meeting from './meeting/Meeting';
import LoadingScreen from './loading/Loading';
import SetupScreen from './setupScreen/SetupScreen';

export {
    Meeting,
    SetupScreen,
    LoadingScreen,
}


================================================
FILE: samples/live-auction/src/pages/loading/loading.css
================================================
.loader-container {
    height: 100vh;
    width: 100vw;
    background-color: rgb(255, 255, 255);
    color: rgb(41, 41, 41);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.loader-container h3 {
    margin: 10px;
    padding: 0;
    width: fit-content;
    height: fit-content;
    font-weight: 500;
}
.loader-container p {
    margin: 0;
    padding: 0;
    width: fit-content;
    height: fit-content;
    color: rgb(58, 58, 58);
}


================================================
FILE: samples/live-auction/src/pages/loading/Loading.tsx
================================================
import './loading.css'

const LoadingScreen = () => {
  return (
    <div className='loader-container'>
      <h3>Live Auction</h3>
      <p>Loading your meeting, please wait...</p>
    </div>
  )
}

export default LoadingScreen


================================================
FILE: samples/live-auction/src/pages/meeting/meeting.css
================================================
.meeting-container {
    height: 100vh;
    max-height: 100vh;
    overflow-y: autos;
    width: 100vw;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
}

.meeting-header {
    display: flex;
    flex-direction:row;
    flex-grow: 1;
    margin-right: 40px;
    justify-content: flex-end;
}

.meeting-grid {
    display: flex;
    flex-direction: row;
    flex-grow: 1;
}

.meeting-controlbar {
    display: flex;
    flex-direction: row;
    background: rgb(255, 255, 255);
    align-items: center;
    justify-content: center;
}

.active-controlbar-button {
    fill: red;
}

.auction-container {
    background: #f0f1f2;
    margin:0 10px;
    border-radius: 10px;
    width: 60%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    align-items: center;
    box-sizing: border-box;
    justify-content: flex-start;
    position: relative;
    min-width: 450px;
}
.auction-img {
    flex-grow: 1;
    height: 300px;
}

.auction-toggle-button {
    border: none;
    outline: none;
    display: flex;
    flex-direction: column;
    padding: 8px;
    height: max-content;
    background-color: rgb(255, 255, 255);
    color: rgb(4, 4, 4);
    cursor: pointer;
    margin: 3px;
    border-radius: 6px;
}
.auction-toggle-button:hover {
    background: rgb(228, 224, 224);
}

.auction-desc {
    position: absolute;
    background: rgba(39, 39, 39, 0.735);
    padding: 15px;
    bottom: 51px;
    color: rgb(255, 255, 255);
    font-size: 13px;
    line-height: 19px;
    display: none;
}
.show-auction-popup {
    display: none;
    border: solid  1px rgb(251, 251, 251);
    outline: none;
    padding: 7px 10px;
    border-radius: 6px;
    color: rgb(77, 77, 77);
    justify-self: flex-end;
    cursor: pointer;
}

.auction-container:hover .auction-desc {
    display: block;
}

.hide-auction-popup {
    display: flex;
}

@media screen and (max-width: 800px) {
    .meeting-grid {
        position: relative;
    }
    .auction-container {
       position: absolute;
       z-index: 900;
       max-width: 100%;
       width: 100%;
       height: 100%;
       margin: 0;
    }
    .show-auction-popup {
        display: flex;
    }
    .hide-auction-popup {
        display: none;
    }
}


================================================
FILE: samples/live-auction/src/pages/meeting/Meeting.tsx
================================================
/* eslint-disable react-hooks/exhaustive-deps */
/* eslint-disable @typescript-eslint/no-explicit-any */
import { useEffect, useState } from 'react'
import {
  RtkCameraToggle,
  RtkChatToggle,
  RtkDialogManager,
  RtkGrid,
  RtkHeader,
  RtkLeaveButton,
  RtkMicToggle,
  RtkNotifications,
  RtkParticipantsAudio,
  RtkSidebar,
  sendNotification,
} from '@cloudflare/realtimekit-react-ui'
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
import { AuctionControlBar, Icon } from '../../components';
import { bidItems } from '../../constants';
import './meeting.css'

interface Bid {
  bid: number;
  user: string;
}

const Meeting = () => {
  const { meeting } = useRealtimeKitMeeting();

  const [item, setItem] = useState(0);
  const [isHost, setIsHost] = useState<boolean>(false);
  const [showPopup, setShowPopup] = useState<boolean>(true);
  const [auctionStarted, setAuctionStarted] = useState<boolean>(false);
  const [activeSidebar, setActiveSidebar] = useState<boolean>(false);
  const [highestBid, setHighestBid] = useState<Bid>({ bid: 100, user: 'default' });

  const handlePrev = () => {
    if (item - 1 < 0) return;
    setItem(item - 1)
    meeting.participants.broadcastMessage('item-changed', { item: item - 1 })
  }
  const handleNext = () => {
    if ( item + 1 >= bidItems.length) return;
    setItem(item + 1)
    meeting.participants.broadcastMessage('item-changed', { item: item + 1 })
  }

  useEffect(() => {
    setHighestBid({
      bid: bidItems[item].startingBid,
      user: 'default'
    })
  }, [item])

  useEffect(() => {
    if (!meeting) return;

    const preset = meeting.self.presetName;
    if (preset.includes('host')) {
      setIsHost(true);
    }

    const handleBroadcastedMessage = ({ type, payload }: { type: string, payload: any }) => {
      switch(type) {
        case 'auction-toggle': {
          setAuctionStarted(payload.started);
          break;
        }
        case 'item-changed': {
          setItem(payload.item);
          break;
        }
        case 'new-bid': {
          sendNotification({
            id: 'new-bid',
            message: `${payload.user} just made a bid of $ ${payload.bid}!`,
            duration: 2000,
          })
          if (parseFloat(payload.bid) > highestBid.bid) setHighestBid(payload)
          break;
        }
        default:
          break;
      }
    }
    meeting.participants.on('broadcastedMessage', handleBroadcastedMessage);

    const handleRtkStateUpdate = ({detail}: any) => {
        if (detail.activeSidebar) {
         setActiveSidebar(true);
        } else {
          setActiveSidebar(false);
        }
    }

    document.body.addEventListener('rtkStateUpdate', handleRtkStateUpdate);

    return () => {
      document.body.removeEventListener('rtkStateUpdate', handleRtkStateUpdate);
      meeting.participants.removeListener('broadcastedMessage', handleBroadcastedMessage);
    };
  }, [meeting])

  useEffect(() => {
    const participantJoinedListener = () => {
      if (!auctionStarted) return;
      setTimeout(() => {
        meeting.participants.broadcastMessage('auction-toggle', {
          started: auctionStarted
        })
      }, 500)
    
    }
    meeting.participants.joined.on('participantJoined', participantJoinedListener);
    return () => {
      meeting.participants.joined.removeListener('participantJoined', participantJoinedListener);
    }
  }, [meeting, auctionStarted])

  const toggleAuction = () => {
    if (!isHost) return;
    meeting.participants.broadcastMessage('auction-toggle', {
      started: !auctionStarted
    })
    if (!auctionStarted) {
      meeting.self.pin();
    } else {
      meeting.self.unpin();
    }
    setAuctionStarted(!auctionStarted);
  }

  return (
    <div className='meeting-container'>
      <RtkParticipantsAudio meeting={meeting} />
      <RtkNotifications meeting={meeting} />
      <RtkDialogManager meeting={meeting}/>
      <RtkHeader
        meeting={meeting}
        size='lg'
        style={{
          display: 'flex',
          alignItems: 'center',
          alignSelf: 'center',
          justifyContent: 'space-between',
          gap: 'var(--rtk-space-2, 8px)',
          '--header-section-gap': 'var(--rtk-space-2, 8px)',
        }}
      >
        <div className="meeting-header">
          {
            auctionStarted && (
              <div className="show-auction-popup" onClick={() => setShowPopup(() => !showPopup)}>
                <Icon size='sm' icon={showPopup ? 'close' : 'next'} />
              </div>
            )
          }
        </div>
      </RtkHeader>
      <div className='meeting-grid'>
        {
          auctionStarted && (
            <div className={`auction-container ${!showPopup ? 'hide-auction-popup' : ''}`}>
              <img className='auction-img' src={bidItems[item].link} />
              <div className='auction-desc'>
                {bidItems[item].description}
              </div>
              <AuctionControlBar
                item={item}
                highestBid={highestBid}
                handleNext={handleNext}
                handlePrev={handlePrev}
                isHost={isHost}
              />
          </div>
          )
        }
        <RtkGrid layout='column' meeting={meeting} style={{ height: '100%' }}/>
        {activeSidebar && <RtkSidebar meeting={meeting} />}
      </div>
      <div className='meeting-controlbar'>
        <RtkMicToggle size='md' meeting={meeting} />
        <RtkCameraToggle size='md'  meeting={meeting} />
        <RtkLeaveButton size='md' />
        <RtkChatToggle size='md' meeting={meeting} />
        {
          isHost && (
            <button className='auction-toggle-button' onClick={toggleAuction}>
              <Icon size='lg' icon='auction' />
              {auctionStarted ? 'Stop' : 'Start'} Auction
            </button>
          )
        }
      </div>
    </div>
  );
}

export default Meeting


================================================
FILE: samples/live-auction/src/pages/setupScreen/setupScreen.css
================================================
.setup-screen {
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
}

.setup-media {
    box-sizing: border-box;
    width: 50%;
    display: inline-block;
}
.video-container {
    float: right;
    position: relative;
}
.setup-media-controls {
    position: absolute;
    bottom: 8px;
    right: 8px;
    display: flex;
}

.setup-information {
    display: flex;
    flex-direction: column;
    width: 50%;
    margin: 30px;
    box-sizing: border-box;
}

.setup-content {
    width: 50%;
    text-align: center;
    display: flex;
    flex-direction: column;
    min-width: 300px;
}

.setup-information h2 {
    margin: 10px 0;
    font-weight: 500;
}

.setup-information p {
    margin: 10px 0;
    color: rgb(53, 53, 53);
}

.setup-name {
    margin: 10px 0;
    border: none;
    outline: none;
    padding: 8px;
    border-radius: 4px;
    font-size: medium;
    border: solid 1px #cfcfd0;
    background: #E5E7EB;
    color: rgb(17, 17, 17);
}

.setup-join {
    margin: 10px 0;
    border: none;
    outline: none;
    padding: 8px;
    border-radius: 4px;
    font-size: medium;
    border: solid 1px #9e77e0;
    background: #754cba;
    color: rgb(255, 255, 255);
    cursor: pointer;
}

@media screen and (max-width: 1000px) {
    .setup-screen {
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    .setup-information {
        width: 100%;
        align-items: center;
        justify-content: center;
    }
    .setup-content {
        max-width: 350px;
    }
    .setup-media {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
}


================================================
FILE: samples/live-auction/src/pages/setupScreen/SetupScreen.tsx
================================================
import { useEffect, useState } from 'react'
import './setupScreen.css'
import { useRealtimeKitMeeting } from '@cloudflare/realtimekit-react';
import {
  RtkAudioVisualizer,
  RtkAvatar,
  RtkCameraToggle,
  RtkMicToggle,
  RtkNameTag,
  RtkParticipantTile,
} from '@cloudflare/realtimekit-react-ui';

const SetupScreen = () => {
  const { meeting } = useRealtimeKitMeeting();
  const [isHost, setIsHost] = useState<boolean>(false);
  const [name, setName] = useState<string>('');

  useEffect(() => {
    if (!meeting) return;
    const preset = meeting.self.presetName;
    const name = meeting.self.name;
    setName(name);

    if (preset.includes('host')) {
      setIsHost(true);
    }
  }, [meeting])

  const joinMeeting = () => {
    meeting?.self.setName(name);
    meeting.joinRoom();
  }

  return (
    <div className='setup-screen'>
      <div className="setup-media">
        <div className="video-container">
          <RtkParticipantTile meeting={meeting} participant={meeting.self}>
            <RtkAvatar size="md" participant={meeting.self}/>
            <RtkNameTag meeting={meeting} participant={meeting.self}>
              <RtkAudioVisualizer size='sm' slot="start" participant={meeting.self} />
            </RtkNameTag>
            <div className='setup-media-controls'>
              <RtkMicToggle size="sm" meeting={meeting}/>
              &ensp;
              <RtkCameraToggle size="sm" meeting={meeting}/>
            </div>
          </RtkParticipantTile>
        </div>
      </div>
      <div className="setup-information">
        <div className="setup-content">
          <h2>Welcome! {name}</h2>
          <p>{isHost ? 'You are joining as a Host' : 'You are joining as a bidder'}</p>
          <input disabled={!meeting.self.permissions.canEditDisplayName} className='setup-name' value={name} onChange={(e) => {
            setName(e.target.value)
          }} />
          <button className='setup-join' onClick={joinMeeting}>
            Join Meeting
          </button>
        </div>
      </div>
    </div>
  );
}

export default SetupScreen


================================================
FILE: samples/multi-meeting/README.md
================================================
# Multiple Meeting UI Sample

[See source](./src/App.tsx)



================================================
FILE: samples/multi-meeting/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiple Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/multi-meeting/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^4.4.7"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.30",
    "prettier": "^3.0.3",
    "tailwindcss": "^3.3.3",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/multi-meeting/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/multi-meeting/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/multi-meeting/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/multi-meeting/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/multi-meeting/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/multi-meeting/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/multi-meeting/src/App.tsx
================================================
import React, { useState, useCallback, useRef } from 'react';
import { Meeting } from './Meeting';

function App() {
  const url = new URL(window.location.href);
  const urlAuthToken1 = url.searchParams.get('authToken1');
  const urlAuthToken2 = url.searchParams.get('authToken2');
  const autoInitializeMeeting1 = url.searchParams.get('autoInitializeMeeting1');
  const autoInitializeMeeting2 = url.searchParams.get('autoInitializeMeeting2');
  const showSetupScreen1 = url.searchParams.get('showSetupScreen1') !== 'false';
  const showSetupScreen2 = url.searchParams.get('showSetupScreen2') !== 'false';
  const baseURI = url.searchParams.get('baseURI') || 'dyte.io';

  const [authToken1, setAuthToken1] = useState(urlAuthToken1 || '');
  const [authToken2, setAuthToken2] = useState(urlAuthToken2 || '');
  const [initializeMeeting1, setInitializeMeeting1] = useState(autoInitializeMeeting1 === 'true');
  const [initializeMeeting2, setInitializeMeeting2] = useState(autoInitializeMeeting2 === 'true');
  
  // State for resizable containers
  const [leftWidth, setLeftWidth] = useState(50); // percentage
  const [isDragging, setIsDragging] = useState(false);
  const containerRef = useRef<HTMLDivElement>(null);

  // Handle mouse down on divider
  const handleMouseDown = useCallback((e: React.MouseEvent) => {
    e.preventDefault();
    setIsDragging(true);
  }, []);

  // Handle mouse move for resizing
  const handleMouseMove = useCallback((e: MouseEvent) => {
    if (!isDragging || !containerRef.current) return;
    
    const containerRect = containerRef.current.getBoundingClientRect();
    const containerWidth = containerRect.width;
    const mouseX = e.clientX - containerRect.left;
    
    // Calculate new left width percentage (with bounds)
    const newLeftWidth = Math.max(10, Math.min(90, (mouseX / containerWidth) * 100));
    setLeftWidth(newLeftWidth);
  }, [isDragging]);

  // Handle mouse up to stop dragging
  const handleMouseUp = useCallback(() => {
    setIsDragging(false);
  }, []);

  // Add global mouse event listeners
  React.useEffect(() => {
    if (isDragging) {
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
      document.body.style.cursor = 'col-resize';
      document.body.style.userSelect = 'none';
    } else {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
    }

    return () => {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
    };
  }, [isDragging, handleMouseMove, handleMouseUp]);

  const rightWidth = 100 - leftWidth;

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <div ref={containerRef} className="flex w-full h-full">
      <div 
        id="meeting1" 
        className="border-2 border-black flex-shrink-0"
        style={{ width: `${leftWidth}%` }}
      >
      {!initializeMeeting1 ? (
        <div className="flex">
          <input
            type="text"
            id="auth_token"
            className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-1/2 p-2.5 m-2"
            placeholder="Auth Token"
            required
            value={authToken1}
            onChange={(e) => setAuthToken1(e.target.value)}
          />
          <button
            type="button"
            className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2"
            onClick={() => setInitializeMeeting1(true)}
          >
            Initialize
          </button>
        </div>
      ) : (
        <Meeting baseURI={baseURI} showSetupScreen={showSetupScreen1} authToken={authToken1} meetingIdentifier="meeting1" />
      )}
      </div>
      
      {/* Resizable divider */}
      <div 
        className={`w-1 bg-gray-400 hover:bg-gray-600 cursor-col-resize flex-shrink-0 relative group ${
          isDragging ? 'bg-gray-600' : ''
        }`}
        onMouseDown={handleMouseDown}
      >
        {/* Visual indicator */}
        <div className="absolute inset-y-0 -left-1 -right-1 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <div className="w-1 h-8 bg-gray-600 rounded-full"></div>
        </div>
      </div>
      
      <div 
        id="meeting2" 
        className="border-2 border-black flex-shrink-0"
        style={{ width: `${rightWidth}%` }}
      >
      {!initializeMeeting2 ? (
        <div className="flex">
          <input
            type="text"
            id="auth_token"
            className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-1/2 p-2.5 m-2"
            placeholder="Auth Token"
            required
            value={authToken2}
            onChange={(e) => setAuthToken2(e.target.value)}
          />
          <button
            type="button" className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2"
            onClick={() => setInitializeMeeting2(true)}
          >
            Initialize
          </button>
        </div>
      ) : (
        <Meeting baseURI={baseURI} showSetupScreen={showSetupScreen2} authToken={authToken2} meetingIdentifier='meeting2' />
      )}
      </div>
    </div>
  );
}

export default App;



================================================
FILE: samples/multi-meeting/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html, body, #root {
    height: 100%;
  }
}



================================================
FILE: samples/multi-meeting/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/multi-meeting/src/Meeting.tsx
================================================
import { useEffect, useState, useMemo } from 'react';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
} from '@cloudflare/realtimekit-react';
import {
  RtkMeeting,
  UIConfig,
  createDefaultConfig,
  provideRtkDesignSystem,
  registerAddons,
} from '@cloudflare/realtimekit-react-ui';

import VideoBackground from '@cloudflare/realtimekit-ui-addons/video-background';
import HandRaise from '@cloudflare/realtimekit-ui-addons/hand-raise';
import ChatHostControl from '@cloudflare/realtimekit-ui-addons/chat-host-control';
import MicHostControl from '@cloudflare/realtimekit-ui-addons/mic-host-control';
import CameraHostControl from '@cloudflare/realtimekit-ui-addons/camera-host-control';

import { getStatesStore, cleanupStores } from './store';

export function Meeting(
    { authToken, showSetupScreen, baseURI, meetingIdentifier }: { authToken: string, showSetupScreen?: boolean, baseURI?: string, meetingIdentifier: string }
) {
  const [meeting, initMeeting] = useRealtimeKitClient();
  const [customConfig, setCustomConfig] = useState<UIConfig | null>(createDefaultConfig());
  
  // Create peer specific store for this meeting peer instance
  const statesStore = useMemo(() => {
    return getStatesStore(meetingIdentifier);
  }, [meetingIdentifier]);
  
  const setStates = statesStore((s) => s.setStates);
  const states = statesStore((s) => s.states);

  // Cleanup store when component unmounts
  useEffect(() => {
    return () => {
      cleanupStores(meetingIdentifier);
    };
  }, [meetingIdentifier]);

  useEffect(() => {
    async function setupUiKitAddons(){
      if (!meeting) return;
      // Register UI kit addons
      const videoBackground = await VideoBackground.init({
        modes: ["blur", "virtual", "random"],
        blurStrength: 30, // 0 - 100 for opacity
        meeting: meeting!,
        images: [
            "https://images.unsplash.com/photo-1487088678257-3a541e6e3922?q=80&w=2874&auto=format&fit=crop&ixlib=rb-4.0.3",
            "https://images.unsplash.com/photo-1496715976403-7e36dc43f17b?q=80&w=2848&auto=format&fit=crop&ixlib=rb-4.0.3",
            "https://images.unsplash.com/photo-1600431521340-491eca880813?q=80&w=2938&auto=format&fit=crop&ixlib=rb-4.0.3"
        ],
        randomCount: 10,
        selector: `#${meetingIdentifier}`
      });

      const handRaise = await HandRaise.init({
        meeting,
        canRaiseHand: true,
        canManageRaisedHand: true,
        handRaiseIcon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M10 4.25C10 3.69772 9.55228 3.25 9 3.25C8.44772 3.25 8 3.69772 8 4.25V10.9982C8 11.2743 7.77614 11.4982 7.5 11.4982C7.22386 11.4982 7 11.2743 7 10.9982V5.99683C7 5.44454 6.55228 4.99683 6 4.99683C5.44772 4.99683 5 5.44454 5 5.99683V14.7536C5 16.933 6.16842 19.263 6.91404 20.5425C7.47017 21.4969 8.49409 22.0013 9.53657 22.0013H11.7046C12.9358 22.0013 14.0613 21.3056 14.6118 20.2043L14.7451 19.9374C15.1658 19.0957 15.6904 18.31 16.3067 17.5989L18.5186 15.0468L20.7105 13.342C20.8931 13.1999 21 12.9814 21 12.75C21 12.2651 20.7409 11.9051 20.4084 11.6903C20.1123 11.499 19.7584 11.4172 19.4464 11.3802C18.8102 11.3047 18.0364 11.3818 17.3571 11.5137C16.8436 11.6134 16.3829 11.8077 16 12.0182V4.25C16 3.69772 15.5523 3.25 15 3.25C14.4477 3.25 14 3.69772 14 4.25V10.5C14 10.7761 13.7761 11 13.5 11C13.2239 11 13 10.7761 13 10.5V2.99683C13 2.44454 12.5523 1.99683 12 1.99683C11.4477 1.99683 11 2.44454 11 2.99683V10.5C11 10.7761 10.7761 11 10.5 11C10.2239 11 10 10.7761 10 10.5V4.25Z" fill="#F4C534"/></svg>'
    });
    
    const chatHostControl = await ChatHostControl.init({
        meeting,
        hostPresets: ['group_call_host', 'webinar_presenter'],
        targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
        addActionInParticipantMenu: true,
    });
    
    const micHostControl = await MicHostControl.init({
        meeting,
        hostPresets: ['group_call_host', 'webinar_presenter'],
        targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
        addActionInParticipantMenu: true,
    });
    
    const cameraHostControl = await CameraHostControl.init({
        meeting,
        hostPresets: ['group_call_host', 'webinar_presenter'],
        targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
        addActionInParticipantMenu: true,
    });

    const newConfig = registerAddons([videoBackground, handRaise, chatHostControl, micHostControl, cameraHostControl], meeting!);
    setCustomConfig(newConfig);
  } 
  setupUiKitAddons();
}, [meeting]);

  useEffect(() => {
    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting.",
      );
      return;
    }

    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
      baseURI,
    })
    /*.then((m) => m?.joinRoom())*/;
  }, [initMeeting, authToken]);

  return (
    <div className="flex flex-col w-full h-full">
        <RealtimeKitProvider value={meeting}>
            <RtkMeeting 
              className="relative" 
              showSetupScreen={showSetupScreen} 
              meeting={meeting} 
              config={customConfig!}
              ref={(el) => {
                if (!el) return;
                
                const handleStateUpdate = (e: CustomEvent) => {
                  // Only update states if this event is for our meeting
                  if (!meeting?.self?.id || e.detail?.peerId !== meeting?.self?.id) return;
                  setStates(e.detail);
                };
                
                // Add new listener
                el.addEventListener('rtkStatesUpdate', handleStateUpdate);
                
                // Cleanup listener on unmount
                return () => {
                  el.removeEventListener('rtkStatesUpdate', handleStateUpdate);
                };
              }}
            />
        </RealtimeKitProvider>
    </div>
  );
}



================================================
FILE: samples/multi-meeting/src/store.ts
================================================
import { getInitialStates, States } from '@cloudflare/realtimekit-ui';
import { create } from 'zustand';
import { CustomStates } from './types';

type StatesStore = {
  states: States;
  setStates: (states: States) => void;
};

type CustomStatesStore = {
  states: CustomStates;
  setCustomStates: (states: CustomStates) => void;
};

// Factory function to create isolated state stores per meeting
export const createStatesStore = () => create<StatesStore>((set) => ({
  states: getInitialStates(),
  setStates: (states) => set({ states }),
}));

// Factory function to create isolated custom state stores per meeting
export const createCustomStatesStore = () => create<CustomStatesStore>((set) => ({
  states: {},
  setCustomStates: (states) => set({ states }),
}));

// Store registry to manage multiple store instances
const storeRegistry = new Map<string, ReturnType<typeof createStatesStore>>();
const customStoreRegistry = new Map<string, ReturnType<typeof createCustomStatesStore>>();

// Get or create a store instance for a specific meeting
export const getStatesStore = (meetingId: string) => {

  if (!storeRegistry.has(meetingId)) {

    const newStore = createStatesStore();
    storeRegistry.set(meetingId, newStore);

  } else {

  }
  return storeRegistry.get(meetingId)!;
};

// Get or create a custom store instance for a specific meeting
export const getCustomStatesStore = (meetingId: string) => {

  if (!customStoreRegistry.has(meetingId)) {

    const newStore = createCustomStatesStore();
    customStoreRegistry.set(meetingId, newStore);

  } else {

  }
  return customStoreRegistry.get(meetingId)!;
};

// Cleanup function to remove stores when meetings are destroyed
export const cleanupStores = (meetingId: string) => {

  const hadStore = storeRegistry.delete(meetingId);
  const hadCustomStore = customStoreRegistry.delete(meetingId);


};



================================================
FILE: samples/multi-meeting/src/types.ts
================================================
// Custom states type for additional meeting-specific state management
export type CustomStates = {
  [key: string]: any;
};



================================================
FILE: samples/multi-meeting/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/multi-meeting-custom/README.md
================================================
# Multiple Meeting UI Sample

[See source](./src/App.tsx)



================================================
FILE: samples/multi-meeting-custom/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiple Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/multi-meeting-custom/package.json
================================================
{
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "resize-observer-polyfill": "^1.5.1",
    "zustand": "^4.4.7"
  },
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.30",
    "prettier": "^3.0.3",
    "tailwindcss": "^3.3.3",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/multi-meeting-custom/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/multi-meeting-custom/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/multi-meeting-custom/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/multi-meeting-custom/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/multi-meeting-custom/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/multi-meeting-custom/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/multi-meeting-custom/src/App.tsx
================================================
import React, { useState, useCallback, useRef } from 'react';
import { Meeting } from './Meeting';

function App() {
  const url = new URL(window.location.href);
  const urlAuthToken1 = url.searchParams.get('authToken1');
  const urlAuthToken2 = url.searchParams.get('authToken2');
  const autoInitializeMeeting1 = url.searchParams.get('autoInitializeMeeting1');
  const autoInitializeMeeting2 = url.searchParams.get('autoInitializeMeeting2');
  const showSetupScreen1 = url.searchParams.get('showSetupScreen1') !== 'false';
  const showSetupScreen2 = url.searchParams.get('showSetupScreen2') !== 'false';
  const baseURI = url.searchParams.get('baseURI') || 'dyte.io';

  const [authToken1, setAuthToken1] = useState(urlAuthToken1 || '');
  const [authToken2, setAuthToken2] = useState(urlAuthToken2 || '');
  const [initializeMeeting1, setInitializeMeeting1] = useState(autoInitializeMeeting1 === 'true');
  const [initializeMeeting2, setInitializeMeeting2] = useState(autoInitializeMeeting2 === 'true');
  
  // State for resizable containers
  const [leftWidth, setLeftWidth] = useState(50); // percentage
  const [isDragging, setIsDragging] = useState(false);
  const containerRef = useRef<HTMLDivElement>(null);

  // Handle mouse down on divider
  const handleMouseDown = useCallback((e: React.MouseEvent) => {
    e.preventDefault();
    setIsDragging(true);
  }, []);

  // Handle mouse move for resizing
  const handleMouseMove = useCallback((e: MouseEvent) => {
    if (!isDragging || !containerRef.current) return;
    
    const containerRect = containerRef.current.getBoundingClientRect();
    const containerWidth = containerRect.width;
    const mouseX = e.clientX - containerRect.left;
    
    // Calculate new left width percentage (with bounds)
    const newLeftWidth = Math.max(10, Math.min(90, (mouseX / containerWidth) * 100));
    setLeftWidth(newLeftWidth);
  }, [isDragging]);

  // Handle mouse up to stop dragging
  const handleMouseUp = useCallback(() => {
    setIsDragging(false);
  }, []);

  // Add global mouse event listeners
  React.useEffect(() => {
    if (isDragging) {
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
      document.body.style.cursor = 'col-resize';
      document.body.style.userSelect = 'none';
    } else {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
    }

    return () => {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
      document.body.style.cursor = '';
      document.body.style.userSelect = '';
    };
  }, [isDragging, handleMouseMove, handleMouseUp]);

  const rightWidth = 100 - leftWidth;

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <div ref={containerRef} className="flex w-full h-full">
      <div 
        id="meeting1" 
        className="border-2 border-black flex-shrink-0"
        style={{ width: `${leftWidth}%` }}
      >
      {!initializeMeeting1 ? (
        <div className="flex">
          <input
            type="text"
            id="auth_token"
            className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-1/2 p-2.5 m-2"
            placeholder="Auth Token"
            required
            value={authToken1}
            onChange={(e) => setAuthToken1(e.target.value)}
          />
          <button
            type="button"
            className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2"
            onClick={() => setInitializeMeeting1(true)}
          >
            Initialize
          </button>
        </div>
      ) : (
        <Meeting baseURI={baseURI} authToken={authToken1} meetingIdentifier="meeting1" />
      )}
      </div>
      
      {/* Resizable divider */}
      <div 
        className={`w-1 bg-gray-400 hover:bg-gray-600 cursor-col-resize flex-shrink-0 relative group ${
          isDragging ? 'bg-gray-600' : ''
        }`}
        onMouseDown={handleMouseDown}
      >
        {/* Visual indicator */}
        <div className="absolute inset-y-0 -left-1 -right-1 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <div className="w-1 h-8 bg-gray-600 rounded-full"></div>
        </div>
      </div>
      
      <div 
        id="meeting2" 
        className="border-2 border-black flex-shrink-0"
        style={{ width: `${rightWidth}%` }}
      >
      {!initializeMeeting2 ? (
        <div className="flex">
          <input
            type="text"
            id="auth_token"
            className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-1/2 p-2.5 m-2"
            placeholder="Auth Token"
            required
            value={authToken2}
            onChange={(e) => setAuthToken2(e.target.value)}
          />
          <button
            type="button" className="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800 m-2"
            onClick={() => setInitializeMeeting2(true)}
          >
            Initialize
          </button>
        </div>
      ) : (
        <Meeting baseURI={baseURI} authToken={authToken2} meetingIdentifier='meeting2' />
      )}
      </div>
    </div>
  );
}

export default App;



================================================
FILE: samples/multi-meeting-custom/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html, body, #root {
    height: 100%;
    overflow: hidden;
  }
}

@layer components {
  /* Ensure RTK components are properly contained */
  rtk-ui-provider {
    display: block;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  /* Fix sidebar positioning and visibility */
  rtk-sidebar {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    z-index: 20;
    pointer-events: auto;
  }
  
  /* Ensure stage container doesn't overflow and allows sidebar positioning */
  rtk-stage {
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 100%;
  }
  
  /* Fix grid container */
  rtk-grid {
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 100%;
  }
  
  /* Ensure header and controlbar take full width */
  rtk-header,
  rtk-controlbar {
    width: 100%;
    display: block;
  }
}



================================================
FILE: samples/multi-meeting-custom/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/multi-meeting-custom/src/Meeting.tsx
================================================
import { useEffect, useMemo, useState } from 'react';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
} from '@cloudflare/realtimekit-react';
import {
  RtkDialogManager,
  RtkUiProvider,
  UIConfig,
  createDefaultConfig,
  provideRtkDesignSystem,
  registerAddons,
} from '@cloudflare/realtimekit-react-ui';
import CustomRtkMeeting from './components/custom-rtk-meeting';
import VideoBackground from '@cloudflare/realtimekit-ui-addons/video-background';
import HandRaise from '@cloudflare/realtimekit-ui-addons/hand-raise';
import ChatHostControl from '@cloudflare/realtimekit-ui-addons/chat-host-control';
import MicHostControl from '@cloudflare/realtimekit-ui-addons/mic-host-control';
import CameraHostControl from '@cloudflare/realtimekit-ui-addons/camera-host-control';
import { getStatesStore, cleanupStores } from './store';
import { useContainerSize } from './hooks/useContainerSize';

export function Meeting(
    { authToken, baseURI, meetingIdentifier }: { authToken: string, baseURI?: string, meetingIdentifier: string }
) {

  const [meeting, initMeeting] = useRealtimeKitClient();
  
  // Create peer specific store for this meeting peer instance
  const statesStore = useMemo(() => {
    return getStatesStore(meetingIdentifier);
  }, [meetingIdentifier]);
  
  const setStates = statesStore((s: any) => s.setStates);
  const states = statesStore((s: any) => s.states);
  const [customConfig, setCustomConfig] = useState<UIConfig | null>(createDefaultConfig());
  const size = useContainerSize(meetingIdentifier);
    
  // Cleanup store when component unmounts
    useEffect(() => {
      return () => {
        cleanupStores(meetingIdentifier);
      };
    }, [meetingIdentifier]);
  
    useEffect(() => {
      async function setupUiKitAddons(){
        if (!meeting) return;
        // Register UI kit addons
        const videoBackground = await VideoBackground.init({
          modes: ["blur", "virtual", "random"],
          blurStrength: 30, // 0 - 100 for opacity
          meeting: meeting!,
          images: [
              "https://images.unsplash.com/photo-1487088678257-3a541e6e3922?q=80&w=2874&auto=format&fit=crop&ixlib=rb-4.0.3",
              "https://images.unsplash.com/photo-1496715976403-7e36dc43f17b?q=80&w=2848&auto=format&fit=crop&ixlib=rb-4.0.3",
              "https://images.unsplash.com/photo-1600431521340-491eca880813?q=80&w=2938&auto=format&fit=crop&ixlib=rb-4.0.3"
          ],
          randomCount: 10,
          selector: `#${meetingIdentifier}`
        });

        const handRaise = await HandRaise.init({
          meeting,
          canRaiseHand: true,
          canManageRaisedHand: true,
          handRaiseIcon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M10 4.25C10 3.69772 9.55228 3.25 9 3.25C8.44772 3.25 8 3.69772 8 4.25V10.9982C8 11.2743 7.77614 11.4982 7.5 11.4982C7.22386 11.4982 7 11.2743 7 10.9982V5.99683C7 5.44454 6.55228 4.99683 6 4.99683C5.44772 4.99683 5 5.44454 5 5.99683V14.7536C5 16.933 6.16842 19.263 6.91404 20.5425C7.47017 21.4969 8.49409 22.0013 9.53657 22.0013H11.7046C12.9358 22.0013 14.0613 21.3056 14.6118 20.2043L14.7451 19.9374C15.1658 19.0957 15.6904 18.31 16.3067 17.5989L18.5186 15.0468L20.7105 13.342C20.8931 13.1999 21 12.9814 21 12.75C21 12.2651 20.7409 11.9051 20.4084 11.6903C20.1123 11.499 19.7584 11.4172 19.4464 11.3802C18.8102 11.3047 18.0364 11.3818 17.3571 11.5137C16.8436 11.6134 16.3829 11.8077 16 12.0182V4.25C16 3.69772 15.5523 3.25 15 3.25C14.4477 3.25 14 3.69772 14 4.25V10.5C14 10.7761 13.7761 11 13.5 11C13.2239 11 13 10.7761 13 10.5V2.99683C13 2.44454 12.5523 1.99683 12 1.99683C11.4477 1.99683 11 2.44454 11 2.99683V10.5C11 10.7761 10.7761 11 10.5 11C10.2239 11 10 10.7761 10 10.5V4.25Z" fill="#F4C534"/></svg>'
      });
      
      const chatHostControl = await ChatHostControl.init({
          meeting,
          hostPresets: ['group_call_host', 'webinar_presenter'],
          targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
          addActionInParticipantMenu: true,
      });
      
      const micHostControl = await MicHostControl.init({
          meeting,
          hostPresets: ['group_call_host', 'webinar_presenter'],
          targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
          addActionInParticipantMenu: true,
      });
      
      const cameraHostControl = await CameraHostControl.init({
          meeting,
          hostPresets: ['group_call_host', 'webinar_presenter'],
          targetPresets: ['group_call_host', 'group_call_participant', 'webinar_presenter', 'webinar_viewer'],
          addActionInParticipantMenu: true,
      });
  
        const newConfig = registerAddons([videoBackground, handRaise, chatHostControl, micHostControl, cameraHostControl], meeting!);

        // This code ensure full screen toggle works fine. This will be ported to @cloudflare/realtimekit-ui-addons soon.
        if (newConfig.root && Array.isArray(newConfig.root['div#controlbar-left'])) {
          const fullScreenToggleIndex = newConfig.root['div#controlbar-left'].indexOf('rtk-fullscreen-toggle');
          if(fullScreenToggleIndex > -1){
              newConfig.root['div#controlbar-left'][fullScreenToggleIndex] = ['rtk-fullscreen-toggle', {
                  variant: 'vertical',
                  targetElement: document.getElementById(meetingIdentifier)!
              }];
          }
      }
      // Handle smaller screens
      ['rtk-more-toggle.activeMoreMenu', 'rtk-more-toggle.activeMoreMenu.md', 'rtk-more-toggle.activeMoreMenu.sm'].forEach((configElemKey) => {
          const configElem = newConfig?.root?.[configElemKey] as any;
          configElem?.forEach((dyteElemConfigSet: any) => {
              if (dyteElemConfigSet[0] === 'rtk-fullscreen-toggle') {
                  dyteElemConfigSet[1].targetElement = document.getElementById(meetingIdentifier)!;
              }
          });
      });

        setCustomConfig(newConfig);
      } 
      setupUiKitAddons();
    }, [meeting]);

  useEffect(() => {

    if (!initMeeting || !authToken) {
      console.log(`[${meetingIdentifier}] Missing initMeeting or authToken`);
      return;
    }

    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
      ...(baseURI && { baseURI }),
      modules: {
        devTools: {
          logs: false,
        }
      }
    })
    .then((m) => {
      console.log(`[${meetingIdentifier}] Meeting initialized`);
    })
    .catch((error) => {
      console.error(`[${meetingIdentifier}] Error initializing meeting:`, error);
    });
  }, [initMeeting, authToken, baseURI, meetingIdentifier]);



  return (
    <div className="flex flex-col w-full h-full overflow-hidden" data-meeting-id={meetingIdentifier}>
        <RealtimeKitProvider value={meeting}>
            <RtkUiProvider
                meeting={meeting}
                config={customConfig!}
                showSetupScreen
                style={{ height: '100%', width: '100%', display: 'block', overflow: 'hidden' }}
                ref={(el) => {
                  if (!el) return;
                  
                  const handleStateUpdate = (e: CustomEvent) => {
                    // Only update states if this event is for our meeting
                    if (!meeting?.self?.id || e.detail?.peerId !== meeting?.self?.id) return;
                    setStates(e.detail);
                  };
                  
                  // Add new listener
                  el.addEventListener('rtkStatesUpdate', handleStateUpdate);
                  
                  // Cleanup listener on unmount
                  return () => {
                    el.removeEventListener('rtkStatesUpdate', handleStateUpdate);
                  };
                }} >
                      <CustomRtkMeeting meetingIdentifier={meetingIdentifier} states={states} />
                      <RtkDialogManager size={size}/>
            </RtkUiProvider>
        </RealtimeKitProvider>
    </div>
  );
}



================================================
FILE: samples/multi-meeting-custom/src/store.ts
================================================
import { getInitialStates, States } from '@cloudflare/realtimekit-ui';
import { create } from 'zustand';
import { CustomStates } from './types';

type StatesStore = {
  states: States;
  setStates: (states: States) => void;
};

type CustomStatesStore = {
  states: CustomStates;
  setCustomStates: (states: CustomStates) => void;
};

// Factory function to create isolated state stores per meeting
export const createStatesStore = () => create<StatesStore>((set) => ({
  states: getInitialStates(),
  setStates: (states) => set({ states }),
}));

// Factory function to create isolated custom state stores per meeting
export const createCustomStatesStore = () => create<CustomStatesStore>((set) => ({
  states: {},
  setCustomStates: (states) => set({ states }),
}));

// Store registry to manage multiple store instances
const storeRegistry = new Map<string, ReturnType<typeof createStatesStore>>();
const customStoreRegistry = new Map<string, ReturnType<typeof createCustomStatesStore>>();

// Get or create a store instance for a specific meeting
export const getStatesStore = (meetingId: string) => {

  if (!storeRegistry.has(meetingId)) {

    const newStore = createStatesStore();
    storeRegistry.set(meetingId, newStore);

  } else {

  }
  return storeRegistry.get(meetingId)!;
};

// Get or create a custom store instance for a specific meeting
export const getCustomStatesStore = (meetingId: string) => {

  if (!customStoreRegistry.has(meetingId)) {

    const newStore = createCustomStatesStore();
    customStoreRegistry.set(meetingId, newStore);

  } else {

  }
  return customStoreRegistry.get(meetingId)!;
};

// Cleanup function to remove stores when meetings are destroyed
export const cleanupStores = (meetingId: string) => {

  const hadStore = storeRegistry.delete(meetingId);
  const hadCustomStore = customStoreRegistry.delete(meetingId);


};



================================================
FILE: samples/multi-meeting-custom/src/types.ts
================================================
// Custom states type for additional meeting-specific state management
export type CustomStates = {
  [key: string]: any;
};



================================================
FILE: samples/multi-meeting-custom/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/multi-meeting-custom/src/components/custom-rtk-meeting.tsx
================================================
import InMeeting from './in-meeting';
import {
  RtkEndedScreen,
  RtkIdleScreen,
  RtkSetupScreen,
  RtkWaitingScreen,
} from '@cloudflare/realtimekit-react-ui';
import { States } from '@cloudflare/realtimekit-ui';
import { useContainerSize } from '../hooks/useContainerSize';

export interface CustomRtkMeetingProps {
  states: States;
  meetingIdentifier: string;
}

function CustomRtkMeeting({ states, meetingIdentifier }: CustomRtkMeetingProps) {
  const size = useContainerSize(meetingIdentifier);
  
  switch (states.meeting) {
    case 'idle':

      return <RtkIdleScreen />;
    case 'setup':

      return <RtkSetupScreen size={size} />;
    case 'waiting':

      return <RtkWaitingScreen />;
    case 'ended':

      return <RtkEndedScreen />;
    case 'joined':
    default:

      return <InMeeting states={states} meetingIdentifier={meetingIdentifier} />;
  }
}

export default CustomRtkMeeting;



================================================
FILE: samples/multi-meeting-custom/src/components/in-meeting.tsx
================================================
import {
  RtkStage,
  RtkGrid,
  RtkNotifications,
  RtkParticipantsAudio,
  RtkSidebar,
  RtkControlbar,
  RtkHeader,
} from '@cloudflare/realtimekit-react-ui';
import type { CustomRtkMeetingProps } from './custom-rtk-meeting';
import { useContainerSize } from '../hooks/useContainerSize';

function InMeeting({ states, meetingIdentifier }: CustomRtkMeetingProps) {
  const size = useContainerSize(meetingIdentifier);
  return (
    <div className="flex flex-col w-full h-full overflow-hidden">
      <header className="flex-shrink-0 w-full">
        <RtkHeader size={size} style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
          gap: 'var(--rtk-space-2, 8px)',
          '--header-section-gap': 'var(--rtk-space-2, 8px)',
        }}/>
      </header>
      <main className="flex-1 w-full overflow-hidden relative">
        <RtkStage className="w-full h-full p-2 overflow-hidden relative">
          <RtkGrid size={size} />
          <RtkNotifications size={size} />
          { states.activeSidebar && <RtkSidebar size={size}/>}
        </RtkStage>
        <RtkParticipantsAudio />
      </main>
      <footer className="flex-shrink-0 w-full">
        <RtkControlbar size={size} style={{display: 'flex', justifyContent: 'space-between'}} />
      </footer>
    </div>
  );
}

export default InMeeting;



================================================
FILE: samples/multi-meeting-custom/src/hooks/useContainerSize.ts
================================================
import { useState, useEffect } from 'react';
import ResizeObserver from 'resize-observer-polyfill';

// Breakpoints configuration
const breakpoints = {
  sm: 640,
  md: 768,
  lg: 1080,
  xl: 2160
} as const;

export type BreakpointSize = keyof typeof breakpoints;

// Function to determine size based on width
const getSizeFromWidth = (width: number): BreakpointSize => {
  if (width >= breakpoints.xl) return 'xl';
  if (width >= breakpoints.lg) return 'lg';
  if (width >= breakpoints.md) return 'md';
  return 'sm';
};

// Global state to store size for each meeting
const meetingSizes = new Map<string, BreakpointSize>();
const meetingListeners = new Map<string, Set<(size: BreakpointSize) => void>>();

/**
 * Custom hook to track container size based on breakpoints
 * @param meetingIdentifier - Unique identifier for the meeting container
 * @returns Current breakpoint size ('sm' | 'md' | 'lg' | 'xl')
 */
export const useContainerSize = (meetingIdentifier: string): BreakpointSize => {
  const [size, setSize] = useState<BreakpointSize>(
    meetingSizes.get(meetingIdentifier) || 'md'
  );

  useEffect(() => {
    // Add this component's setter to the listeners for this meeting
    if (!meetingListeners.has(meetingIdentifier)) {
      meetingListeners.set(meetingIdentifier, new Set());
    }
    meetingListeners.get(meetingIdentifier)!.add(setSize);

    // If size is already tracked, use it
    const existingSize = meetingSizes.get(meetingIdentifier);
    if (existingSize) {
      setSize(existingSize);
      return;
    }

    // Set up ResizeObserver for this meeting if not already done
    const containerElement = document.querySelector(`[data-meeting-id="${meetingIdentifier}"]`) as HTMLElement;
    if (!containerElement) {
      // If container doesn't exist yet, we'll wait for it
      const checkForContainer = () => {
        const element = document.querySelector(`[data-meeting-id="${meetingIdentifier}"]`) as HTMLElement;
        if (element) {
          setupResizeObserver(element, meetingIdentifier);
        } else {
          // Check again after a short delay
          setTimeout(checkForContainer, 100);
        }
      };
      checkForContainer();
      return;
    }

    setupResizeObserver(containerElement, meetingIdentifier);

    // Cleanup listener when component unmounts
    return () => {
      const listeners = meetingListeners.get(meetingIdentifier);
      if (listeners) {
        listeners.delete(setSize);
        // If no more listeners, clean up the meeting tracking
        if (listeners.size === 0) {
          meetingListeners.delete(meetingIdentifier);
          meetingSizes.delete(meetingIdentifier);
        }
      }
    };
  }, [meetingIdentifier]);

  return size;
};

// Helper function to set up ResizeObserver
const setupResizeObserver = (containerElement: HTMLElement, meetingIdentifier: string) => {
  const resizeObserver = new ResizeObserver((entries) => {
    for (const entry of entries) {
      const { width } = entry.contentRect;
      const newSize = getSizeFromWidth(width);
      
      // Update global state
      meetingSizes.set(meetingIdentifier, newSize);
      
      // Notify all listeners for this meeting
      const listeners = meetingListeners.get(meetingIdentifier);
      if (listeners) {
        listeners.forEach(listener => listener(newSize));
      }
    }
  });

  resizeObserver.observe(containerElement);

  // Initial size calculation
  const initialWidth = containerElement.offsetWidth;
  const initialSize = getSizeFromWidth(initialWidth);
  meetingSizes.set(meetingIdentifier, initialSize);
  
  // Notify all listeners for this meeting
  const listeners = meetingListeners.get(meetingIdentifier);
  if (listeners) {
    listeners.forEach(listener => listener(initialSize));
  }

  // Store observer for cleanup (if needed)
  containerElement.setAttribute('data-resize-observer-setup', 'true');
};

export { breakpoints };



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/README.md
================================================
# Screenshare focused UI with custom addons such as Hand raise, Reactions & video middleware

Unlike traditional samples where devs are given a fixed UI, this sample let's you pick your own variant from a variety of variants for a component.

For example, There are a few variants of [Setup Screen component file](./src/components/setup-screen.tsx).

```tsx
export default SetupScreenPreBuilt;

export default CustomSetupScreenWithPrebuiltMediaPreviewModal;

export default CustomSetupScreenWithCustomMediaPreviewModal;
```

All you have to do, to pick a variant of your choice, is to comment out the undesired variants and only uncomment the one you want. Once you have made up your mind, you can copy paste the code to your application.

## How to run?

1. Run `npm install` in the current [folder](./)
2. Run `npm run dev` to start a server. See the port in the logs of this command. Default is 5173.
3. Open browser with the URL `http://localhost:5173/?authToken=PUT_PARTICIPANT_AUTH_TOKEN_HERE`. Change the port if needed.

To learn more, refer to [the source code](./src/App.tsx)



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4",
    "@cloudflare/realtimekit-virtual-background": "0.0.2",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^3.5.6"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.30",
    "prettier": "^3.0.3",
    "tailwindcss": "^3.3.3",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/App.tsx
================================================
import { useEffect, useState } from 'react';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
  useRealtimeKitMeeting,
} from '@cloudflare/realtimekit-react';
import './global.css';
import {
  defaultConfig,
  generateConfig,
} from '@cloudflare/realtimekit-react-ui';
import { RtkStateListenersUtils } from './rtk-state-listeners';
import { CustomStates } from './types';
import { setFullScreenToggleTargetElement } from './utils';
import CustomRtkMeeting from './components/custom-rtk-meeting';

function Meeting() {
  const { meeting } = useRealtimeKitMeeting();
  const [config, setConfig] = useState(defaultConfig);
  const [states, setStates] = useState<CustomStates>({
    meeting: 'setup',
    sidebar: 'chat'
  });

  useEffect(() => {
    async function setupMeetingConfigs(){
      const theme = meeting!.self.config;
      const { config } = generateConfig(theme, meeting!);

      /**
       * NOTE(ravindra-dyte):
       * Full screen by default requests rtk-meeting/RtkMeeting element to be in full screen.
       * Since RtkMeeting element is not here,
       *  we need to pass rtk-fullscreen-toggle, an targetElementId through config.
       */
      setFullScreenToggleTargetElement({config, targetElementId: 'root'});

      setConfig({...config});

    /**
     * NOTE(ravindra-dyte):
     * Add listeners on meeting & self to monitor leave meeting, join meeting and so on.
     * This work was earlier done by RtkMeeting component internally.
     */
      const stateListenersUtils = new RtkStateListenersUtils(() => meeting, () => states, () => setStates);
      stateListenersUtils.addRtkEventListeners();
    }

    if(meeting){
    /**
     * NOTE(ravindra-dyte):
     * During development phase, make sure to expose meeting object to window,
     * for debugging purposes.
     */
      Object.assign(window, {
        meeting,
      })
      setupMeetingConfigs();
    }

  }, [meeting]);

  return <CustomRtkMeeting meeting={meeting} config={config} states={states} setStates={setStates} />
  
}

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    async function initalizeMeeting(){
      const searchParams = new URL(window.location.href).searchParams;

      const authToken = searchParams.get('authToken');
  
      if (!authToken) {
        alert(
          "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting.",
        );
        return;
      }
  
      const meeting = await initMeeting({
        authToken,
        defaults: {
          audio: false,
          video: false,
        },
        modules: {devTools: {logs: true}}
      });

      // await meeting!.joinRoom();

    }

    if(!meeting){
      initalizeMeeting();
    }
  }, [meeting]);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider value={meeting}>
      <Meeting/>
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/global.css
================================================
.RtkDialog aside button {
    @apply cursor-pointer transition-colors;
    @apply box-border flex w-full items-center justify-between rounded-l-sm px-4 py-3;
    @apply cursor-pointer shadow-none;
    @apply border-none outline-none;
  }
  
  .RtkDialog aside button.active {
    background: rgba(26,144,255,0.15);
    border-right: theme('borderWidth.2') solid theme('colors.blue.500');
  }
  
  .RtkDialog main {
    @apply p-10 pl-6;
    width: 30rem;
    background-color: #191919;
  }
  
  .RtkDialog {
    @apply fixed inset-0 box-border rounded-md;
    @apply flex-col items-center justify-center;
    /* Hide dialog by default */
    @apply invisible hidden;
    color: white;
  
    z-index: 60;
  
    backdrop-filter: blur(12px) saturate(180%);
  }
  
  .RtkDialog #dialog {
    @apply relative max-h-full max-w-full rounded-md;
    min-height: 320px;
    background-color: #262626;
  }
  
  .RtkDialog #dismiss-btn {
    @apply absolute top-3 right-3 z-50;
  }
  
  .RtkDialog header {
    @apply absolute top-3 left-3 z-50;
    @apply text-xl font-semibold;
  }
  
  .RtkDialog::slotted(*) {
    @apply max-h-full max-w-full;
  }
  
  /* Show only when open="true" */
  .RtkDialog[data-open] {
    @apply visible flex;
  }
  
  /* Hide dialog by default */
  .RtkDialog[data-open='false'] {
    @apply invisible hidden;
  }


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    height: 100%;
  }
}


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/rtk-state-listeners.tsx
================================================
import RealtimeKitClient from '@cloudflare/realtimekit';
import type { PermissionSettings } from '@cloudflare/realtimekit-ui/dist/types/types/props';
import type { RoomLeftState } from '@cloudflare/realtimekit-ui/dist/types/types/rtk-client';
import { CustomStates } from './types';

export class RtkStateListenersUtils{
    
    getStates: () => CustomStates;

    getStateSetter: () => (newState: CustomStates) => void;

    getMeeting: () => RealtimeKitClient;

    get states(){
        return this.getStates();
    }

    get setGlobalStates(){
        return this.getStateSetter();
    };

    get meeting(){
        return this.getMeeting();
    }

    constructor(getMeeting: () => RealtimeKitClient, getGlobalStates: () => CustomStates, getGlobalStateSetter: () => (newState: CustomStates) => void){
        this.getMeeting = getMeeting;
        this.getStates = getGlobalStates;
        this.getStateSetter = getGlobalStateSetter;
    }
    private updateStates(newState: CustomStates){
        this.setGlobalStates((oldState: CustomStates) => { return {
            ...oldState,
            ...newState,
        }});
        console.log(newState);
    }
    private roomJoinedListener = () => {
        this.updateStates({ meeting: 'joined' });
      };
    
      private socketServiceRoomJoinedListener = () => {
        if (this.meeting.stage.status === 'ON_STAGE' || this.meeting.stage.status === undefined) return;
        this.updateStates({ meeting: 'joined' });
      };
    
      private waitlistedListener = () => {
        this.updateStates({ meeting: 'waiting' });
      };
    
      private roomLeftListener = ({ state }: { state: RoomLeftState }) => {
        const states = this.states;
        if (states?.roomLeftState === 'disconnected') {
          this.updateStates({ meeting: 'ended', roomLeftState: state });
          return;
        }
        this.updateStates({ meeting: 'ended', roomLeftState: state });
      };
    
      private mediaPermissionUpdateListener = ({ kind, message }: {
        kind: PermissionSettings['kind'],
        message: string,
      }) => {
        if (['audio', 'video'].includes(kind!)) {
          if (message === 'ACCEPTED' || message === 'NOT_REQUESTED' || this.states.activeDebugger)
            return;
          const permissionModalSettings: PermissionSettings = {
            enabled: true,
            kind,
          };
          this.updateStates({ activePermissionsMessage: permissionModalSettings });
        }
      };
    
      private joinStateAcceptedListener = () => {
        this.updateStates({ activeJoinStage: true });
      };

      private handleChangingMeeting(destinationMeetingId: string) {
        this.updateStates({
            activeBreakoutRoomsManager: {
                ...this.states.activeBreakoutRoomsManager,
                active: this.states.activeBreakoutRoomsManager!.active,
                destinationMeetingId,
            }
        });
    }
    
    addRtkEventListeners(){
        if (this.meeting.meta.viewType === 'LIVESTREAM') {
            this.meeting.self.addListener('roomJoined', this.socketServiceRoomJoinedListener);
          }
          this.meeting.self.addListener('roomJoined', this.roomJoinedListener);
      
          this.meeting.self.addListener('waitlisted', this.waitlistedListener);
          this.meeting.self.addListener('roomLeft', this.roomLeftListener);
          this.meeting.self.addListener('mediaPermissionUpdate', this.mediaPermissionUpdateListener);
          this.meeting.stage.addListener('stageRequestApproved', this.joinStateAcceptedListener);
      
          if (this.meeting.connectedMeetings.supportsConnectedMeetings) {
            this.meeting.connectedMeetings.once('changingMeeting', this.handleChangingMeeting);
          }

    }
    cleanupRtkEventListeners(){

    }
}


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/types.tsx
================================================
import type { States } from '@cloudflare/realtimekit-ui';
import { RtkSidebarSection } from '@cloudflare/realtimekit-ui/dist/types/components/rtk-sidebar/rtk-sidebar';

export type CustomSideBarTabs = RtkSidebarSection | 'warnings';

export type CustomStates = States & { activeMediaPreviewModal?: boolean, customSidebar?: CustomSideBarTabs }

export type SetStates = React.Dispatch<React.SetStateAction<CustomStates>>;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/utils.ts
================================================
import { UIConfig } from '@cloudflare/realtimekit-ui';

export function setFullScreenToggleTargetElement({config, targetElementId}: { config: UIConfig, targetElementId: string }){
    if (config.root && Array.isArray(config.root['div#controlbar-left'])) {
        const fullScreenToggleIndex = config.root['div#controlbar-left'].indexOf('rtk-fullscreen-toggle');
        if(fullScreenToggleIndex > -1){
            config.root['div#controlbar-left'][fullScreenToggleIndex] = ['rtk-fullscreen-toggle', {
                variant: 'vertical',
                targetElement: document.querySelector(`#${targetElementId}`),
            }];
        }
    }
    ['rtk-more-toggle.activeMoreMenu', 'rtk-more-toggle.activeMoreMenu.md', 'rtk-more-toggle.activeMoreMenu.sm'].forEach((configElemKey) => {
        const configElem = config?.root?.[configElemKey] as any;
        configElem?.forEach((rtkElemConfigSet: any) => {
            if (rtkElemConfigSet[0] === 'rtk-fullscreen-toggle') {
                rtkElemConfigSet[1].targetElement = document.querySelector(`#${targetElementId}`);
            }
        });
    });
}


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/audio-preview.tsx
================================================
import RealtimeKitClient from '@cloudflare/realtimekit';
import { useEffect, useRef, useState } from "react";
import { RtkAudioVisualizer, RtkButton, RtkIcon, RtkSettingsAudio, RtkSwitch, defaultIconPack } from '@cloudflare/realtimekit-react-ui';
import { CustomStates, SetStates } from "../types";
import { UIConfig } from '@cloudflare/realtimekit-ui';
interface CurrentDevices {
    audio?: MediaDeviceInfo;
    speaker?: MediaDeviceInfo;
}

function AudioPreviewPreBuilt({
    meeting, states
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    return <RtkSettingsAudio meeting={meeting} states={states}/>;
}

function AudioPreviewWithCustomUI({
    meeting,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
) {
    const [audioDevices, setAudioDevices] = useState<MediaDeviceInfo[]>([]);
    const [speakerDevices, setSpeakerDevices] = useState<MediaDeviceInfo[]>([]);
    const [currentDevices, setCurrentDevices] = useState<CurrentDevices>({});
    const testAudioEl = useRef<HTMLAudioElement>(null);
    useEffect(() => {
        if (!meeting) {
            return;
        }
        const deviceListUpdateCallback = async () => {
            setAudioDevices(await meeting.self.getAudioDevices());
            setSpeakerDevices(await meeting.self.getSpeakerDevices());
        }
        meeting.self.addListener('deviceListUpdate', deviceListUpdateCallback);
        //populate first time values
        deviceListUpdateCallback();
        setCurrentDevices({
            audio: meeting.self.getCurrentDevices().audio,
            speaker: meeting.self.getCurrentDevices().speaker
        })
        return () => {
            meeting.self.removeListener('deviceListUpdate', deviceListUpdateCallback);
        }
    }, [meeting])
    const setDevice = (kind: 'audio' | 'speaker', deviceId: string) => {
        // if (disableSettingSinkId(this.meeting)) return;
        const device =
            kind === 'audio'
                ? audioDevices.find((d) => d.deviceId === deviceId)
                : speakerDevices.find((d) => d.deviceId === deviceId);
        setCurrentDevices((oldDevices) => {
            return {
                ...oldDevices,
                [kind]: device,
            }
        })
        if (device != null) {
            meeting.self.setDevice(device);
            if (device.kind === 'audiooutput') {
                if ((testAudioEl.current as any)?.setSinkId) {
                    (testAudioEl.current as any)?.setSinkId(device.deviceId)
                };
            }
        }
    }
    let unnamedMicCount = 0;
    let unnamedSpeakerCount = 0;
    const testAudio = () => {
        testAudioEl?.current?.play();
    }
    return (
        <div className="flex flex-col p-4">
            <audio
                preload="auto"
                src="https://assets.dyte.io/ui-kit/speaker-test.mp3"
                ref={testAudioEl}
            />
            {
                meeting.self.permissions.canProduceAudio === 'ALLOWED' && (
                    <div>
                        <label>Microphone</label>
                        <div>
                            <select
                                className="mt-2 w-full text-ellipsis bg-[#1F1F1F] p-2"
                                onChange={(e) => setDevice('audio', (e.target as HTMLSelectElement).value)}
                            >
                                {audioDevices.map(({ deviceId, label }) => (
                                    <option
                                        key={deviceId}
                                        value={deviceId}
                                        selected={currentDevices.audio?.deviceId === deviceId}
                                    >
                                        {label || `Microphone ${++unnamedMicCount}`}
                                    </option>
                                ))}
                            </select>
                            <RtkAudioVisualizer
                                participant={meeting?.self}
                            />
                        </div>
                    </div>
                )
            }
            <div>
                {speakerDevices.length > 0 && (
                    <div>
                        <label>Speaker Output</label>
                        <div>
                            <select
                                className="mt-2 w-full text-ellipsis bg-[#1F1F1F] p-2"
                                onChange={(e) => setDevice('speaker', (e.target as HTMLSelectElement).value)}
                            >
                                {speakerDevices.map(({ deviceId, label }) => (
                                    <option
                                        key={deviceId}
                                        value={deviceId}
                                        selected={currentDevices.speaker?.deviceId === deviceId}
                                    >
                                        {label || `Speaker ${++unnamedSpeakerCount}`}
                                    </option>
                                ))}
                            </select>
                        </div>
                    </div>
                )}
                <RtkButton
                    className="mt-2 bg-[#1F1F1F]"
                    onClick={() => testAudio()}
                    size="lg"
                >
                    <RtkIcon icon={defaultIconPack.speaker} slot="start" />
                    Test
                </RtkButton>
            </div>
        </div>
    );
}

export default AudioPreviewPreBuilt; // uncomment if you want to use prebuilt audio preview
// export default AudioPreviewWithCustomUI; // uncomment if you want custom ui for audio preview


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/custom-participant-tile.tsx
================================================
import { RtkParticipantTile, RtkAvatar, RtkNameTag, RtkAudioVisualizer, RtkIcon } from '@cloudflare/realtimekit-react-ui';
import RealtimeKitClient, { RTKParticipant, RTKSelf } from '@cloudflare/realtimekit';

function CustomParticipantTile({
    meeting, participant, hasRaisedHand, reaction, onClick, style={}
}: {
    meeting: RealtimeKitClient,
    participant: RTKParticipant | RTKSelf,
    hasRaisedHand: boolean,
    reaction: string,
    onClick?: () => void,
    style?: {[key:string]: string},
}){
return (
    <div className='participant-preview'>
        <RtkParticipantTile
        participant={participant}
        meeting={meeting}
        key={'selectedParticipant'}
        style={style}
        onClick={onClick}
    >
        <RtkAvatar participant={participant} />
        <div className='absolute p-2 left-0 bottom-0'>
        <RtkNameTag participant={participant}>
            <RtkAudioVisualizer
                participant={participant}
                slot="start"
            />
        </RtkNameTag>
        </div>
        <div className='absolute p-2 right-0 top-0'>
                {
                    hasRaisedHand && (
                    <RtkIcon icon='<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.02c0 1.06.2 2.1.6 3.08l.6 1.42c.22.55.64 1.01 1.17 1.29.27.14.56.21.86.21h2.55c.77 0 1.49-.41 1.87-1.08.5-.87 1.02-1.7 1.72-2.43l1.32-1.39c.44-.46.97-.84 1.49-1.23l.59-.45a.6.6 0 0 0 .23-.47c0-.75-.54-1.57-1.22-1.79a3.34 3.34 0 0 0-2.78.29V4.5a1.5 1.5 0 0 0-2.05-1.4 1.5 1.5 0 0 0-2.9 0A1.5 1.5 0 0 0 6 4.5v.09A1.5 1.5 0 0 0 4 6v6.02ZM8 4.5v4a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0v6a.5.5 0 0 0 .85.37h.01c.22-.22.44-.44.72-.58.7-.35 2.22-.57 2.4.5l-.53.4c-.52.4-1.04.78-1.48 1.24l-1.33 1.38c-.75.79-1.31 1.7-1.85 2.63-.21.36-.6.58-1.01.58H7.23a.87.87 0 0 1-.4-.1 1.55 1.55 0 0 1-.71-.78l-.59-1.42a7.09 7.09 0 0 1-.53-2.7V6a.5.5 0 0 1 1 0v3.5a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0Z" fill="currentColor"></path></svg>' />
                )
                }
                {
                    reaction && (
                        <div className='text-3xl'>
                            {reaction}
                        </div> 
                    )
                }
        </div>
    </RtkParticipantTile>
    </div>
);
}

export default CustomParticipantTile;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/custom-rtk-grid.css
================================================
.participants-with-shared-screen{
    display: flex;
}

.stage-holder{
    display: flex;
    width: 100%;
    height: 60vh;
    justify-content: center;
}

.shared-screen{
    width: 100%;
    display: flex;
    justify-content: center;
}

.participant-preview{
    display: flex;
    justify-content: center;
    width: 100%;
}


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/custom-rtk-grid.tsx
================================================
import type RealtimeKitClient from '@cloudflare/realtimekit';
import { UIConfig }  from '@cloudflare/realtimekit-ui/dist/types/types/ui-config';
import { CustomStates, SetStates } from '../types';
import { useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import { defaultIconPack, RtkAudioVisualizer, RtkAvatar, RtkButton, RtkCameraToggle, RtkControlbarButton, RtkIcon, RtkMicToggle, RtkNameTag, RtkParticipantTile, RtkScreenshareView } from '@cloudflare/realtimekit-react-ui';

import './custom-rtk-grid.css';
import { useEffect, useState } from 'react';
import { RTKParticipant, RTKSelf } from '@cloudflare/realtimekit';
import CustomParticipantTile from './custom-participant-tile';

function CustomRtkGridScreenshareFocused({
    meeting,
    config,
    states,
    setStates,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}) {
    
    const [size] = useState({ height: '120px', width: '120px' });

    const [selectedSharedScreenParticipant, setSelectedSharedScreenParticipant] = useState<RTKSelf | RTKParticipant | null>(null);

    const [selectedParticipant, setSelectedParticipant] = useState<RTKSelf | RTKParticipant | null>(meeting.self);

    const [handRaisedPeerIds, setHandRaisedPeerIds] = useState<string[]>([]);

    const [reactions, setReactions] = useState<{[key: string]: string}>({});

    const activeParticipants = useRealtimeKitSelector((meeting) =>
        meeting.participants.active.toArray()
    );

    const pinnedParticipants = useRealtimeKitSelector((meeting) =>
        meeting.participants.pinned.toArray()
    );

    const screensharedParticipants = useRealtimeKitSelector((meeting) => {
        const allParticipants = [meeting.self, ...meeting.participants.joined.toArray()];
        return allParticipants.filter((p) => p.screenShareEnabled);
    });

    const participants = [
        meeting.self,
        ...pinnedParticipants,
        ...activeParticipants.filter((p) => !pinnedParticipants.includes(p)),
    ];

    useEffect(() => {
        if(!meeting){
            return;
        }
        meeting.participants.joined.on('participantLeft', (participant) => {
            if(selectedParticipant?.id === participant.id){
                setSelectedParticipant(meeting.self);
            }
            if(selectedSharedScreenParticipant?.id === participant.id){
                setSelectedSharedScreenParticipant(null);
            }
        });
    }, [meeting]);

    useEffect(() => {
        meeting.participants.addListener('broadcastedMessage', broadcastedMessage => {
            if(broadcastedMessage.type === 'raised-hand'){
                setHandRaisedPeerIds((prev) => {
                    return [...prev, broadcastedMessage.payload.peerId?.toString()];
                });
            }
            if(broadcastedMessage.type === 'lowered-hand'){
                setHandRaisedPeerIds((prev) => {
                    const currentHandRaised = prev.filter(peerId => peerId !== broadcastedMessage.payload.peerId?.toString());
                    return currentHandRaised;
                });
            }
        });
    }, [meeting]);

    useEffect(() => {
        meeting.participants.addListener('broadcastedMessage', broadcastedMessage => {
            if(broadcastedMessage.type === 'reactions'){
                setReactions((prev) => {
                    return {
                        ...prev,
                        [broadcastedMessage.payload.peerId?.toString()]:  broadcastedMessage.payload.reaction?.toString(),
                    };
                });
            }
        });
    }, [meeting]);

    useEffect(() => {
        if(screensharedParticipants.length === 0){
            setSelectedSharedScreenParticipant(null);
            setSelectedParticipant(meeting.self);
        }
        if(screensharedParticipants.length >= 1 && !selectedParticipant && !selectedSharedScreenParticipant){
            setSelectedSharedScreenParticipant(screensharedParticipants[0]);
        }
    }, [screensharedParticipants]);

    return (
        <div className='w-full flex flex-col justify-around'>
            <div className='flex justify-center'>
            {
                participants.map(participant => {
                    return (
                    <div
                    className='ml-2'
                    key={participant.id}
                    >
                        <CustomParticipantTile
                            meeting={meeting}
                            participant={participant}
                            hasRaisedHand={handRaisedPeerIds.includes(participant.id)}
                            reaction={reactions[participant.id]}
                            style={{
                                ...size,
                            }}
                            onClick={() => {
                                setSelectedParticipant(participant);
                                setSelectedSharedScreenParticipant(null);
                            }}
                        />
                    </div>
                    )
                })
            }
            </div>
            <div className='stage-holder'>
            {
                    screensharedParticipants.length >= 1 && (
                    <div className='participants-with-shared-screen flex flex-col mt-2'>
                        <div className='mt-10'>Shared&nbsp;screens:</div>
                        {screensharedParticipants.map(participant => {
                            return (
                                <div
                                className='mt-2'
                                key={participant.id}
                                >
                                    <RtkButton
                                    variant='secondary'
                                    className='bg-[#242424] p-2 h-fit'
                                    type='button'
                                    onClick={() => {
                                        setSelectedParticipant(null);
                                        setSelectedSharedScreenParticipant(participant)
                                    }}
                                    >
                                        <div className="flex flex-col items-center">
                                            <RtkIcon
                                                icon={defaultIconPack.share_screen_person}
                                            />
                                            <span>
                                                {participant.id === meeting?.self.id ? 'you' : participant.name}
                                            </span>
                                        </div>
                                    </RtkButton>
                                </div>
                            );
                        })
                    }
                    </div>
                )}
                {
                    selectedSharedScreenParticipant && (
                        <div className='shared-screen'>
                            <RtkScreenshareView
                                meeting={meeting}
                                participant={selectedSharedScreenParticipant}
                                hideFullScreenButton={false}
                                style={{
                                    width: '60%'
                                }}
                            />
                        </div>
                    )
                }
                {selectedParticipant && (
                    <CustomParticipantTile
                        style={{
                            height: '100%',
                        }}
                        meeting={meeting}
                        participant={selectedParticipant}
                        hasRaisedHand={handRaisedPeerIds.includes(selectedParticipant.id)}
                        reaction={reactions[selectedParticipant.id]}
                    />
                )}
            </div>
        </div>
    );
}

export default CustomRtkGridScreenshareFocused;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/custom-rtk-meeting.tsx
================================================
import { UIConfig } from '@cloudflare/realtimekit-ui'
import RealtimeKitClient from '@cloudflare/realtimekit'
import { CustomStates, SetStates } from "../types"
import InMeeting from "./in-meeting"
import MeetingLoading from "./meeting-loading"
import MeetingOver from "./meeting-over"
import SetupScreen from "./setup-screen"
import WaitingRoom from "./waiting-room"

function CustomRtkMeeting({
  meeting,
  config,
  states,
  setStates,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}){
  if (!meeting) {
    <MeetingLoading />
  }
  
  if (states.meeting === 'setup') {
    return <SetupScreen meeting={meeting} config={config} states={states} setStates={setStates} />
  }
  
  if(states.meeting === 'ended'){
    return <MeetingOver meeting={meeting} config={config} states={states} setStates={setStates} />
  }
  
  if(states.meeting === 'waiting'){
    return <WaitingRoom meeting={meeting} config={config} states={states} setStates={setStates} />
  }
  
  if(states.meeting === 'joined'){
    return <InMeeting meeting={meeting} config={config} states={states} setStates={setStates} />
  }

  return null;
  
}

export default CustomRtkMeeting;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/Dialog.tsx
================================================
import { RtkButton, RtkIcon, defaultIconPack } from '@cloudflare/realtimekit-react-ui';
import { FC, ReactNode } from 'react';

type DialogProps = {
  isOpen: boolean;
  onClose: () => void;
  header: string;
  children: ReactNode;
};
const Dialog: FC<DialogProps> = ({ header, isOpen, children, onClose }) => {
  if (!isOpen) return null;
  return (
    <div className="RtkDialog" data-open={isOpen}>
      <div id="dialog">
        {/* <header>
          <h2>Effects</h2>
        </header> */}
        <RtkButton
          id="dismiss-btn"
          kind="icon"
          variant="ghost"
          onClick={() => onClose()}
        >
          <RtkIcon icon={defaultIconPack.dismiss} />
        </RtkButton>
        {children}
      </div>
    </div>
  );
};

export default Dialog;



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/EffectsManager.tsx
================================================
/* eslint-disable @next/next/no-img-element */
import { RtkSwitch } from '@cloudflare/realtimekit-react-ui';
import Dialog from './Dialog';
import { useEffect, useRef, useState } from 'react';
import { storeSelector, useRtkStore } from '../lib/store';
import RealtimeKitVideoBackgroundTransformer from '@cloudflare/realtimekit-virtual-background';
import type RealtimeKitClient from '@cloudflare/realtimekit';
import type { VideoMiddleware } from '@cloudflare/realtimekit';

export const getBackgroundImage = (name: string) => `https://assets.dyte.io/backgrounds/${name}`;
const IMAGE_URLS = [
  'bg_0.jpg',
  'bg_1.jpg',
  'bg_2.jpg',
  'bg_3.jpg',
  'bg_4.jpg',
  'bg_5.jpg',
  'bg_6.jpg',
];

const MiddlewareHolder: {
  currentVideo?: VideoMiddleware;
  transformer?: RealtimeKitVideoBackgroundTransformer;
} = {};

const EffectsManager = ({
  meeting,
  isOpen,
  onClose,
}: {
  meeting: RealtimeKitClient;
  onClose: () => void;
  isOpen: boolean;
}) => {
  const [selected, setSelected] = useState('video');
  const { effects, updateStore } = useRtkStore(storeSelector);
  const backgroundTransformerInit = useRef(false);

  useEffect(() => {
    if (MiddlewareHolder.currentVideo) {
      meeting?.self.removeVideoMiddleware(MiddlewareHolder.currentVideo);
      MiddlewareHolder.currentVideo = undefined;
    }
    const load = async () => {
      if (!meeting) return;
      let isChatSDK = false;
      if (meeting?.self.config.viewType === 'CHAT') {
        isChatSDK = true;
      }
      if (!MiddlewareHolder.transformer) {
        if (
          RealtimeKitVideoBackgroundTransformer.isSupported() &&
          !isChatSDK &&
          // prevent double init
          backgroundTransformerInit.current !== true
        ) {
          backgroundTransformerInit.current = true;
          /**
           * To customise RealtimeKitVideoBackgroundTransformer configs, please refer to https://www.npmjs.com/package/@cloudflare/realtimekit-virtual-background?activeTab=readme.
           * 
          */
          const transformer = await RealtimeKitVideoBackgroundTransformer.init({
            meeting,
            segmentationConfig: {
              pipeline: 'canvas2dCpu', // 'webgl2' | 'canvas2dCpu'
            },
          });
          MiddlewareHolder.transformer = transformer;
        } else return;
      }
      await meeting.self.setVideoMiddlewareGlobalConfig({ disablePerFrameCanvasRendering: true });
      if (effects.video.background === 'image') {
        const imageURL = `https://assets.dyte.io/backgrounds/${effects.video.backgroundImage}`;
        MiddlewareHolder.transformer
          ?.createStaticBackgroundVideoMiddleware(imageURL)
          .then((middleware: any) => {
            MiddlewareHolder.currentVideo = middleware;
            meeting?.self.addVideoMiddleware(middleware);
          });
      } else if (effects.video.background === 'blur') {
        MiddlewareHolder.transformer
          ?.createBackgroundBlurVideoMiddleware()
          .then((middleware: any) => {
            MiddlewareHolder.currentVideo = middleware;
            meeting?.self.addVideoMiddleware(middleware);
          });
      }
    };
    load();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [effects.video.background, effects.video.backgroundImage]);

  return (
    <Dialog isOpen={isOpen} onClose={onClose} header={'Effects'}>
      <div
        className="relative flex overflow-hidden rounded-lg w-full h-full"
        style={{ backgroundColor: '' }}
      >
        <aside>
          <button
            onClick={() => setSelected('video')}
            type="button"
            className={selected === 'video' ? 'active' : ''}
          >
            Video
          </button>
        </aside>
        <main className="">
          {selected === 'video' && (
            <div className="group">
              <h3 className="text-lg font-medium">Background</h3>
              <div className="inline-grid grid-cols-6 gap-2 mt-2">
                <div
                  className={`backgroundBox ${effects.video.background === 'none' ? 'active' : ''}`}
                >
                  <img
                    alt="None"
                    className='cursor-pointer'
                    src={getBackgroundImage('icon_none.svg')}
                    onClick={() => {
                      const newEffects = { ...effects };
                      newEffects.video.background = 'none';
                      newEffects.video.backgroundImage = '';
                      updateStore('effects', newEffects);
                    }}
                  />
                </div>

                <div
                  className={`backgroundBox ${effects.video.background === 'blur' ? 'active' : ''}`}
                >
                  <img
                    alt="Blur"
                    className='cursor-pointer'
                    src={getBackgroundImage('icon_blur.svg')}
                    onClick={() => {
                      const newEffects = { ...effects };
                      newEffects.video.background = 'blur';
                      newEffects.video.backgroundImage = '';
                      updateStore('effects', newEffects);
                    }}
                  />
                </div>
              </div>
              <div className="inline-grid grid-cols-4 gap-2 mt-4">
                {IMAGE_URLS.map((u, i) => (
                  <div
                    className={`backgroundBox ${
                      effects.video.backgroundImage === u ? 'active' : ''
                    } cursor-pointer`}
                    key={u}
                  >
                    <img
                      className={`w-14 h-14`}
                      alt={`Image ${i}`}
                      src={getBackgroundImage(u)}
                      onClick={() => {
                        const newEffects = { ...effects };
                        newEffects.video.background = 'image';
                        newEffects.video.backgroundImage = u;
                        updateStore('effects', newEffects);
                      }}
                    />
                  </div>
                ))}
              </div>
            </div>
          )}
        </main>
      </div>
    </Dialog>
  );
};

export default EffectsManager;



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/in-meeting.tsx
================================================
import type RealtimeKitClient from '@cloudflare/realtimekit';
import { UIConfig }  from '@cloudflare/realtimekit-ui/dist/types/types/ui-config';
import { CustomStates, SetStates } from '../types';
import { RtkHeader, RtkStage, RtkGrid, RtkNotifications, RtkSidebar, RtkParticipantsAudio, RtkDialogManager, RtkControlbar, RtkControlbarButton } from '@cloudflare/realtimekit-react-ui';
import MeetingHeader from './meeting-header';
import MeetingControlBar from './meeting-control-bar';
import MeetingSideBar from './meeting-sidebar';
import CustomRtkGrid from './custom-rtk-grid';
import EffectsManager from './EffectsManager';
import { useState } from 'react';
import ReactionsManager from './ReactionsManager';
function InMeeting({
    meeting,
    config,
    states,
    setStates,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}) {
  
  const [effectsDialog, setEffectsDialog] = useState(false);
  const [reactionsDialog, setReactionsDialog] = useState(false);
  
  return (
    <div
      className="flex flex-col w-full h-full"
      ref={(el) => {
        el?.addEventListener('rtkStateUpdate', (e) => {
          const { detail: newStateUpdate } = e as unknown as { detail: CustomStates };
          console.log('rtkStateUpdateSetup:: ', newStateUpdate);
          setStates((oldState: CustomStates) => { return {
            ...oldState,
            ...newStateUpdate,
          }});
        });
      }}
    >
      <header>
        <MeetingHeader meeting={meeting} config={config} states={states} setStates={setStates}/>
      </header>
      <main className='flex w-full flex-1' style={{
        backgroundColor: '#272727',
        color: '#ffffff',
      }}>
        <RtkStage className='flex w-full flex-1 p-2'>
          <CustomRtkGrid meeting={meeting} config={config} states={states} setStates={setStates}/>
          <RtkNotifications meeting={meeting} config={config}  states={states}/>
          <MeetingSideBar meeting={meeting} config={config} states={states} setStates={setStates}/>
        </RtkStage>
        <RtkParticipantsAudio meeting={meeting}/>
        <RtkDialogManager meeting={meeting} config={config} states={states}/>
      </main>
      <footer className='flex w-full overflow-visible'>
        <MeetingControlBar meeting={meeting} config={config} states={states} setStates={setStates} setEffectsDialog={setEffectsDialog} setReactionsDialog={setReactionsDialog} />
      </footer>
      <EffectsManager
            meeting={meeting}
            isOpen={effectsDialog}
            onClose={() => setEffectsDialog(false)}
      />
      <ReactionsManager
        meeting={meeting}
        isOpen={reactionsDialog}
        onClose={() => setReactionsDialog(false)}
      />
    </div>
  );
}

export default InMeeting;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/media-preview-modal.tsx
================================================
import { RtkDialog, RtkIcon, defaultIconPack } from '@cloudflare/realtimekit-react-ui';
import { useState } from "react";
import RealtimeKitClient from '@cloudflare/realtimekit';
import { UIConfig } from '@cloudflare/realtimekit-ui';
import AudioPreview from "./audio-preview";
import VideoPreview from "./video-preview";
import { CustomStates, SetStates } from "../types";

function MediaPreviewModal({
    open, states, setStates, meeting, config,
}: { open: boolean, config: UIConfig, states: CustomStates, setStates: SetStates, meeting: RealtimeKitClient }) {
    const [activeTab, setActiveTab] = useState<'audio' | 'video'>('video');
    return (
        <RtkDialog
            open={open}
            onRtkDialogClose={() => setStates((oldState: CustomStates) => { return {
                ...oldState,
                activeMediaPreviewModal: false
            }})}
        >
            <div className="flex min-w-[720px] min-h-[480px] bg-[#222222]">
                <aside className="flex flex-col w-1/3 bg-[#181818]">
                    <header className="flex justify-center items-center h-[100px]">
                        <h2>Media Preview</h2>
                    </header>
                    {meeting.self.permissions.canProduceAudio === 'ALLOWED' &&
                        <button
                            type="button"
                            className={`${activeTab === 'audio' ? 'bg-[#2160FD]' : ''} flex justify-between p-2 rounded`}
                            onClick={() => setActiveTab('audio')}
                        >
                            Audio
                            <div>
                                <RtkIcon icon={defaultIconPack.mic_on} />
                            </div>
                        </button>
                    }
                    {meeting.self.permissions.canProduceVideo === 'ALLOWED' && (
                        <button
                            type="button"
                            className={`${activeTab === 'video' ? 'bg-[#2160FD]' : ''} flex justify-between p-2 rounded`}
                            onClick={() => setActiveTab('video')}
                        >
                            Video
                            <div>
                                <RtkIcon icon={defaultIconPack.video_on} />
                            </div>
                        </button>
                    )}
                </aside>
                <main className="flex flex-col w-2/3">
                    {activeTab === 'audio' && <AudioPreview meeting={meeting} config={config} states={states} setStates={setStates} />}
                    {activeTab === 'video' && <VideoPreview meeting={meeting} config={config} states={states} setStates={setStates} />}
                </main>
            </div>
        </RtkDialog>
    );
}

export default MediaPreviewModal;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/meeting-control-bar.tsx
================================================
import { RtkBreakoutRoomsToggle, RtkCameraToggle, RtkChatToggle, RtkControlbar, RtkControlbarButton, RtkFullscreenToggle, RtkLeaveButton, RtkMicToggle, RtkMoreToggle, RtkMuteAllButton, RtkParticipantsToggle, RtkPipToggle, RtkPluginsToggle, RtkPoll, RtkPollsToggle, RtkRecordingToggle, RtkScreenShareToggle, RtkSettingsToggle, RtkStageToggle } from '@cloudflare/realtimekit-react-ui';
import { UIConfig, defaultIconPack } from '@cloudflare/realtimekit-ui';
import RealtimeKitClient from '@cloudflare/realtimekit';
import { CustomStates, SetStates } from "../types";
import { useEffect, useState } from "react";

function ControlBarPreBuilt({
    meeting, states, config,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    return <RtkControlbar meeting={meeting} config={config}  states={states} className='flex w-full overflow-visible	justify-between'/>;
}

function ControlBarWithCustomUI({
    meeting, states, config, setStates, setEffectsDialog, setReactionsDialog,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates, setEffectsDialog: (openEffectsDialog: boolean) => void, setReactionsDialog:  (openReactionsDialog: boolean) => void}
){

    const fullScreenTargetElement = document.querySelector('#root') as HTMLElement;

    const [handRaised, setHandRaised] = useState(false);

    useEffect(() => {
        if(!meeting){
            return;
        }
        meeting.participants.joined.addListener('participantJoined', () => {
            setTimeout(() => {
                // Hack - Re broadcast the message when a new participant joins
                meeting.participants.broadcastMessage(handRaised? "raised-hand" : "lowered-hand", {
                    peerId: meeting.self.id,
                });
            }, 1000);
        });
    }, [meeting]);

    return (
        <div className="flex w-full bg-black text-white justify-between">
            <div id="controlbar-left" className="flex items-center overflow-visible justify-center">
                <RtkFullscreenToggle states={states} targetElement={fullScreenTargetElement}/>
                <RtkSettingsToggle states={states} />
                <RtkScreenShareToggle states={states} meeting={meeting} />
            </div>
            <div id="controlbar-center" className="flex items-center overflow-visible justify-center">
                <RtkMicToggle meeting={meeting} />
                <RtkCameraToggle meeting={meeting} />
                <RtkStageToggle meeting={meeting} />
                <RtkLeaveButton/>
                <RtkMoreToggle states={states}>
                    <div slot="more-elements">
                        <RtkPipToggle meeting={meeting} states={states} config={config} variant="horizontal" />
                        <RtkMuteAllButton meeting={meeting} variant="horizontal"/>
                        <RtkBreakoutRoomsToggle meeting={meeting} states={states} variant="horizontal"/>
                        <RtkRecordingToggle meeting={meeting} variant="horizontal"/>
                    </div>
                </RtkMoreToggle>
            </div>
            <div id="controlbar-right" className="flex items-center overflow-visible justify-center">
                <RtkChatToggle meeting={meeting} states={states}/>
                <RtkPollsToggle meeting={meeting} states={states}/>
                <RtkParticipantsToggle meeting={meeting} states={states}/>
                <RtkPluginsToggle meeting={meeting} states={states} />
                <RtkControlbarButton
                    onClick={() => {
                        if(states.activeSidebar && !states.sidebar && states.customSidebar === 'warnings'){
                            setStates( (oldState) => { return { ...oldState, activeSidebar: false, sidebar: null, customSidebar: null }});    
                        } else {
                            setStates( (oldState) => { return { ...oldState, activeSidebar: true, sidebar: null, customSidebar: 'warnings' }});
                        }
                    }}
                    icon={defaultIconPack.add}
                    label={'Open Custom SideBar'}
                />
                <RtkControlbarButton
                    onClick={() => setEffectsDialog(true)}
                    icon={defaultIconPack.ai_sparkle}
                    label={'Effects'}
                />
                <RtkControlbarButton
                    onClick={async () => {
                        setHandRaised(!handRaised);
                        await meeting.participants.broadcastMessage(handRaised? "lowered-hand" : "raised-hand", {
                            peerId: meeting.self.id,
                        });
                    }}
                    icon='<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.02c0 1.06.2 2.1.6 3.08l.6 1.42c.22.55.64 1.01 1.17 1.29.27.14.56.21.86.21h2.55c.77 0 1.49-.41 1.87-1.08.5-.87 1.02-1.7 1.72-2.43l1.32-1.39c.44-.46.97-.84 1.49-1.23l.59-.45a.6.6 0 0 0 .23-.47c0-.75-.54-1.57-1.22-1.79a3.34 3.34 0 0 0-2.78.29V4.5a1.5 1.5 0 0 0-2.05-1.4 1.5 1.5 0 0 0-2.9 0A1.5 1.5 0 0 0 6 4.5v.09A1.5 1.5 0 0 0 4 6v6.02ZM8 4.5v4a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0v6a.5.5 0 0 0 .85.37h.01c.22-.22.44-.44.72-.58.7-.35 2.22-.57 2.4.5l-.53.4c-.52.4-1.04.78-1.48 1.24l-1.33 1.38c-.75.79-1.31 1.7-1.85 2.63-.21.36-.6.58-1.01.58H7.23a.87.87 0 0 1-.4-.1 1.55 1.55 0 0 1-.71-.78l-.59-1.42a7.09 7.09 0 0 1-.53-2.7V6a.5.5 0 0 1 1 0v3.5a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0Z" fill="currentColor"></path></svg>'
                    label={handRaised? 'Lower hand': 'Raise Hand'}
                />
                <RtkControlbarButton
                    onClick={() => setReactionsDialog(true)}
                    icon='<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 122.88"><defs><style>.cls-1{fill:#fbd433;}.cls-1,.cls-2{fill-rule:evenodd;}.cls-2{fill:#141518;}</style></defs><title>smiley</title><path class="cls-1" d="M45.54,2.11A61.42,61.42,0,1,1,2.11,77.34,61.42,61.42,0,0,1,45.54,2.11Z"/><path class="cls-2" d="M45.78,32.27c4.3,0,7.79,5,7.79,11.27s-3.49,11.27-7.79,11.27S38,49.77,38,43.54s3.48-11.27,7.78-11.27Z"/><path class="cls-2" d="M77.1,32.27c4.3,0,7.78,5,7.78,11.27S81.4,54.81,77.1,54.81s-7.79-5-7.79-11.27S72.8,32.27,77.1,32.27Z"/><path d="M28.8,70.82a39.65,39.65,0,0,0,8.83,8.41,42.72,42.72,0,0,0,25,7.53,40.44,40.44,0,0,0,24.12-8.12,35.75,35.75,0,0,0,7.49-7.87.22.22,0,0,1,.31,0L97,73.14a.21.21,0,0,1,0,.29A45.87,45.87,0,0,1,82.89,88.58,37.67,37.67,0,0,1,62.83,95a39,39,0,0,1-20.68-5.55A50.52,50.52,0,0,1,25.9,73.57a.23.23,0,0,1,0-.28l2.52-2.5a.22.22,0,0,1,.32,0l0,0Z"/></svg>'
                    label={'Reactions'}
                />
            </div>
        </div>
    );
}

// export default ControlBarPreBuilt; // uncomment if you are fine with prebuilt control bar
export default ControlBarWithCustomUI; // uncomment if you want to create a custom control bar


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/meeting-header.tsx
================================================
import { RtkClock, RtkGridPagination, RtkHeader, RtkLivestreamIndicator, RtkLogo, RtkMeetingTitle, RtkParticipantCount, RtkRecordingIndicator, RtkViewerCount } from '@cloudflare/realtimekit-react-ui';
import { UIConfig } from '@cloudflare/realtimekit-ui';
import RealtimeKitClient from '@cloudflare/realtimekit';
import { CustomStates, SetStates } from "../types";

function HeaderPreBuilt({
    meeting, states, config, setStates,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    return <RtkHeader meeting={meeting} config={config} className='flex justify-between'/>;
}

function HeaderWithCustomUI({
    meeting, states, config,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    
    return (
        <div className='flex justify-between bg-black text-white'>
            <div id="header-left" className="flex items-center h-[48px]">
                <RtkLogo meeting={meeting} />
                <RtkRecordingIndicator meeting={meeting}/>
                <RtkLivestreamIndicator meeting={meeting}/>
            </div>
            <div id="header-center" className="flex items-center h-[48px]">
                <RtkMeetingTitle meeting={meeting}/>
            </div>
            <div id="header-right" className="flex items-center h-[48px]">
                <RtkGridPagination meeting={meeting} states={states}/>
                <RtkParticipantCount meeting={meeting}/>
                <RtkViewerCount meeting={meeting} />
                <RtkClock meeting={meeting} />
            </div>
        </div>
    );
}

export default HeaderPreBuilt; // uncomment if you want the pre built RealtimeKit header
// export default HeaderWithCustomUI; // uncomment if yoi want custom UI


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/meeting-loading.tsx
================================================
import { RtkSpinner } from '@cloudflare/realtimekit-react-ui';

function  MeetingLoading() {
    /**
         * NOTE(ravindra-dyte): Don't like the default spinner?
         * You can replace RtkSpinner with your own screen, here.
         */
    return <RtkSpinner />;
}

export default MeetingLoading;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/meeting-over.tsx
================================================
import { RtkEndedScreen } from '@cloudflare/realtimekit-react-ui';
import { UIConfig } from '@cloudflare/realtimekit-ui';
import RealtimeKitClient from '@cloudflare/realtimekit';
import { CustomStates, SetStates } from "../types";

function MeetingOver({
  meeting,
  config,
  states,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}) {
    return (
      <main className='flex w-full h-full justify-center items-center'>
        <RtkEndedScreen meeting={meeting} config={config} states={states} />
      </main>
    );
}

export default MeetingOver;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/meeting-sidebar.tsx
================================================
import { RtkChat, RtkParticipants, RtkPlugins, RtkPolls, RtkSidebar, RtkSidebarUi } from '@cloudflare/realtimekit-react-ui';
import { UIConfig } from '@cloudflare/realtimekit-ui';
import RealtimeKitClient from '@cloudflare/realtimekit';
import { CustomSideBarTabs, CustomStates, SetStates } from "../types";
import { useEffect, useState } from "react";
import { RtkSidebarView } from '@cloudflare/realtimekit-ui/dist/types/components/rtk-sidebar-ui/rtk-sidebar-ui';
import { RtkSidebarSection } from '@cloudflare/realtimekit-ui/dist/types/components/rtk-sidebar/rtk-sidebar';

function SidebarPreBuilt({
    meeting, states, config, setStates,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    if(!states.activeSidebar){
        return null;
    }
    return <RtkSidebar meeting={meeting} config={config} states={states}/>;
}

function SidebarWithCustomUI({
    meeting, states, config, setStates,
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    const [tabs, setTabs] = useState([
        { id: 'chat', name: 'chat' },
        { id: 'polls', name: 'polls' },
        { id: 'participants', name: 'participants' },
        { id: 'plugins', name: 'plugins' },
        { id: 'warnings', name: 'warnings' }
    ]);
    const [view, setView] = useState<RtkSidebarView>('sidebar');

    if(!states.activeSidebar || (!states.sidebar && !states.customSidebar)){
        return null;
    }

    const currentTab = states.sidebar || states.customSidebar;

    return (
        <RtkSidebarUi
            tabs={tabs}
            currentTab={currentTab}
            view={view}
            onTabChange={(e) => {
                setStates((oldState) => {
                    return {
                        ...oldState,
                        activeSidebar: true,
                        customSidebar: e.detail,
                        sidebar: e.detail,
                    }
                });
            }}
            className="w-80 "
            onSidebarClose={() => {
                setStates((oldState) => {
                    return {
                        ...oldState,
                        activeSidebar: false,
                        sidebar: null,
                        customSidebar: null,
                    }
                });
            }}>
            {currentTab === 'chat' && <RtkChat meeting={meeting} config={config} slot="chat" /> }
            {currentTab === 'polls' && <RtkPolls meeting={meeting} config={config} slot="polls" /> }
            {currentTab === 'participants' && <RtkParticipants meeting={meeting} config={config} states={states} slot="participants" /> }
            {currentTab === 'plugins' && <RtkPlugins meeting={meeting} config={config} slot="plugins" /> }
            {currentTab === 'warnings' && <div slot="warnings" className="flex justify-center items-center">
                <div>Do not cheat in the exam</div>
            </div> }
        </RtkSidebarUi>
    );

}

// export default SidebarPreBuilt; // Uncomment if you want prebuilt sidebar
export default SidebarWithCustomUI; // Uncomment if you want custom sidebar



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/ReactionsManager.tsx
================================================
/* eslint-disable @next/next/no-img-element */
import { useEffect, useState } from 'react';
import Dialog from './Dialog';
import type RealtimeKitClient from '@cloudflare/realtimekit';

const ReactionsManager = ({
  meeting,
  isOpen,
  onClose,
}: {
  meeting: RealtimeKitClient;
  onClose: () => void;
  isOpen: boolean;
}) => {
    const [currentReaction, setCurrentReaction] = useState('');
    useEffect(() => {
        if(!meeting){
            return;
        }
        meeting.participants.joined.addListener('participantJoined', () => {
            // Hack - Re broadcast the message when a new participant joins
            setTimeout(() => {
                meeting.participants.broadcastMessage("reactions", {
                    reaction: currentReaction,
                    peerId: meeting.self.id,
                });
            }, 1000);
        });
    }, [meeting]);

  return (
    <Dialog isOpen={isOpen} onClose={onClose} header={'Effects'}>
      <div
        className="relative flex overflow-hidden rounded-lg w-full h-full"
        style={{ backgroundColor: '' }}
      >
        <main className="">
          <div className='reactions-holder'>
            {
                ['ðŸ”„', 'ðŸ˜Š', 'ðŸ¤”', 'ðŸ‘€', 'ðŸ˜Ž', 'ðŸ’—', 'ðŸ”¥', 'ðŸ‘ðŸ¼', 'ðŸš€', 'ðŸ’ª'].map((reaction, index) => {
                    return (
                    <div
                     key={index}
                     className={`${index >= 1 ? 'inline-block': ''} m-5 text-3xl cursor-pointer`}
                     onClick={async () => {
                        setCurrentReaction(index === 0 ? '': reaction);
                        await meeting.participants.broadcastMessage("reactions", {
                            reaction: index === 0 ? '': reaction,
                            peerId: meeting.self.id,
                        });
                     }}
                    >{reaction}</div>)
                })
            }
          </div>
        </main>
      </div>
    </Dialog>
  );
};

export default ReactionsManager;



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/setup-screen.tsx
================================================
import type RealtimeKitClient from '@cloudflare/realtimekit';
import { UIConfig }  from '@cloudflare/realtimekit-ui/dist/types/types/ui-config';
import { CustomStates, SetStates } from '../types';
import { RtkDialogManager, RtkSetupScreen } from '@cloudflare/realtimekit-react-ui';
import { RtkParticipantTile, RtkAvatar, RtkNameTag, RtkAudioVisualizer, RtkMicToggle, RtkCameraToggle, RtkSettingsToggle, RtkButton, RtkControlbarButton, defaultIconPack, } from '@cloudflare/realtimekit-react-ui';
import MediaPreviewModal from "./media-preview-modal";
import { useEffect, useState } from 'react';

export function SetupScreenPreBuilt({
    meeting,
    config,
    states,
    setStates,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}) {
    return (
        <main className='w-full h-full' style={{
            backgroundColor: '#272727',
            color: '#ffffff',
        }} ref={(el) => {
          el?.addEventListener('rtkStateUpdate', (e) => {
            const { detail: newStateUpdate } = e as unknown as { detail: CustomStates };
            console.log('rtkStateUpdateSetup:: ', newStateUpdate);
            setStates((oldState: CustomStates) => { return {
              ...oldState,
              ...newStateUpdate,
            }});
          });
        }}>
            <RtkSetupScreen meeting={meeting} config={config} states={states}/>
            <RtkDialogManager meeting={meeting} config={config} states={states}/>
        </main>
    );
}

export function CustomSetupScreenWithPrebuiltMediaPreviewModal({
  meeting,
  config,
  states,
  setStates,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}){
    const [participantName, setParticipantName] = useState('');

    useEffect(() => {
        if (!meeting) {
            return;
        }
        setParticipantName(meeting.self.name);
    }, [meeting]);

    return (
        <main ref={(el) => {
            el?.addEventListener('rtkStateUpdate', (e) => {
              const { detail: newStateUpdate } = e as unknown as { detail: CustomStates };
              console.log('rtkStateUpdateSetup:: ', newStateUpdate);
              setStates((oldState: CustomStates) => { return {
                ...oldState,
                ...newStateUpdate,
              }});
            });
          }}>
            <div key="on-setup-screen" className='flex justify-around w-full h-full p-[5%] bg-black text-white'>
                <div className='flex justify-around w-full h-full p-[5%]'>
                    <RtkParticipantTile meeting={meeting} participant={meeting.self} config={config}>
                        <RtkAvatar participant={meeting.self} />
                        <RtkNameTag participant={meeting.self}>
                            <RtkAudioVisualizer
                                participant={meeting.self}
                                slot="start"
                            />
                        </RtkNameTag>
                        <div id='user-actions' className='absolute flex bottom-2 right-2'>
                            <RtkMicToggle meeting={meeting} size='sm'></RtkMicToggle>
                            <RtkCameraToggle meeting={meeting} size='sm'></RtkCameraToggle>

                        </div>
                        <div className="absolute top-2 right-2">
                            <RtkSettingsToggle states={states} size='sm'></RtkSettingsToggle>
                        </div>
                    </RtkParticipantTile>
                    <div className='h-1/2 w-1/4 flex flex-col justify-between'>
                        <div className='flex flex-col items-center'>
                            <p>Joining as</p>
                            <div>{participantName}</div>
                        </div>
                        <input
                            hidden={!meeting.self.permissions.canEditDisplayName}
                            placeholder="Your name"
                            className='bg-[#141414] rounded-sm border-[#EEEEEE] focus:border-[#2160FD] p-2.5 mb-10'
                            autoFocus
                            value={participantName}
                            onChange={(event) => setParticipantName(event.target.value)}
                        />
                        <RtkButton
                            kind="wide"
                            size='lg'
                            style={{ cursor: participantName ? 'pointer' : 'not-allowed' }}
                            onClick={async () => {
                                if (participantName) {
                                    if (meeting.self.permissions.canEditDisplayName) {
                                        await meeting.self.setName(participantName);
                                    }
                                    await meeting.join();
                                }
                            }}>
                            Join
                        </RtkButton>
                    </div>
                </div >
            </div >
            <RtkDialogManager meeting={meeting} config={config} states={states}/>
        </main>
    );

}

export function CustomSetupScreenWithCustomMediaPreviewModal({
  meeting,
  config,
  states,
  setStates,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}){
    const [participantName, setParticipantName] = useState('');

    useEffect(() => {
        if (!meeting) {
            return;
        }
        setParticipantName(meeting.self.name);
    }, [meeting]);

    return (
        <div key="on-setup-screen" className='flex justify-around w-full h-full p-[5%] bg-black text-white'>
            <div className='flex justify-around w-full h-full p-[5%]'>
                <RtkParticipantTile meeting={meeting} participant={meeting.self}>
                    <RtkAvatar participant={meeting.self} />
                    <RtkNameTag participant={meeting.self}>
                        <RtkAudioVisualizer
                            participant={meeting.self}
                            slot="start"
                        />
                    </RtkNameTag>
                    <div id='user-actions' className='absolute flex bottom-2 right-2'>
                        <RtkMicToggle meeting={meeting} size='sm'></RtkMicToggle>
                        <RtkCameraToggle meeting={meeting} size='sm'></RtkCameraToggle>

                    </div>
                    <div className="absolute top-2 right-2">
                        <RtkControlbarButton
                            onClick={() => setStates( (oldState) => { return { ...oldState, activeMediaPreviewModal: true }})}
                            icon={defaultIconPack.settings}
                            label={'Media Preview'}
                        />
                    </div>
                </RtkParticipantTile>
                <div className='h-1/2 w-1/4 flex flex-col justify-between'>
                    <div className='flex flex-col items-center'>
                        <p>Joining as</p>
                        <div>{participantName}</div>
                    </div>
                    <input
                        hidden={!meeting.self.permissions.canEditDisplayName}
                        placeholder="Your name"
                        className='bg-[#141414] rounded-sm border-[#EEEEEE] focus:border-[#2160FD] p-2.5 mb-10'
                        autoFocus
                        value={participantName}
                        onChange={(event) => setParticipantName(event.target.value)}
                    />
                    <RtkButton
                        kind="wide"
                        size='lg'
                        style={{ cursor: participantName ? 'pointer' : 'not-allowed' }}
                        onClick={async () => {
                            if (participantName) {
                                if (meeting.self.permissions.canEditDisplayName) {
                                    await meeting.self.setName(participantName);
                                }
                                await meeting.join();
                            }
                        }}>
                        Join
                    </RtkButton>
                </div>
                <MediaPreviewModal open={!!states.activeMediaPreviewModal} states={states} config={config} setStates={setStates} meeting={meeting} />
            </div >
        </div >
    );

}

export default SetupScreenPreBuilt; // Uncomment, if you want prebuild setup screen
// export default CustomSetupScreenWithPrebuiltMediaPreviewModal; // Uncomment, if you want custom setup screen with prebuilt media preview
// export default CustomSetupScreenWithCustomMediaPreviewModal; // Uncomment, if you want custom setup screen with custom media preview


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/video-preview.tsx
================================================
import RealtimeKitClient from '@cloudflare/realtimekit';
import { useEffect, useRef, useState } from "react";
import { RtkAudioVisualizer, RtkButton, RtkIcon, RtkParticipantTile, RtkSettingsVideo, RtkSwitch, defaultIconPack } from '@cloudflare/realtimekit-react-ui';
import { CustomStates, SetStates } from "../types";
import { UIConfig } from '@cloudflare/realtimekit-ui';
interface CurrentDevices {
    video?: MediaDeviceInfo
}

function VideoPreviewPreBuilt({
    meeting, states
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates, setStates: SetStates }
){
    return <RtkSettingsVideo meeting={meeting} states={states}/>;
}

function VideoPreviewWithCustomUI({
    meeting, states, setStates
}: { meeting: RealtimeKitClient, config: UIConfig, states: CustomStates,  setStates: SetStates }
) {
    const [videoDevices, setVideoDevices] = useState<MediaDeviceInfo[]>([]);
    const [currentDevices, setCurrentDevices] = useState<CurrentDevices>({});
    useEffect(() => {
        if (!meeting) {
            return;
        }
        
        const deviceListUpdateCallback = async () => {
            setVideoDevices(await meeting.self.getVideoDevices());
        }
        meeting.self.addListener('deviceListUpdate', deviceListUpdateCallback);
        //populate first time values
        deviceListUpdateCallback();
        setCurrentDevices({
            video: meeting.self.getCurrentDevices().video
        })
        return () => {
            meeting.self.removeListener('deviceListUpdate', deviceListUpdateCallback);
        }
    }, [meeting])
    const setDevice = async (kind: 'video', deviceId: string) => {
        const device = videoDevices.find((d) => d.deviceId === deviceId);
        setCurrentDevices((oldDevices) => {
            return {
                ...oldDevices,
                [kind]: device,
            }
        })
        if (device != null) {
            await meeting?.self.setDevice(device);
        }
    }
    let unnamedCameraCount = 0;
    return (
        <div className="flex flex-col p-4">
            <div>
                {meeting.self.videoEnabled === true ? (
                    <RtkParticipantTile
                        meeting={meeting}
                        participant={meeting?.self}
                        states={states}
                        isPreview />
                ) : (
                    <div>
                        <RtkParticipantTile
                            meeting={meeting}
                            participant={meeting?.self}
                        >
                            <div>
                                <RtkIcon
                                    icon={defaultIconPack.video_off} />
                                <div>Camera Off</div>
                            </div>
                        </RtkParticipantTile>
                    </div>
                )}
            </div>
            <div>
                <label>Camera</label>
                <div>
                    <select
                        className="mt-2 w-full text-ellipsis bg-[#1F1F1F] p-2"
                        onChange={(e) => setDevice('video', (e.target as HTMLSelectElement).value)}
                    >
                        {videoDevices.map(({ deviceId, label }) => (
                            <option key={deviceId} selected={currentDevices?.video?.deviceId === deviceId} value={deviceId}>
                                {label || `Camera ${++unnamedCameraCount}`}
                            </option>
                        ))}
                    </select>
                </div>
            </div>
        </div >
    );
}

export default VideoPreviewPreBuilt; // uncomment if you want to use prebuilt video preview
// export default VideoPreviewWithCustomUI; // uncomment if you want custom ui for video preview


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/components/waiting-room.tsx
================================================
import { RtkWaitingScreen } from '@cloudflare/realtimekit-react-ui';
import { UIConfig } from '@cloudflare/realtimekit-ui';
import RealtimeKitClient from '@cloudflare/realtimekit';
import { CustomStates, SetStates } from "../types";

function WaitingRoom({
    meeting,
    config,
}: { meeting: RealtimeKitClient, config: UIConfig,  states: CustomStates, setStates: SetStates}) {
    return (
        <main className='flex w-full h-full justify-center items-center' style={{
            backgroundColor: '#272727',
            color: '#ffffff',
      }}>
            <RtkWaitingScreen meeting={meeting} config={config}/>
        </main>
    );
}

export default WaitingRoom;


================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/lib/graceful-storage.ts
================================================
const handler = {
  get:
    (target: any, name: any, receiver: any) =>
    (...args: any[]) => {
      try {
        return Reflect.get(target, name, receiver).apply(target, args);
      } catch {
        return null;
      }
    },
};

let gracefulStorage: Storage;

try {
  gracefulStorage = new Proxy(localStorage, handler);
} catch {
  gracefulStorage = new Proxy({}, handler);
}

export default gracefulStorage;



================================================
FILE: samples/screenshare-focused-ui-with-custom-addons/src/lib/store.ts
================================================
import create from 'zustand';
import { persist } from 'zustand/middleware';
import gracefulStorage from './graceful-storage';

export interface RtkStore {
  displayName: string;
  clientSpecificId: string;
  audioTranscriptions: boolean;
  presets: { name: string; id: string }[];
  effects: {
    audio: {
      krisp: boolean;
    };
    video: {
      background: 'none' | 'blur' | 'image';
      backgroundImage: string;
    };
  };
  updateStore: <T extends keyof RtkStore>(key: T, value: RtkStore[T]) => void;
}

export const useRtkStore = create<RtkStore>(
  persist(
    (set, get) => ({
      displayName: '',
      clientSpecificId: Math.random().toString(36).substring(7),
      audioTranscriptions: false,
      presets: [],
      effects: {
        audio: {
          krisp: false,
        },
        video: {
          background: 'none',
          backgroundImage: '',
        },
      },
      updateStore: (key, value) => {
        set((state) => Object.assign({}, state, { [key]: value }));
      },
    }),
    {
      name: 'rtk-store',
      getStorage: () => gracefulStorage,
    }
  )
);

export const storeSelector = (store: RtkStore) => ({
  clientSpecificId: store.clientSpecificId,
  displayName: store.displayName,
  presets: store.presets,
  effects: store.effects,
  updateStore: store.updateStore,
});



================================================
FILE: samples/simple-group-call/README.md
================================================
# Simple Meeting UI Sample

This sample showcases how you can create a simple Meeting UI on your own.

Note that this is a very bare bones example of how you can build your own UI
from scratch.

---

![A screenshot of the sample](./screenshot.png)

[See source](./src/components/Meeting.tsx)



================================================
FILE: samples/simple-group-call/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using UI Kit Components - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/simple-group-call/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "clsx": "^1.2.1",
    "good-grid": "^0.3.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.13",
    "postcss": "^8.4.20",
    "tailwindcss": "^3.2.4",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/simple-group-call/postcss.config.cjs
================================================
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/simple-group-call/tailwind.config.cjs
================================================
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: ['./src/*.{ts,tsx}', './src/components/*.{ts,tsx}'],
  theme: {
    extend: {
      colors: {
        rtk: {
          blue: '#2160FD',
        },
      },
    },
  },
  plugins: [],
};



================================================
FILE: samples/simple-group-call/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/simple-group-call/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/simple-group-call/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/simple-group-call/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/simple-group-call/src/App.tsx
================================================
import { useEffect } from 'react';
import { RealtimeKitProvider, useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import Meeting from './components/Meeting';
import { RtkDialogManager, RtkUiProvider } from '@cloudflare/realtimekit-react-ui';

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
    });
  }, []);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider value={meeting} fallback={<></>}>
      <RtkUiProvider meeting={meeting} showSetupScreen>
        <RtkDialogManager meeting={meeting} />
        <Meeting />
      </RtkUiProvider>
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/simple-group-call/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html,
  body,
  #root {
    height: 100%;
  }
}

rtk-name-tag {
  @apply bg-zinc-200/60;
}



================================================
FILE: samples/simple-group-call/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

import { provideRtkDesignSystem } from '@cloudflare/realtimekit-react-ui';

provideRtkDesignSystem(document.body, {
  theme: 'light',
  googleFont: 'Inter',
  colors: {
    'video-bg': '#ebebeb',
  },
});

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/simple-group-call/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/simple-group-call/src/components/Meeting.tsx
================================================
import { useRealtimeKitMeeting, useRealtimeKitSelector } from '@cloudflare/realtimekit-react';
import {
  RtkAudioVisualizer,
  RtkParticipantTile,
  RtkNameTag,
  RtkAvatar,
  RtkMeetingTitle,
  RtkClock,
  RtkMicToggle,
  RtkCameraToggle,
  RtkParticipantCount,
  RtkParticipantsAudio,
  RtkSetupScreen,
  RtkLeaveButton,
  RtkEndedScreen,
} from '@cloudflare/realtimekit-react-ui';
import { useMemo, useRef } from 'react';
import { createGrid } from 'good-grid';
import { useGridDimensions } from 'good-grid/react';
import clsx from 'clsx';

function UI() {
  const $grid = useRef<HTMLElement>(null);
  const dimensions = useGridDimensions($grid);

  const { meeting } = useRealtimeKitMeeting();
  const self = useRealtimeKitSelector((meeting) => meeting.self);
  const activeParticipants = useRealtimeKitSelector((meeting) =>
    meeting.participants.active.toArray()
  );

  const pinnedParticipants = useRealtimeKitSelector((meeting) =>
    meeting.participants.pinned.toArray()
  );

  // show pinned participants first
  const participants = [
    ...pinnedParticipants,
    ...activeParticipants.filter((p) => !pinnedParticipants.includes(p)),
    self,
  ];

  const { width, height, getPosition } = useMemo(
    () =>
      createGrid({
        dimensions,
        count: participants.length,
        aspectRatio: '4:3',
        gap: 12,
      }),
    [participants]
  );

  return (
    <div className="w-full h-full flex flex-col">
      <RtkParticipantsAudio meeting={meeting} />
      <header className="h-12 flex items-center justify-between px-4 border-b">
        <div className="flex items-center gap-1 md:gap-2">
          <img
            src="https://docs.realtime.cloudflare.com/logo/cf.svg"
            className="h-6 md:h-7"
          />
          <div className="w-px h-7 mx-1 rotate-[18deg] bg-zinc-200"></div>
          <RtkMeetingTitle
            meeting={meeting}
            className="mx-0 font-medium text-xs md:text-sm font-sans"
          />
        </div>
        <div>
          <RtkParticipantCount
            meeting={meeting}
            className="text-xs md:text-sm"
          />
          <RtkClock meeting={meeting} className="text-xs md:text-sm" />
        </div>
      </header>
      <main
        className="flex-grow flex-shrink-0 relative flex flex-wrap content-center justify-center gap-4 p-4 overflow-clip"
        ref={$grid}
      >
        {participants.map((participant, index) => {
          const { top, left } = getPosition(index);

          return (
            <RtkParticipantTile
              participant={participant}
              meeting={meeting}
              key={participant.id}
              className={clsx(
                'absolute transition-all border bg-zinc-100',
                participant.audioEnabled
                  ? 'border-rtk-blue shadow-md shadow-rtk-blue/30'
                  : 'border-zinc-200'
              )}
              style={{
                width,
                height,
                top,
                left,
              }}
            >
              <RtkAvatar participant={participant} size="md" />
              <RtkNameTag participant={participant} meeting={meeting}>
                <RtkAudioVisualizer participant={participant} slot="start" />
              </RtkNameTag>
            </RtkParticipantTile>
          );
        })}
      </main>
      <footer className="py-2 flex items-center justify-center">
        <RtkMicToggle meeting={meeting} />
        <RtkCameraToggle meeting={meeting} />
        <RtkLeaveButton />
      </footer>
    </div>
  );
}

export default function Meeting() {
  const { meeting } = useRealtimeKitMeeting();

  const roomJoined = useRealtimeKitSelector((meeting) => meeting.self.roomJoined);
  const roomState = useRealtimeKitSelector((meeting) => meeting.self.roomState);

  if(roomState === 'ended' || roomState === 'left') {
    return <RtkEndedScreen meeting={meeting} />;
  }

  if (roomState === 'joined') {
    return <UI />;
  }

  return <RtkSetupScreen meeting={meeting} />;
  
}



================================================
FILE: samples/simple-ui/README.md
================================================
# Simple UI Sample

[See source](./src/App.tsx)



================================================
FILE: samples/simple-ui/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Default Meeting UI - RealtimeKit UI Kit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/simple-ui/package.json
================================================
{
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.30",
    "prettier": "^3.0.3",
    "tailwindcss": "^3.3.3",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/simple-ui/postcss.config.js
================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}



================================================
FILE: samples/simple-ui/tailwind.config.js
================================================
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./src/**/*.tsx'],
  theme: {
    extend: {},
  },
  plugins: [],
}



================================================
FILE: samples/simple-ui/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/simple-ui/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/simple-ui/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/simple-ui/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/simple-ui/src/App.tsx
================================================
import { useEffect, useReducer } from 'react';
import {
  RealtimeKitProvider,
  useRealtimeKitClient,
  useRealtimeKitMeeting,
  useRealtimeKitSelector,
} from '@cloudflare/realtimekit-react';
import {
  RtkCameraToggle,
  RtkChatToggle,
  RtkDialogManager,
  RtkGrid,
  RtkLogo,
  RtkMeetingTitle,
  RtkMicToggle,
  RtkParticipantsAudio,
  RtkPollsToggle,
  RtkScreenShareToggle,
  RtkSetupScreen,
  RtkSidebar,
  RtkSpinner,
  RtkUiProvider,
  defaultConfig,
  provideRtkDesignSystem,
} from '@cloudflare/realtimekit-react-ui';

const config = { ...defaultConfig };

if (config.root) {
  config.root['rtk-participant-tile'] = (
    config.root['rtk-participant-tile'] as any
  ).children;
}

function Meeting() {
  const { meeting } = useRealtimeKitMeeting();
  const roomJoined = useRealtimeKitSelector((m) => m.self.roomJoined);

  const [states, updateStates] = useReducer(
    (state: any, payload: any) => ({
      ...state,
      ...payload,
    }),
    { meeting: 'joined', activeSidebar: false },
  );

  if (!meeting) {
    return <RtkSpinner />;
  }

  if (!roomJoined) {
    return <RtkSetupScreen meeting={meeting} />;
  }

  return (
    <div
      className="flex flex-col w-full h-full"
      ref={(el) => {
        el?.addEventListener('rtkStateUpdate', (e: any) => {
          updateStates(e.detail);
        });
      }}
    >
      <header className="flex items-center gap-3 h-12 border-b w-full px-2 text-sm">
        <RtkLogo meeting={meeting} />
        <RtkMeetingTitle meeting={meeting} />
      </header>
      <main className="flex flex-1 p-2">
        <RtkGrid meeting={meeting} config={config} />
        {states.activeSidebar && <RtkSidebar meeting={meeting} states={states} />}
      </main>
      <footer className="p-2 flex place-items-center justify-center">
        <RtkMicToggle meeting={meeting} />
        <RtkCameraToggle meeting={meeting} />
        <RtkScreenShareToggle meeting={meeting} />
        <RtkChatToggle meeting={meeting} />
        <RtkPollsToggle meeting={meeting} />
      </footer>
    </div>
  );
}

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting.",
      );
      return;
    }

    provideRtkDesignSystem(document.body, {
      theme: 'light',
    });

    initMeeting({
      authToken,
      defaults: {
        audio: false,
        video: false,
      },
    })
  }, []);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return (
    <RealtimeKitProvider value={meeting}>
      <RtkUiProvider meeting={meeting} showSetupScreen>
        <Meeting />
        <RtkDialogManager />
        <RtkParticipantsAudio />
      </RtkUiProvider>
    </RealtimeKitProvider>
  );
}

export default App;



================================================
FILE: samples/simple-ui/src/index.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html, body, #root {
    height: 100%;
  }
}



================================================
FILE: samples/simple-ui/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/simple-ui/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: samples/with-background-transformer/README.md
================================================
# With Background Transformer UI Sample

This sample showcases how you can modify your background while in a RealtimeKit video call
with the [`@cloudflare/realtimekit-virtual-background`](https://www.npmjs.com/package/@cloudflare/realtimekit-virtual-background) package.

---

You can set:

1. A background blur
2. A backgriund image

<!-- With blur:

![A screenshot of using background blur](./screenshot-blur.png)

With background image:

![A screenshot of using a background image](./screenshot-image.png) -->

[See source](./src/App.tsx)



================================================
FILE: samples/with-background-transformer/index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React + TS</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================================
FILE: samples/with-background-transformer/package.json
================================================
{
  "name": "with-background-transformer",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cloudflare/realtimekit-react": "^1.1.6",
    "@cloudflare/realtimekit-react-ui": "^1.0.5",
    "@cloudflare/realtimekit-virtual-background": "0.0.2",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@cloudflare/realtimekit": "^1.1.6",
    "@cloudflare/realtimekit-ui": "^1.0.5",
    "@cloudflare/realtimekit-ui-addons": "^0.0.4"
  },
  "devDependencies": {
    "@types/react": "^18.0.24",
    "@types/react-dom": "^18.0.8",
    "@vitejs/plugin-react": "^2.2.0",
    "typescript": "^4.6.4",
    "vite": "^3.2.3"
  }
}



================================================
FILE: samples/with-background-transformer/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": false,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}



================================================
FILE: samples/with-background-transformer/tsconfig.node.json
================================================
{
  "compilerOptions": {
    "composite": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: samples/with-background-transformer/vite.config.ts
================================================
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  base:'./',
  plugins: [react()],
});



================================================
FILE: samples/with-background-transformer/.gitignore
================================================
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*
package-lock.json

node_modules
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?



================================================
FILE: samples/with-background-transformer/src/App.tsx
================================================
import { useEffect } from 'react';
import { RtkMeeting } from '@cloudflare/realtimekit-react-ui';
import { useRealtimeKitClient } from '@cloudflare/realtimekit-react';
import RealtimeKitVideoBackgroundTransformer from '@cloudflare/realtimekit-virtual-background';

declare global {
  interface Window {
    meeting: any;
  }
}

function App() {
  const [meeting, initMeeting] = useRealtimeKitClient();

  useEffect(() => {
    const searchParams = new URL(window.location.href).searchParams;

    const authToken = searchParams.get('authToken');

    if (!authToken) {
      alert(
        "An authToken wasn't passed, please pass an authToken in the URL query to join a meeting."
      );
      return;
    }

    (
      initMeeting({
        authToken,
      }) as any
    ).then(async (meeting: any) => {
      window.meeting = meeting;

      /**
       * To customise RealtimeKitVideoBackgroundTransformer configs, please refer to https://www.npmjs.com/package/@cloudflare/realtimekit-virtual-background?activeTab=readme.
       * 
      */
      const videoBackgroundTransformer =
        await RealtimeKitVideoBackgroundTransformer.init({
          meeting,
          segmentationConfig: {
            pipeline: 'canvas2dCpu', // 'webgl2' | 'canvas2dCpu'
          },
        });

      // The video-background-transformer provides two functionalities
      // 1. Add background blur
      // 2. Add a background image

      // 1. To add background blur, with strength of 10
      meeting.self.addVideoMiddleware(
        await videoBackgroundTransformer.createBackgroundBlurVideoMiddleware(10)
      );

      // 2. To add a background image
      // meeting.self.addVideoMiddleware(
      //   await videoBackgroundTransformer.createStaticBackgroundVideoMiddleware(
      //     'https://assets.dyte.io/backgrounds/bg-dyte-office.jpg'
      //   )
      // );

      // We have the following set of images for your immediate use:
      // https://assets.dyte.io/backgrounds/bg-dyte-office.jpg
      // https://assets.dyte.io/backgrounds/bg_0.jpg
      // https://assets.dyte.io/backgrounds/bg_1.jpg
      // https://assets.dyte.io/backgrounds/bg_2.jpg
      // https://assets.dyte.io/backgrounds/bg_3.jpg
      // https://assets.dyte.io/backgrounds/bg_4.jpg
      // https://assets.dyte.io/backgrounds/bg_5.jpg
      // https://assets.dyte.io/backgrounds/bg_6.jpg
      // https://assets.dyte.io/backgrounds/bg_7.jpg
    });
  }, []);

  // By default this component will cover the entire viewport.
  // To avoid that and to make it fill a parent container, pass the prop:
  // `mode="fill"` to the component.
  return <RtkMeeting meeting={meeting!} />;
}

export default App;



================================================
FILE: samples/with-background-transformer/src/index.css
================================================



================================================
FILE: samples/with-background-transformer/src/main.tsx
================================================
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  // NOTE: Not using StrictMode to avoid the double execution of useEffect
  // while trying out the sample
  <App />
);



================================================
FILE: samples/with-background-transformer/src/vite-env.d.ts
================================================
/// <reference types="vite/client" />



================================================
FILE: .github/ISSUE_TEMPLATE/new-ui-design-app-clone.md
================================================
---
name: New UI Design/App Clone
about: Suggest an idea for this Sample App repo
title: ''
labels: ''
assignees: ''

---

**Is your UI request related to an Video/Livestreaming Application? Please describe.**
A clear and concise description of what the UI islike. Ex. I've always wanted to use livestreaming/video calling when [...]

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.



================================================
FILE: .github/ISSUE_TEMPLATE/ui-update-to-existing-sample.md
================================================
---
name: UI Update to Existing Sample
about: Suggest an idea for upgrading the current UI/UX of one of the current samples
title: ''
labels: hacktoberfest
assignees: ''

---

**Is your UI update related to a current sample app? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the update/upgrade you'd like**
A clear and concise description of what you want to happen.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.



================================================
FILE: .github/workflows/deploy.yml
================================================
name: Deploy

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest
        name: Deploy
        steps:
            - uses: actions/checkout@v4

            - run: |
                npm install
                npm run build

            - name: Deploy to Production
              uses: cloudflare/wrangler-action@v3
              with:
                  apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
                  accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
                  wranglerVersion: "4.19.1"
                  command: pages deploy ./dist


